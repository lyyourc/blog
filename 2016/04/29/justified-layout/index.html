<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>实现一个 flickr like 布局 | lyyourc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">home</a>
    
  
    
      <a href="/archives">archive</a>
    
  
    
      <a href="/atom.xml">rss</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2016/04/29/justified-layout/">实现一个 flickr like 布局</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">April 29 2016</p>
  </section>

  <section class="article-entry">
    <p>Flickr 团队最近开源了他们图片布局的项目 - <a href="https://github.com/flickr/justified-layout/blob/master/README.md" target="_blank" rel="external">Flickr’s Justified Layout</a> 。那么，通过阅读其源代码后，我实现了一个简单版 - <a href="https://github.com/DrakeLeung/demo/blob/gh-pages/toys%2Fjjjustify%2FREADME.md" target="_blank" rel="external">jjjustify</a>。点击这里可以查看在线 <a href="http://frontend-addiction.github.io/Baidu-IFE/stage03/task43/flickr/index.html" target="_blank" rel="external">demo</a> 。</p>
<h2 id="核心算法"><a href="#核心算法" class="headerlink" title="核心算法"></a>核心算法</h2><p>整个应用的核心是：<strong>如何确定一行中的图片数量并且保持横纵比</strong> 。</p>
<p>首先，我们需要知道一个知识：</p>
<blockquote>
<p>假设我们一行的高度为 300 ，宽度为 1200 。那么在这一行中的所有图片的横纵比之和就小于等于这一行的横纵比，也就是 4:1 。</p>
</blockquote>
<p>我们这里不用数学来证明。但是不妨想象，当一行中的图片都收缩或者拉伸之后，是可以占满整行的，这时，就相当于这一行。所以，当前行所有图片的横纵比之和要<strong>小于等于</strong>初始设定的整行的横纵比。</p>
<img src="/2016/04/29/justified-layout/1.png" alt="1.png" title="">
<p>但是，为了增加灵活性，我们可以<strong>设定一个容忍度</strong>。他的取值范围是 <code>[0, 1]</code> 。如果当前行所有图片的横纵比之和介于（初始设定的整行的横纵比 * (1 +- 容忍度）的话，我们都能接受（容忍），在当前行插入该图片。</p>
<p>举个例子：初始设定的整行的横纵比（<code>targetRowAspectRatio</code>）为 4 ，我们的容忍度（<code>tolerance</code>）为 <code>0.25</code> 。所以，只要图片们的横纵比之和介于 <code>targetRowAspectRatio * (1 - tolerance)</code> 和 <code>targetRowAspectRatio * (1 + tolerance)</code> 就让他们在当前行。</p>
<img src="/2016/04/29/justified-layout/2.png" alt="2.png" title="">
<p>如果大于容忍后的横纵比的话，<strong>为了更加精确，我们可以比较绝对值</strong>。看看插入图片后的横纵比之和 - targetRowAspectRatio 的绝对值小，还是插入图片前的横纵比之和 - targetRowAspectRatio 的绝对值小。哪个小就采用哪种方案。</p>
<p>插入新图片前的绝对值为 <code>3.5</code> :<br><img src="/2016/04/29/justified-layout/4.png" alt="4.png" title=""></p>
<p>插入后的绝对值为 <code>0.5</code> ，小于 <code>3.5</code> ，所以我们选择在当前行插入该图片。<br><img src="/2016/04/29/justified-layout/3.png" alt="3.png" title=""></p>
<p>如果小于容忍后的横纵比的话，假设还没插完图片，就继续插。如果已经插完了图片，这里我们可以选择是否铺满一行，还是就让他这样。这个时候我们的高度就是原始设定的高度。</p>
<p>详细代码实现请参考 <a href="https://github.com/DrakeLeung/demo/blob/gh-pages/toys%2Fjjjustify%2Frrrow.js" target="_blank" rel="external">rrrow.js</a> 的 <code>addItem()</code> 方法。</p>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> lyyourc </p>
      <p class="subtitle"> You Are The JavaScript In My HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text=Flickr 团队最近开源了他们图片布局"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = 'http://drakeleung.github.io/blog/2016/04/29/justified-layout/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
