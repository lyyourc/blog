<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>fetch api ç”¨èµ·æ¥ï¼ | lyyourc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">home</a>
    
  
    
      <a href="/archives">archive</a>
    
  
    
      <a href="/atom.xml">rss</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2016/08/15/fetch-api-now/">fetch api ç”¨èµ·æ¥ï¼</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">August 15 2016</p>
  </section>

  <section class="article-entry">
    <p>ä»Šå¤©æŠŠ vue-resource ç æ‰ï¼Œæ¢æˆäº† <a href="http://devdocs.io/dom/globalfetch/fetch" target="_blank" rel="external">fetch</a> ã€‚<br>
ç„¶è€Œï¼Œä»£ç ä½“ç§¯åœ¨ build ä¹‹ååªæ˜¯å°‘äº† 2K =ã€‚=</p>
<p>ä¸ºäº†å…¼å®¹æ—§æµè§ˆå™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªçš„ polyfill : <a href="https://github.com/github/fetch" target="_blank" rel="external">whatwg-fetch</a> ï¼›å¦‚æœè¿˜æƒ³å…¼å®¹ node çš„è¯ï¼š<a href="https://github.com/matthew-andrews/isomorphic-fetch" target="_blank" rel="external">isomorphic-fetch</a> ã€‚å®‰è£…è¯·çœ‹å¯¹åº”çš„æ–‡æ¡£ã€‚</p>
<h2 id="fetch-api"><a class="header-anchor" href="#fetch-api">#</a>fetch api</h2>
<p>æœ€ç®€å•çš„ <code>fetch</code> æ¥å£æ˜¯ä¸‹é¢è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * fetch</div><div class="line"> *</div><div class="line"> * @param &#123;string&#125; url </div><div class="line"> * @param &#123;object&#125; config</div><div class="line"> * @return &#123;promise&#125;</div><div class="line">*/</div><div class="line">fetch('/api/heros/, &#123;</div><div class="line">  method: 'GET',</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>æ›´è¯¦æƒ…çš„è¯·çœ‹æ–‡æ¡£å•¦ï¼š<a href="http://devdocs.io/dom/globalfetch/fetch" target="_blank" rel="external">globalfetch.fetch</a> ã€‚</p>
<h2 id="å¸¸ç”¨ä¾‹å­"><a class="header-anchor" href="#å¸¸ç”¨ä¾‹å­">#</a>å¸¸ç”¨ä¾‹å­</h2>
<p>çœ‹è¿™ä¸ªï¼š<a href="https://github.com/github/fetch#usage" target="_blank" rel="external">fetch - usage</a> ã€‚</p>
<h2 id="å¯èƒ½é‡åˆ°çš„å‘"><a class="header-anchor" href="#å¯èƒ½é‡åˆ°çš„å‘">#</a>å¯èƒ½é‡åˆ°çš„å‘</h2>
<ul>
<li>ä¸å‘é€ cookie</li>
<li>ä¸ catch 404 æˆ–è€… 500 ç­‰ HTTP é”™è¯¯çŠ¶æ€ç ã€‚</li>
</ul>
<p>è§£å†³åŠæ³•å¯ä»¥æŸ¥çœ‹ <a href="https://github.com/github/fetch#caveats" target="_blank" rel="external">fetch - caveats</a> ã€‚</p>
<h2 id="æ‹¦æˆªå™¨"><a class="header-anchor" href="#æ‹¦æˆªå™¨">#</a>æ‹¦æˆªå™¨</h2>
<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹å‰æˆ–è€…ä¹‹åè¿›è¡ŒæŸäº›æ“ä½œçš„è¯ï¼Œå°±éœ€è¦ç”¨åˆ°æ‹¦æˆªå™¨å•¦ã€‚<br>
ä¸‹é¢æˆ‘ä»¬ç”¨åˆ°çš„æ˜¯æ‹¦æˆªå™¨æ˜¯ <a href="https://github.com/werk85/fetch-intercept" target="_blank" rel="external">fetch-intercept</a> ã€‚å¯ä»¥å»çœ‹çœ‹æºç ï¼Œåªæœ‰ 80 è¡Œä¸åˆ°ï¼Œè¶…çº§ä¼˜ç¾çš„ä»£ç ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³æ¯ä¸ªè¯·æ±‚éƒ½å‘é€ cookie çš„è¯ï¼Œå°±å¿…é¡»è¦è®¾ç½® <a href="https://github.com/github/fetch#sending-cookies" target="_blank" rel="external">credentials</a> ã€‚ä½†æ˜¯æˆ‘ä¸æƒ³æ¯ä¸ªè¯·æ±‚éƒ½è®¾ç½®ä¸€éï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°æ‹¦æˆªå™¨å•¦ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> fetchIntercept</div><div class="line"></div><div class="line">fetchIntercept.register(&#123;</div><div class="line">  request(url, config = &#123;&#125;) &#123;</div><div class="line">    <span class="keyword">const</span> myConf = &#123;</div><div class="line">      credentials: <span class="string">'include'</span>, <span class="comment">// send cookie</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> [</div><div class="line">      url,</div><div class="line">      defaults(config, myConf), <span class="comment">// merge 2 objects</span></div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–è¯·æ±‚çš„ URL ã€‚æ¯”å¦‚è¯´ï¼Œ</p>
<ul>
<li><code>/rootHost/api/heros/</code></li>
<li><code>/rootHost/api/coolBoys/</code></li>
</ul>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æŠŠ <code>/rootHost/api/</code> æå–å‡ºæ¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">fetchIntercept.register(&#123;</div><div class="line">  request(url, config = &#123;&#125;) &#123;</div><div class="line">    <span class="keyword">return</span> [</div><div class="line">     <span class="string">`<span class="subst">$&#123;apiHost()&#125;</span>/api/<span class="subst">$&#123;url&#125;</span>,</span></div><div class="line">     config,</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">&#125;)</div><div class="line"></div><div class="line">fetch('heros/')</div><div class="line">fetch('coolBoys/')</div></pre></td></tr></table></figure>
<p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åœ¨ GET è¯·æ±‚æ—¶å¸¦çš„ query string ã€‚</p>
<p>å¦å¤–ï¼Œå› ä¸º fetch ä¸ä¼š catch 404 ç­‰é”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fetchIntercept.register(&#123;</div><div class="line">  response(res) &#123;</div><div class="line">    <span class="keyword">if</span> (res.status &gt;= <span class="number">200</span> &amp;&amp; res.status &lt; <span class="number">300</span>) <span class="keyword">return</span> res</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(res.statusText)</div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ‹¦æˆªå™¨ä¹‹åï¼Œæˆ‘ä»¬çš„ä»£ç å°±å˜å¾—ä¼˜ç¾å¤šäº† <img class="emoji" draggable="false" alt="ğŸ˜ƒ" src="https://twemoji.maxcdn.com/2/72x72/1f603.png"></p>
<h2 id="see-also"><a class="header-anchor" href="#see-also">#</a>See Also</h2>
<ul>
<li><a href="https://github.com/github/fetch" target="_blank" rel="external">whatwg-fetch</a></li>
<li><a href="https://github.com/matthew-andrews/isomorphic-fetch" target="_blank" rel="external">isomorphic-fetch</a></li>
<li><a href="https://github.com/werk85/fetch-intercept" target="_blank" rel="external">fetch-intercept</a></li>
</ul>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> lyyourc </p>
      <p class="subtitle"> You Are The JavaScript In My HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text=ä»Šå¤©æŠŠ vue-resource ç æ‰ï¼Œ"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = 'http://drakeleung.github.io/blog/2016/08/15/fetch-api-now/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
