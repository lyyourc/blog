<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>lyä½ ä¸ªc</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://drakeleung.github.io/blog/"/>
  <updated>2016-09-23T10:27:48.000Z</updated>
  <id>http://drakeleung.github.io/blog/</id>
  
  <author>
    <name>lyä½ ä¸ªc</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>è®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹  RxJS</title>
    <link href="http://drakeleung.github.io/blog/2016/09/21/Let-Us-Learn-RxJS/"/>
    <id>http://drakeleung.github.io/blog/2016/09/21/Let-Us-Learn-RxJS/</id>
    <published>2016-09-20T16:02:04.000Z</published>
    <updated>2016-09-23T10:27:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ç¯‡ RxJS åˆå­¦è€…æ•™ç¨‹ã€‚</p>
<h2 id="what-is-rxjs"><a class="header-anchor" href="#what-is-rxjs">#</a>What Is RxJS</h2>
<p>é€šè¿‡<strong>é˜…è¯»<a href="http://reactivex.io/rxjs/manual/overview.html" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></strong>ï¼Œä¸éš¾å¾—å‡ºï¼šRxJS å¯ä»¥å¾ˆå¥½<strong>è§£å†³å¼‚æ­¥å’Œäº‹ä»¶ç»„åˆçš„é—®é¢˜</strong>ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘å°±æœ‰ç–‘é—®äº†ï¼Œå¼‚æ­¥é—®é¢˜ä¸æ˜¯ç”¨ Promise ( async/await ) å°±å¥½äº†å—ï¼Ÿ<br>
è‡³äºäº‹ä»¶ï¼Œé…åˆæ¡†æ¶ ( React, Vue, Angular2 ç­‰ ) çš„è¯ä¸ä¹Ÿå¾ˆå®¹æ˜“è§£å†³å—ï¼Ÿ<img class="emoji" draggable="false" alt="ğŸ˜®" src="https://twemoji.maxcdn.com/2/72x72/1f62e.png"></p>
<p>ä¸ç®¡æ€æ ·, è®©æˆ‘ä»¬å…ˆçœ‹ä¸ª Hello World å§ã€‚(æˆ‘è¦çœ‹ <a href="http://jsbin.com/suguho/edit?js,output" target="_blank" rel="external">DEMO</a> )</p>
<h3 id="rx-s-hello-world"><a class="header-anchor" href="#rx-s-hello-world">#</a>Rxâ€™s Hello World</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// auto-complete</span></div><div class="line"><span class="keyword">const</span> Observable = Rx.Observable</div><div class="line"><span class="keyword">const</span> input = <span class="built_in">document</span>.querySelector(<span class="string">'input'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> search$ = Observable.fromEvent(input, <span class="string">'input'</span>)</div><div class="line">  .map(e =&gt; e.target.value)</div><div class="line">  .filter(value =&gt; value.length &gt;= <span class="number">1</span>)</div><div class="line">  .throttleTime(<span class="number">100</span>)</div><div class="line">  .distinctUntilChanged()</div><div class="line">  .switchMap(term =&gt; Observable.fromPromise(wikiIt(term)))</div><div class="line">  .subscribe(</div><div class="line">    x =&gt; renderSearchResult(x),</div><div class="line">    err =&gt; <span class="built_in">console</span>.error(err)</div><div class="line">  )</div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li>ç›‘å¬ <code>input</code> å…ƒç´ çš„ <code>input</code> äº‹ä»¶</li>
<li>ä¸€æ—¦å‘ç”Ÿï¼ŒæŠŠäº‹ä»¶å¯¹è±¡ <code>e</code> æ˜ å°„æˆ <code>input</code> å…ƒç´ çš„å€¼</li>
<li>æ¥ç€è¿‡æ»¤æ‰å€¼é•¿åº¦å°äº <code>1</code> çš„</li>
<li>å¹¶ä¸”è¿˜è®¾ç½®äº†ä¸€ä¸ª <code>throttle</code> (èŠ‚æµå™¨)ï¼Œä¸¤æ¬¡è¾“å…¥é—´éš”ä¸è¶…è¿‡ <code>100</code> æ¯«ç§’ä¸ºæœ‰æ•ˆè¾“å…¥</li>
<li>å¦‚æœè¯¥å€¼å’Œè¿‡å»æœ€æ–°çš„å€¼ç›¸ç­‰çš„è¯ï¼Œå¿½ç•¥ä»–</li>
<li>æœ€åï¼Œæ‹¿åˆ°å€¼ä¾¿è°ƒç”¨ Wikipedia çš„ä¸€ä¸ª API</li>
<li>æœ€åçš„æœ€åï¼Œéœ€è¦ <code>subscribe</code> æ‰èƒ½æ‹¿åˆ° API è¿”å›çš„æ•°æ®</li>
</ul>
<p>æ˜¯ä¸æ˜¯çœ‹èµ·æ¥å°±è§‰å¾—å¾ˆ cool ï¼Œå¥½æƒ³å­¦ï¼<img class="emoji" draggable="false" alt="ğŸ˜š" src="https://twemoji.maxcdn.com/2/72x72/1f61a.png"><br>
çŸ­çŸ­å‡ è¡Œä»£ç å°±å®Œæˆäº†ä¸€ä¸ª auto-complete ç»„ä»¶ã€‚</p>
<h2 id="how-it-works"><a class="header-anchor" href="#how-it-works">#</a>How It Works</h2>
<p>é‚£ä¸Šé¢çš„ä»£ç æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ<br>
RxJS åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿå¦‚ä½•è§£å†³å¼‚æ­¥ç»„åˆé—®é¢˜çš„ï¼Ÿ</p>
<h3 id="observable"><a class="header-anchor" href="#observable">#</a>Observable</h3>
<p>Rx æä¾›äº†ä¸€ç§å« <strong>Observable</strong> çš„æ•°æ®ç±»å‹ï¼Œå…¼å®¹ ECMAScript çš„ <a href="https://github.com/zenparsing/es-observable" target="_blank" rel="external">Observable Spec Proposal</a> è‰æ¡ˆæ ‡å‡†ã€‚ä»–æ˜¯ Rx æœ€æ ¸å¿ƒçš„æ•°æ®ç±»å‹ï¼Œç»“åˆäº† <a href="https://en.wikipedia.org/wiki/Observer_pattern" target="_blank" rel="external">Observer Pattern</a>ï¼Œ<a href="https://en.wikipedia.org/wiki/Iterator_pattern" target="_blank" rel="external">Iterator Pattern</a> ã€‚</p>
<p>é‚£åˆ°åº•ä»€ä¹ˆæ˜¯ Observable ï¼Ÿ</p>
<blockquote>
<p>Observable å…¶å®å°±æ˜¯ä¸€ä¸ª<strong>å¼‚æ­¥çš„æ•°ç»„</strong>ã€‚<em>( ===&gt; <a href="https://medium.com/@andrestaltz/2-minute-introduction-to-rx-24c8ca793877#.1q1q2mwgq" target="_blank" rel="external">2 minute introduction to rx</a> )</em></p>
</blockquote>
<p>ä¸å¦¨æƒ³åƒä¸€ä¸‹ï¼Œ<img class="emoji" draggable="false" alt="â­" src="https://twemoji.maxcdn.com/2/72x72/2b50.png"> <strong>æ•°ç»„ + æ—¶é—´è½´ == Observable</strong> <img class="emoji" draggable="false" alt="â­" src="https://twemoji.maxcdn.com/2/72x72/2b50.png"> ã€‚</p>
<p>æ•°ç»„å…ƒç´ çš„å€¼æ˜¯æœªæ¥æŸä¸ªæ—¶é—´ç‚¹ <em>emit</em> (äº§ç”Ÿ)çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å…³å¿ƒè¿™ä¸ªæ—¶é—´ç‚¹ï¼Œå› ä¸ºåˆ©ç”¨äº†ã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€<em>subscribe</em> (è®¢é˜…)äº†è¿™ä¸ªæ•°ç»„ï¼Œåªè¦ä»– <em>emit</em> äº†å€¼ï¼Œå°±ä¼šè‡ªåŠ¨ <em>push</em> ç»™æˆ‘ä»¬ã€‚</p>
<p>æˆ‘ä»¬å†ç”¨å›¾æ¥è¡¨ç¤ºä¸€ä¸‹çš„è¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">--a---b-c--d-----e--|--&gt;</div></pre></td></tr></table></figure>
<p>è¿™ç§å›¾å«åš <a href="http://reactivex.io/rxjs/manual/overview.html#marble-diagrams" target="_blank" rel="external">marble diagram</a> ã€‚<br>
æˆ‘ä»¬å¯ä»¥æŠŠ ASCII çš„ marble å›¾è½¬æˆ SVG çš„ï¼š<a href="https://jsbin.com/vumepol/1/edit?js,output" target="_blank" rel="external">ASCII -&gt; SVG</a> ã€‚</p>
<p><code>-</code> è¡¨ç¤ºæ—¶é—´è½´ï¼Œ<code>a</code> ~ <code>e</code> è¡¨ç¤º emit çš„å€¼ï¼Œ<code>|</code> åˆ™è¡¨ç¤ºè¿™ä¸ª stream å·²ç»ç»“æŸäº†ã€‚<br>
æ¯”æ–¹è¯´ï¼Œ<code>click</code> äº‹ä»¶ç”¨ä¸Šå›¾æ¥è¡¨ç¤ºï¼š<code>a</code> è¡¨ç¤ºç¬¬ 1 æ¬¡ç‚¹å‡»ï¼Œ<code>b</code> è¡¨ç¤ºç¬¬ 2 æ¬¡ç‚¹å‡»ï¼Œå¦‚æ­¤ç±»æ¨ã€‚</p>
<p>å¦‚æœä½ è§‰å¾— Observable è¿™ä¸ªåå­—ä¸å¤Ÿå½¢è±¡ä¸å¤Ÿ cool çš„è¯ï¼Œä½ å¯æŠŠä»–å«åš <a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754#reactive-programming-is-programming-with-asynchronous-data-streams" target="_blank" rel="external">stream</a> ï¼Œå› ä¸ºä»–çš„ marble å›¾å°±åƒ steam ä¸€æ ·ã€‚æ‰€ä»¥å•Šï¼Œä¸‹é¢æˆ‘éƒ½ä¼šæŠŠ <em>Observable</em> ç§°ä½œ <em>stream</em> ã€‚<img class="emoji" draggable="false" alt="âœŒï¸" src="https://twemoji.maxcdn.com/2/72x72/270c.png"></p>
<h3 id="operators"><a class="header-anchor" href="#operators">#</a>Operators</h3>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆå¯¹ stream è¿›è¡Œæ“ä½œå‘¢ï¼Ÿæ€ä¹ˆæŠŠå¤šä¸ª stream ç»„åˆåœ¨ä¸€èµ·å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å‰é¢ä¸æ˜¯è¯´äº†ã€Œ Observable å…¶å®å°±æ˜¯<em>å¼‚æ­¥æ•°ç»„</em>ã€å—ï¼Ÿåœ¨ JavaScript é‡Œçš„æ•°ç»„ä¸æ˜¯æœ‰å¾ˆå¤šå†…ç½®çš„æ–¹æ³•å—ï¼Ÿæ¯”å¦‚ <code>map</code>, <code>filter</code>, <code>reduce</code> ç­‰ç­‰ã€‚ç±»ä¼¼åœ°ï¼ŒObservable ä¹Ÿæœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ <a href="http://reactivex.io/rxjs/manual/overview.html#operators" target="_blank" rel="external">operator</a> ã€‚æ¯”å¦‚ä¸Šé¢ <a href="#rx-s-hello-world">Rxâ€™s Hello World</a> ä¾‹å­ä¸­çš„ <code>map</code>, <code>filter</code>, <code>throttleTime</code>, <code>distinctUntilChanged</code> ç­‰ç­‰å¾ˆå¤šå¾ˆæœ‰ç”¨çš„ operator ã€‚</p>
<p>é¢å¯¹ RxJS é‚£ä¹ˆå¤š operator ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆå­¦ä¹ å‘¢ï¼Ÿå¾ˆç®€å•ï¼š<img class="emoji" draggable="false" alt="ğŸ˜€" src="https://twemoji.maxcdn.com/2/72x72/1f600.png"></p>
<blockquote>
<p><a href="http://reactivex.io/rxjs/manual/overview.html#categories-of-operators" target="_blank" rel="external">åˆ†ç±»åˆ«</a> + <a href="http://reactivex.io/rxjs/manual/overview.html#marble-diagrams" target="_blank" rel="external">ç”» marble å›¾</a> + <a href="https://www.learnrxjs.io/operators/" target="_blank" rel="external">çœ‹ä¾‹å­</a> + <a href="http://reactivex.io/rxjs/manual/overview.html#choose-an-operator" target="_blank" rel="external">é€‰</a></p>
</blockquote>
<p>ç°åœ¨ï¼Œå°±è®©æˆ‘ä»¬ç”»å‡ºä¸Šé¢ Hello World ä¾‹å­çš„ marble å›¾ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> search$ = Observable.fromEvent(input, <span class="string">'input'</span>)</div><div class="line">  .map(e =&gt; e.target.value)</div><div class="line">  .filter(value =&gt; value.length &gt;= <span class="number">1</span>)</div><div class="line">  .throttleTime(<span class="number">100</span>)</div><div class="line">  .distinctUntilChanged()</div><div class="line">  .switchMap(term =&gt; Observable.fromPromise(wikiIt(term)))</div><div class="line">  .subscribe(</div><div class="line">    x =&gt; renderSearchResult(x),</div><div class="line">    err =&gt; <span class="built_in">console</span>.error(err)</div><div class="line">  )</div></pre></td></tr></table></figure>
<p>å‡è®¾è¾“å…¥äº† 5 æ¬¡ï¼Œæ¯æ¬¡è¾“å…¥çš„å€¼ä¸€æ¬¡ä¸ºï¼š<code>a</code>, <code>ab</code>, <code>c</code>, <code>d</code>, <code>c</code> ï¼Œå¹¶ä¸”ç¬¬ 3 æ¬¡è¾“å…¥çš„ <code>c</code> å’Œç¬¬ 4 æ¬¡çš„ <code>d</code> çš„æ—¶é—´é—´éš”å°‘äº <code>100ms</code> ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">---i--i---i-i-----i---|--&gt; (input)</div><div class="line">        map</div><div class="line"></div><div class="line">---a--a---c-d-----c---|--&gt;</div><div class="line">      b</div><div class="line">        filter</div><div class="line"></div><div class="line">---a--a---c-d-----c---|--&gt;</div><div class="line">      b</div><div class="line">      throttleTime</div><div class="line"></div><div class="line">---a--a---c-------c---|--&gt;</div><div class="line">      b</div><div class="line">  distinctUntilChanged</div><div class="line"></div><div class="line">---a--a---c----------|--&gt;</div><div class="line">      b</div><div class="line">    switchMap</div><div class="line"></div><div class="line">---x--y---z----------|--&gt;</div></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘å‘Šè¯‰ä½ å­¦ä¹  <strong>RxJS çš„æ·å¾„æ˜¯ã€Œå­¦ä¼šçœ‹å’Œç”» marble å›¾ã€</strong>ï¼Œä½ ä¿¡è¿˜æ˜¯ä¸ä¿¡ï¼Ÿ<img class="emoji" draggable="false" alt="ğŸ˜±" src="https://twemoji.maxcdn.com/2/72x72/1f631.png"></p>
<h2 id="learn-by-doing"><a class="header-anchor" href="#learn-by-doing">#</a>Learn By Doing</h2>
<p>ç°åœ¨ï¼Œå°±è®©æˆ‘ä»¬ç»“åˆä¸Šé¢çš„çŸ¥è¯†ï¼Œæ¥å®ç°ä¸€ä¸ªç®€å•çš„ canvas ç”»æ¿ã€‚</p>
<p>æ ¹æ® canvas çš„ <a href="http://devdocs.io/dom/canvasrenderingcontext2d/moveto" target="_blank" rel="external">API</a> ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸¤ä¸ªç‚¹çš„åæ ‡ï¼Œè¿™æ ·æ‰èƒ½ç”»å‡ºä¸€æ¡çº¿ã€‚</p>
<h3 id="step-1"><a class="header-anchor" href="#step-1">#</a>Step 1</h3>
<p><em>(æˆ‘è¦çœ‹ <a href="https://jsfiddle.net/DrakeLeung/a7h4wwcy/" target="_blank" rel="external">DEMO</a> )</em></p>
<p>é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦åšçš„æ˜¯<strong>åˆ›å»º</strong>ä¸€ä¸ªå…³äºé¼ æ ‡ç§»åŠ¨çš„ stream ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬<strong>å»æ–‡æ¡£æ‰¾å¯¹åº”çš„ operator ç±»åˆ«</strong>ï¼Œä¹Ÿå°±æ˜¯ <a href="http://jsbin.com/gakosun/edit?js,console,output" target="_blank" rel="external">Creation Operators</a> ï¼Œç„¶åå¾—åˆ°  <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#static-method-fromEvent" target="_blank" rel="external">fromEvent</a> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">'canvas'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> move$ = Rx.Observable.fromEvent(canvas, <span class="string">'mousemove'</span>)</div></pre></td></tr></table></figure>
<p>å¯¹åº”çš„ marble å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">--m1---m1-m2--m3----m4---|--&gt;  (mousemove)</div></pre></td></tr></table></figure>
<p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°æ¯æ¬¡é¼ æ ‡ç§»åŠ¨æ—¶çš„åæ ‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šéœ€è¦<strong>å˜æ¢</strong> stream ã€‚<br>
å¯¹åº”ç±»åˆ«çš„ operator æ–‡æ¡£ï¼š<a href="http://reactivex.io/rxjs/manual/overview.html#transformation-operators" target="_blank" rel="external">Transformation Operators</a> ===&gt; <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-map" target="_blank" rel="external">map</a> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> move$ = Rx.Observable.fromEvent(canvas, <span class="string">'mousemove'</span>)</div><div class="line">  .map(e =&gt; (&#123; x: e.offsetX, y: e.offsetX &#125;))</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„ marble å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">--m1---m2-m3--m4----m5---|--&gt;  (mousemove)</div><div class="line">        map</div><div class="line">--x1---x2-x3--x4----x5---|--&gt;  (ç‚¹åæ ‡)</div></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæ€ä¹ˆæ‹¿åˆ°ä¸¤ä¸ªç‚¹çš„åæ ‡å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦å†<strong>å˜æ¢</strong>ä¸€ä¸‹ stream ã€‚<br>
å¯¹åº”ç±»åˆ«çš„ operator æ–‡æ¡£ï¼š<a href="http://reactivex.io/rxjs/manual/overview.html#transformation-operators" target="_blank" rel="external">Transformation Operators</a> ===&gt; <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-bufferCount" target="_blank" rel="external">bufferCount</a> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> move$ = Rx.Observable.fromEvent(canvas, <span class="string">'mousemove'</span>)</div><div class="line">  .map(e =&gt; (&#123; x: e.offsetX, y: e.offsetY &#125;))</div><div class="line">  .bufferCount(<span class="number">2</span>)</div></pre></td></tr></table></figure>
<p>marble å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">--m1---m2-m3--m4----m5---|--&gt;  (mousemove)</div><div class="line">        map</div><div class="line"></div><div class="line">--x1---x2-x3--x4----x5---|--&gt;  (ç‚¹åæ ‡)</div><div class="line">      bufferCount(2)</div><div class="line"></div><div class="line">-------x1-----x3----x5---|---&gt; (ä¸¤ç‚¹åæ ‡)</div><div class="line">       x2     x4</div></pre></td></tr></table></figure>
<p>ç„¶åä½ ä¼šå‘ç°ï¼Œæ­¤æ—¶ç”»å‡ºæ¥çš„<a href="https://jsfiddle.net/DrakeLeung/a7h4wwcy/" target="_blank" rel="external">çº¿æ®µæ˜¯ä¸è¿ç»­çš„</a>ã€‚ä¸ºä»€ä¹ˆï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“ï¼ï¼<br>
é‚£å°±è®©æˆ‘ä»¬çœ‹çœ‹åˆ«äººæ˜¯æ€ä¹ˆå†™çš„å§ï¼š<a href="https://github.com/Reactive-Extensions/RxJS/blob/master/examples/canvaspaint/canvaspaint.js" target="_blank" rel="external">canvas paint</a> ã€‚</p>
<h3 id="step-2"><a class="header-anchor" href="#step-2">#</a>Step 2</h3>
<p><em>(æˆ‘è¦çœ‹ <a href="https://jsfiddle.net/DrakeLeung/vj368qy7/1/" target="_blank" rel="external">DEMO</a> )</em></p>
<p>æ¢äº†ä¸€ç§æ€è·¯ï¼Œå¹¶æ²¡æœ‰<strong>å˜æ¢</strong> stream ï¼Œè€Œæ˜¯æŠŠä¸¤ä¸ª stream <strong>ç»„åˆ</strong>åœ¨ä¸€èµ·ã€‚<br>
æŸ¥çœ‹æ–‡æ¡£  <a href="http://reactivex.io/rxjs/manual/overview.html#combination-operators" target="_blank" rel="external">Combination Operators</a> ===&gt; <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#static-method-zip" target="_blank" rel="external">zip</a> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> move$ = Rx.Observable.fromEvent(canvas, <span class="string">'mousemove'</span>)</div><div class="line">  .map(e =&gt; (&#123; x: e.offsetX, y: e.offsetY &#125;))</div><div class="line"></div><div class="line"><span class="keyword">const</span> diff$ = move$</div><div class="line">  .zip(move$.skip(<span class="number">1</span>), (first, sec) =&gt; ([ first, sec ]))</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„ marble å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">--x1---x2-x3--x4----x5---|--&gt;  (move$)</div><div class="line">        skip(1)</div><div class="line">-------x2-x3--x4----x5---|--&gt;  </div><div class="line"></div><div class="line"></div><div class="line">--x1---x2-x3--x4----x5---|--&gt;  (move$)</div><div class="line">-------x2-x3--x4----x5---|--&gt;  </div><div class="line">        zip</div><div class="line"></div><div class="line">-------x1-x2--x3----x4---|--&gt;  (diff$)</div><div class="line">       x2 x3  x4    x5</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œ<code>diff$</code> emit çš„å€¼å°±ä¾æ¬¡ä¸º <code>(x1, x2)</code>, <code>(x2, x3)</code>ï¼Œ<code>(x3, x4)</code> â€¦â€¦<br>
ç°åœ¨ï¼Œé¼ æ ‡ç§»åŠ¨çš„æ—¶å€™ï¼Œå°±å¯ä»¥<a href="https://jsfiddle.net/DrakeLeung/vj368qy7/1/" target="_blank" rel="external">ç”»å‡ºç¾ä¸½çš„çº¿æ¡</a>ã€‚</p>
<h3 id="step-3"><a class="header-anchor" href="#step-3">#</a>Step 3</h3>
<p><em>(æˆ‘è¦çœ‹ <a href="https://jsfiddle.net/DrakeLeung/vj368qy7/2/" target="_blank" rel="external">DEMO</a> )</em></p>
<p>å°±åœ¨æ­¤æ—¶æˆ‘æç„¶å¤§æ‚Ÿï¼Œç»ˆäºçŸ¥é“å‰é¢ç”¨ <code>bufferCount</code> ä¸ºä»€ä¹ˆä¸è¡Œäº†ã€‚æˆ‘ä»¬ä¸å¦¨æ¥æ¯”è¾ƒä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-------x1-----x3----x5---|---&gt; (bufferCount)</div><div class="line">       x2     x4</div><div class="line"></div><div class="line">-------x1-x2--x3----x4---|--&gt;  (diff$)</div><div class="line">       x2 x3  x4    x5</div></pre></td></tr></table></figure>
<p><code>bufferCount</code> emit çš„å€¼ä¾æ¬¡ä¸ºï¼š<code>(x1, x2)</code>ï¼Œ <code>(x3, x4)</code> â€¦â€¦ <code>x2</code> å’Œ <code>x3</code> ä¹‹é—´æ˜¯æœ‰é—´éš”çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆçº¿æ®µä¼šä¸è¿ç»­çš„åŸå› ã€‚</p>
<p>ç„¶åçœ‹ <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-bufferCount" target="_blank" rel="external">bufferCount</a> æ–‡æ¡£çš„è¯ï¼Œä½ ä¼šå‘ç°<strong>å¯ä»¥ä½¿ç”¨ <code>bufferCount(2, 1)</code> å®ç°åŒæ ·çš„æ•ˆæœ</strong>ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦ä½¿ç”¨ <code>zip</code> æ¥ç»„åˆä¸¤ä¸ª stream äº†ã€‚Cool ~ <img class="emoji" draggable="false" alt="ğŸ˜" src="https://twemoji.maxcdn.com/2/72x72/1f60e.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> move$ = Rx.Observable.fromEvent(canvas, <span class="string">'mousemove'</span>)</div><div class="line">  .map(e =&gt; (&#123; x: e.offsetX, y: e.offsetX &#125;))</div><div class="line">  .bufferCount(<span class="number">2</span>, <span class="number">1</span>)</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„ marble å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">--m1---m2-m3--m4----m5---|--&gt;  (mousemove)</div><div class="line">        map</div><div class="line"></div><div class="line">--x1---x2-x3--x4----x5---|--&gt;  (ç‚¹åæ ‡)</div><div class="line">      bufferCount(2, 1)</div><div class="line"></div><div class="line">-------x1-x2--x3----x4---|---&gt; (ä¸¤ç‚¹åæ ‡)</div><div class="line">       x2 x3  x4    x5</div></pre></td></tr></table></figure>
<h2 id="step-4"><a class="header-anchor" href="#step-4">#</a>Step 4</h2>
<p><em>(æˆ‘è¦çœ‹ <a href="https://jsfiddle.net/DrakeLeung/vj368qy7/3/" target="_blank" rel="external">DEMO</a> )</em></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æƒ³å®ç°ã€Œåªæœ‰é¼ æ ‡æŒ‰ä¸‹æ—¶ï¼Œæ‰èƒ½ç”»ç”»ï¼Œå¦åˆ™ä¸èƒ½ã€ã€‚<br>
é¦–å…ˆæˆ‘ä»¬éœ€è¦<strong>åˆ›å»º</strong>ä¸¤ä¸ªå…³äºé¼ æ ‡åŠ¨ä½œçš„ stream ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> down$ = Rx.Observable.fromEvent(canvas, <span class="string">'mousedown'</span>)</div><div class="line"><span class="keyword">const</span> up$ = Rx.Observable.fromEvent(canvas, <span class="string">'mouseup'</span>)</div></pre></td></tr></table></figure>
<p>å½“é¼ æ ‡æŒ‰ä¸‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»–<strong>å˜æ¢</strong>æˆé¼ æ ‡ç§»åŠ¨çš„ stream ï¼Œç›´åˆ°é¼ æ ‡æ”¾å¼€ã€‚<br>
æŸ¥çœ‹æ–‡æ¡£  <a href="http://reactivex.io/rxjs/manual/overview.html#transformation-operators" target="_blank" rel="external">Transformation Operators</a> ===&gt; <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-switchMapTo" target="_blank" rel="external">switchMapTo</a> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">down$.switchMapTo(move$)</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„ marble å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">--d---d-d-----d---d--|--&gt;  (mousedown)</div><div class="line">      switchMapTo</div><div class="line"></div><div class="line">--m---m-m-----m---m--|--&gt;</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œé¼ æ ‡æ”¾å¼€äº†æˆ‘ä»¬è¿˜èƒ½ç»§ç»­ç”»ç”»ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¾ˆå®¹æ˜“ä¼šä½¿ç”¨ <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-takeUntil" target="_blank" rel="external">takeUntil</a> è¿™ä¸ª operator ï¼Œä½†æ˜¯è¿™æ˜¯ä¸å¯¹çš„ï¼Œå› ä¸ºä»–ä¼šæŠŠ <em>stream</em> complete æ‰ã€‚</p>
<p>è¿˜æ˜¯è®©æˆ‘ä»¬çœ‹çœ‹åˆ«äººæ˜¯æ€ä¹ˆå†™çš„å§ï¼š<a href="https://github.com/Reactive-Extensions/RxJS/blob/master/examples/canvaspaint/canvaspaint.js" target="_blank" rel="external">canvas paint</a> ã€‚</p>
<h3 id="step-5"><a class="header-anchor" href="#step-5">#</a>Step 5</h3>
<p><em>(æˆ‘è¦çœ‹ <a href="https://jsfiddle.net/DrakeLeung/vj368qy7/4/" target="_blank" rel="external">DEMO</a> )</em></p>
<p>æ€è·¯æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p>
<p>æŠŠ <code>up$</code> å’Œ <code>down$</code> <strong>ç»„åˆ</strong>æˆä¸€ä¸ªæ–°çš„ stream ï¼Œä½†ä¸ºäº†åˆ†è¾¨ä»–ä»¬ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠä»–ä»¬<strong>å˜æ¢</strong>æˆæ–°çš„ stream ã€‚æŸ¥çœ‹æ–‡æ¡£ <a href="http://reactivex.io/rxjs/manual/overview.html#combination-operators" target="_blank" rel="external">Combination Operators</a> ===&gt; <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-merge" target="_blank" rel="external">merge</a> ã€‚<br>
<a href="http://reactivex.io/rxjs/manual/overview.html#transformation-operators" target="_blank" rel="external">Transformation Operators</a> ===&gt; <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-map" target="_blank" rel="external">map</a> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> down$ = Rx.Observable.fromEvent(canvas, <span class="string">'mousedown'</span>)</div><div class="line">  .map(() =&gt; <span class="string">'down'</span>)</div><div class="line"><span class="keyword">const</span> up$ = Rx.Observable.fromEvent(canvas, <span class="string">'mouseup'</span>)</div><div class="line">  .map(() =&gt; <span class="string">'up'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> upAndDown$ = up$.merge(down$)</div></pre></td></tr></table></figure>
<p>å†æ¥çœ‹çœ‹ä»–ä»¬çš„ marble å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">--d--d-d----d--d---|--&gt;  (down$)</div><div class="line">----u---u-u------u-|--&gt;  (up$)</div><div class="line">      merge</div><div class="line"></div><div class="line">--d-ud-du-u-d--d-u-|--&gt;  (upAndDown$)</div></pre></td></tr></table></figure>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å†<strong>å˜æ¢</strong> <code>upAndDown$</code> ã€‚å¦‚æœæ˜¯ <code>down</code> çš„è¯ï¼Œåˆ™å˜æ¢æˆ <code>move$</code> ï¼Œå¦åˆ™å˜æ¢æˆä¸€ä¸ªç©ºçš„ stream ã€‚</p>
<p>æŸ¥çœ‹æ–‡æ¡£ <a href="http://reactivex.io/rxjs/manual/overview.html#categories-of-operators" target="_blank" rel="external">Creation Operators</a> ===&gt; <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#static-method-empty" target="_blank" rel="external">empty</a> ã€‚<br>
<a href="http://reactivex.io/rxjs/manual/overview.html#transformation-operators" target="_blank" rel="external">Transformation Operators</a> ===&gt; <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-switchMap" target="_blank" rel="external">switchMap</a> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">upAndDown$</div><div class="line">  .switchMap(action =&gt;</div><div class="line">    action === <span class="string">'down'</span> ? move$ : Rx.Observable.empty()</div><div class="line">  )</div></pre></td></tr></table></figure>
<p>ä½ è¦çš„ marble å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">--d-ud-du-u-d--d-u-|--&gt;  (upAndDown$)</div><div class="line">    switchMap</div><div class="line"></div><div class="line">--m-em-me-e-m--m-e-|--&gt;</div></pre></td></tr></table></figure>
<p>å…¶å®è¿™ä¸ª canvas ç”»æ¿ä¸ç”¨ RxJS å®ç°ä¹Ÿä¸ä¼šå¾ˆéš¾ã€‚ä½†æ˜¯å½“æˆ‘ä»¬æŠŠä»–æ‰©å±•æˆä¸€ä¸ªã€Œä½ ç”»æˆ‘çŒœã€ä¹‹åï¼Œç”¨ RxJS å¤„ç†å¼‚æ­¥å°±ä¼šå˜å¾—ç®€å•èµ·æ¥ã€‚æ¯”å¦‚ï¼Œæ·»åŠ æ–°çš„å·¥å…·æ  ( è°ƒè‰²æ¿ï¼Œæ’¤é”€â€¦â€¦ ) ï¼Œå³æ—¶é€šä¿¡ ( åŒæ­¥ç”»æ¿ï¼ŒèŠå¤© ) â€¦â€¦ <img class="emoji" draggable="false" alt="ğŸ˜‚" src="https://twemoji.maxcdn.com/2/72x72/1f602.png"></p>
<p>å¦å¤–ï¼Œå¦‚æœä½ æƒ³è¾¹å­¦ä¹  RxJS è¾¹å®ç°ä¸€äº›å°ä¸œè¥¿çš„è¯ï¼š</p>
<ul>
<li><a href="https://github.com/staltz/rxjs-training" target="_blank" rel="external">staltz - rxjs training</a></li>
<li><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754" target="_blank" rel="external">GitHub - Who to Follow</a></li>
<li><a href="https://github.com/Reactive-Extensions/RxJS/tree/master/examples" target="_blank" rel="external">RxJS 4.x Example</a></li>
<li><a href="https://github.com/JayKan/RxJS-Playground" target="_blank" rel="external">RxJs Playground</a></li>
<li><a href="https://github.com/channikhabra/yarr" target="_blank" rel="external">Yet Another RSS Reader</a></li>
<li><a href="https://medium.com/front-end-hacking/rx-ifying-a-chat-room-built-with-reactjs-and-socket-io-459156b7d7ab#.bw55b1xqj" target="_blank" rel="external">rx-ifying a chat room built with reactjs and socket io</a></li>
<li><a href="https://github.com/hdjirdeh/angular2-hn" target="_blank" rel="external">angular2-hacknews</a></li>
</ul>
<h2 id="production"><a class="header-anchor" href="#production">#</a>Production</h2>
<p>æ€ä¹ˆæŠŠ RxJS åº”ç”¨åˆ°å®é™…ç”Ÿäº§çš„ web åº”ç”¨å½“ä¸­å‘¢ï¼Ÿ<br>
æ€ä¹ˆç»“åˆåˆ°å½“å‰æµè¡Œçš„æ¡†æ¶å½“ä¸­å‘¢ï¼Ÿ</p>
<h3 id="vue"><a class="header-anchor" href="#vue">#</a>Vue</h3>
<p>ä½ å¯ä»¥ç›´æ¥åœ¨å„ç§ <a href="http://vuejs.org/api/#Options-Lifecycle-Hooks" target="_blank" rel="external">Lifecycle Hooks</a> ä¸­ä½¿ç”¨ RxJS ã€‚</p>
<p>æ¯”å¦‚ <code>created</code> çš„æ—¶å€™åˆå§‹åŒ–ä¸€ä¸ª Observable ï¼Œ<code>beforeDestroy</code> æ—¶å°±å–æ¶ˆè®¢é˜… Observable ã€‚(æŸ¥çœ‹<a href="http://jsbin.com/cafodu/edit?html,js,output" target="_blank" rel="external"> DEMO </a>)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Vue(&#123;</div><div class="line">  el: <span class="string">'#app'</span>,</div><div class="line">  data: &#123;</div><div class="line">    time: <span class="string">''</span></div><div class="line">  &#125;,</div><div class="line">  </div><div class="line">  created () &#123;</div><div class="line">    <span class="keyword">this</span>.timer$ = Rx.Observable.interval(<span class="number">1000</span>)</div><div class="line">      .map(() =&gt; <span class="keyword">new</span> <span class="built_in">Date</span>())</div><div class="line">      .map(d =&gt; moment(d).format(<span class="string">'hh:mm:ss'</span>))</div><div class="line">      .subscribe(t =&gt; &#123;</div><div class="line">        <span class="keyword">this</span>.time = t</div><div class="line">      &#125;)</div><div class="line">  &#125;,</div><div class="line">  </div><div class="line">  beforeDestroy () &#123;</div><div class="line">    <span class="keyword">this</span>.timer$.unsubscribe()</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>å…¶å®å·²ç»æœ‰å¯¹åº”çš„æ’ä»¶ <a href="https://github.com/vuejs/vue-rx" target="_blank" rel="external">vue-rx</a> å¸®æˆ‘ä»¬å¹²äº†ä¸Šé¢çš„ dirty work ã€‚ä»–ä¼šåˆ†åˆ«åœ¨ <code>init</code> å’Œ <code>beforeDestroy</code> çš„æ—¶å€™è‡ªåŠ¨åœ°è®¢é˜…å’Œå–æ¶ˆè®¢é˜… Observable ï¼š<a href="https://github.com/vuejs/vue-rx/blob/master/vue-rx.js#L22-L51" target="_blank" rel="external">Vue.js + RxJS binding mixin in 20 lines</a> ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠä¸€ä¸ª Observable å†™åˆ° <code>data</code> ä¸­ï¼š<a href="https://github.com/vuejs/vue-rx/blob/master/example/example.html#L26-L65" target="_blank" rel="external">vue-rx/example.html</a> ã€‚</p>
<h3 id="react"><a class="header-anchor" href="#react">#</a>React</h3>
<p>ç±»ä¼¼åœ°ï¼ŒReact ä¹Ÿå¯ä»¥åœ¨ä»–ç»„ä»¶çš„ <a href="https://facebook.github.io/react/docs/component-specs.html#lifecycle-methods" target="_blank" rel="external">lifecycle hooks</a> é‡Œè°ƒç”¨ RxJSï¼š<a href="https://github.com/belfz/fully-reactive-react-example" target="_blank" rel="external">fully-reactive-react</a> ã€‚<br>
ä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="https://github.com/christianalfoni/rxjs-react-component" target="_blank" rel="external">rxjs-react-component</a> æŠŠ Observable ç»‘å®šåˆ° <code>state</code> ã€‚<br>
å¦‚æœä½ ç»“åˆ Redux çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª <a href="https://github.com/redux-observable/redux-observable" target="_blank" rel="external">redux-oservable</a> ã€‚</p>
<h3 id="angular2"><a class="header-anchor" href="#angular2">#</a>Angular2</h3>
<p>RxJS å·²ç»æ˜¯ Angular2 çš„æ ‡é…ï¼Œä¸å¤šè¯´ã€‚<br>
æ›´å¤šå¯æŸ¥çœ‹å¯¹åº”çš„æ–‡æ¡£ <a href="https://angular.io/docs/ts/latest/guide/server-communication.html#!#rxjs" target="_blank" rel="external">Angular2 - Server Communication</a> ã€‚</p>
<p>æ›´å¤šå…³äº RxJS çš„é›†æˆï¼š<a href="https://github.com/Reactive-Extensions/RxJS/blob/master/examples/community.md" target="_blank" rel="external">RxJS community</a> ã€‚</p>
<h2 id="you-might-not-need-rxjs"><a class="header-anchor" href="#you-might-not-need-rxjs">#</a>You Might Not Need RxJS</h2>
<p>æ ¹æ® <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/designguidelines/readme.md#21-use-rxjs-for-orchestrating-asynchronous-and-event-based-computations" target="_blank" rel="external">When to Use RxJS</a> ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ RxJS çš„é€‚ç”¨åœºæ™¯æ˜¯ï¼š</p>
<ul>
<li>å¤šä¸ªå¤æ‚çš„å¼‚æ­¥æˆ–è€…äº‹ä»¶ç»„åˆåœ¨ä¸€èµ·</li>
<li>å¤„ç†å¤šä¸ªæ•°æ®åºåˆ—ï¼ˆæœ‰ä¸€å®šé¡ºåºï¼‰</li>
</ul>
<p>æˆ‘è§‰å¾—ï¼Œå¦‚æœä½ æ²¡è¢«å¼‚æ­¥é—®é¢˜å›°æ‰°çš„è¯ï¼Œé‚£å°±ä¸è¦ä½¿ç”¨ RxJS å§ï¼Œå› ä¸º Promise å·²ç»èƒ½å¤Ÿè§£å†³ç®€å•çš„å¼‚æ­¥é—®é¢˜äº†ã€‚è‡³äº Promise å’Œ Observable çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ<a href="https://www.google.com.hk/search?q=promise+vs+observable" target="_blank" rel="external">Promise VS Observable</a> ã€‚</p>
<p>è®²çœŸï¼Œ<strong>RxJS åœ¨å®é™…ç”Ÿäº§ä¸­é€‚ç”¨çš„ä¸šåŠ¡åœºæ™¯æœ‰å“ªäº›</strong>ï¼Ÿå“ªäº›åœºæ™¯æ˜¯éœ€è¦å¤šä¸ªå¼‚æ­¥ç»„åˆåœ¨ä¸€èµ·çš„ï¼Ÿæ¸¸æˆå—ï¼Ÿå³æ—¶é€šä¿¡ï¼Ÿè¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„ä¸šåŠ¡ã€‚æ˜¯æˆ‘çš„å†™çš„ä¸šåŠ¡å¤ªå°‘äº†å—ï¼Ÿè¿˜æ˜¯æˆ‘å¹³æ—¶å†™ä¸šåŠ¡çš„æ—¶å€™ï¼Œä¸ºå†™è€Œå†™ï¼Œæ²¡æœ‰æŠŠä»–ä»¬æŠ½è±¡èµ·æ¥ã€‚<img class="emoji" draggable="false" alt="ğŸ˜³" src="https://twemoji.maxcdn.com/2/72x72/1f633.png"></p>
<p>å¦å¤–ï¼Œæˆ‘å€’æ˜¯å¯¹ Teambition å…³äº RxJS çš„æ€è·¯æœ‰ç‚¹æ„Ÿå…´è¶£ï¼š<em><a href="https://github.com/xufei/blog/issues/36#issuecomment-246662343" target="_blank" rel="external">xufei - æ•°æ®çš„å…³è”è®¡ç®— -&gt; Brooooooklyn è¯„è®º</a></em> &amp; <a href="https://github.com/xufei/blog/issues/37" target="_blank" rel="external">xufei - å¯¹å½“å‰å•é¡µåº”ç”¨çš„æŠ€æœ¯æ ˆæ€è€ƒ</a>ã€‚</p>
<h2 id="summary"><a class="header-anchor" href="#summary">#</a>Summary</h2>
<ul>
<li><img class="emoji" draggable="false" alt="ğŸ³" src="https://twemoji.maxcdn.com/2/72x72/1f433.png"> RxJS æ˜¯ç”¨æ¥è§£å†³å¼‚æ­¥å’Œäº‹ä»¶ç»„åˆé—®é¢˜</li>
<li><img class="emoji" draggable="false" alt="ğŸŠ" src="https://twemoji.maxcdn.com/2/72x72/1f3ca.png"> Observable == <a href="https://medium.com/@andrestaltz/2-minute-introduction-to-rx-24c8ca793877#.1q1q2mwgq" target="_blank" rel="external">å¼‚æ­¥æ•°ç»„</a> == æ•°ç»„ + æ—¶é—´è½´ == stream</li>
<li><img class="emoji" draggable="false" alt="â™¥ï¸" src="https://twemoji.maxcdn.com/2/72x72/2665.png"> Operators ==  <a href="http://reactivex.io/rxjs/manual/overview.html#categories-of-operators" target="_blank" rel="external">åˆ†ç±»åˆ«</a> + <a href="http://reactivex.io/rxjs/manual/overview.html#marble-diagrams" target="_blank" rel="external">ç”» marble å›¾</a> + <a href="https://www.learnrxjs.io/operators/" target="_blank" rel="external">çœ‹ä¾‹å­</a> + <a href="http://reactivex.io/rxjs/manual/overview.html#choose-an-operator" target="_blank" rel="external">é€‰</a></li>
<li><img class="emoji" draggable="false" alt="ğŸ‘" src="https://twemoji.maxcdn.com/2/72x72/1f44d.png"> <strong>æ›´å¤šæ›´è¯¦ç»†çš„æ›´å‡†ç¡®çš„è¯·çœ‹<a href="http://reactivex.io/rxjs/" target="_blank" rel="external">æ–‡æ¡£</a>ï¼</strong></li>
</ul>
<p>è®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹  RxJS å§ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™æ˜¯ä¸€ç¯‡ RxJS åˆå­¦è€…æ•™ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;what-is-rxjs&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#what-is-rxjs&quot;&gt;#&lt;/a&gt;What Is RxJS&lt;/h2&gt;
&lt;p&gt;é€šè¿‡&lt;strong&gt;é˜…è¯»&lt;a href=&quot;h
    
    </summary>
    
    
      <category term="RxJS" scheme="http://drakeleung.github.io/blog/tags/RxJS/"/>
    
  </entry>
  
  <entry>
    <title>Node.js ä¹‹å•å…ƒæµ‹è¯•</title>
    <link href="http://drakeleung.github.io/blog/2016/09/08/unit-test-4-your-nodejs-app/"/>
    <id>http://drakeleung.github.io/blog/2016/09/08/unit-test-4-your-nodejs-app/</id>
    <published>2016-09-08T13:44:07.000Z</published>
    <updated>2016-09-17T18:01:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="setup-node-js-app"><a class="header-anchor" href="#setup-node-js-app">#</a>Setup Node.js App</h2>
<p>( <strong>å¦‚æœå·²ç»å»ºå¥½äº† Node.js åº”ç”¨ï¼Œå¯ç›´æ¥è·³åˆ° <a href="#start-unit-test">ä¸‹ä¸€ä¸ªéƒ¨åˆ† - Start Unit Test</a></strong> )</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <a href="https://github.com/koajs/koa" target="_blank" rel="external">koa</a>, <a href="http://mongoosejs.com" target="_blank" rel="external">mongoose</a> , <a href="https://github.com/lorenwest/node-config/" target="_blank" rel="external">config</a> åˆå§‹åŒ–æˆ‘ä»¬çš„é¡¹ç›®ã€‚<br>
å®Œæ•´ä»£ç å¯æŸ¥çœ‹ <img class="emoji" draggable="false" alt="ğŸ‘‰" src="https://twemoji.maxcdn.com/2/72x72/1f449.png"> <a href="">è¿™é‡Œ</a>ã€‚</p>
<p>é¦–å…ˆæ˜¯æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶: <code>src/app.js</code> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/app.js</span></div><div class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'koa'</span>)()</div><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div><div class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'config'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'./router'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> &#123; mongo &#125; = config</div><div class="line"><span class="keyword">const</span> url = <span class="string">`mongodb://<span class="subst">$&#123;mongo.host&#125;</span>:<span class="subst">$&#123;mongo.port&#125;</span>/<span class="subst">$&#123;mongo.db&#125;</span>`</span></div><div class="line">mongoose.Promise = global.Promise</div><div class="line">mongoose.connect(url)</div><div class="line"></div><div class="line">app.use(router.routes())</div><div class="line"></div><div class="line">app.on(<span class="string">'error'</span>, err =&gt; <span class="built_in">console</span>.error(<span class="string">'onError'</span>, err))</div><div class="line">app.listen(config.port, () =&gt; <span class="built_in">console</span>.log(<span class="string">`listening port <span class="subst">$&#123;config.port&#125;</span>`</span>))</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = app</div></pre></td></tr></table></figure>
<p>æ¥ç€æ˜¯æˆ‘ä»¬çš„è·¯ç”±æ–‡ä»¶ï¼š<code>src/router.js</code> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/router.js</span></div><div class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)()</div><div class="line"></div><div class="line"><span class="keyword">const</span> heroCtrl = <span class="built_in">require</span>(<span class="string">'./apis/hero/hero.ctrl'</span>)</div><div class="line"></div><div class="line">router.get(<span class="string">'/api/hero'</span>, heroCtrl.getHeroes)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = router</div></pre></td></tr></table></figure>
<p>ç„¶åå‘¢æ˜¯æˆ‘ä»¬çš„æ¥å£æ–‡ä»¶ï¼š<code>src/api/hero/hero.model.js</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/api/hero/hero.model.js</span></div><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'hero'</span>, &#123;</div><div class="line">  name: <span class="built_in">String</span>,</div><div class="line">  skills: [<span class="built_in">String</span>],</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>ä»¥åŠå…¶å¯¹åº”çš„ controller: <code>src/api/hero/hero.ctrl.js</code> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// src/api/hero/hero.ctrl.js</span></div><div class="line"><span class="keyword">const</span> heroModel = <span class="built_in">require</span>(<span class="string">'./hero.model'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> getHeroes = <span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">const</span> hero = <span class="keyword">yield</span> heroModel.find(&#123;&#125;)</div><div class="line">    <span class="keyword">this</span>.body = hero</div><div class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    <span class="keyword">this</span>.throw(<span class="number">404</span>, e)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  getHeroes,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸ºäº†åœ¨ä¸åŒçš„å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <a href="https://github.com/lorenwest/node-config/" target="_blank" rel="external">config</a> è¿™ä¸ªåŒ…ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// config/default.json</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"hero-dev"</span>,</div><div class="line">  <span class="string">"port"</span>: <span class="number">3000</span>,</div><div class="line">  <span class="string">"mongo"</span>: &#123;</div><div class="line">    <span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>,</div><div class="line">    <span class="string">"db"</span>: <span class="string">"hero-dev"</span>,</div><div class="line">    <span class="string">"port"</span>: <span class="number">27017</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åï¼Œæˆ‘ä»¬æ•´ä¸ª <code>package.json</code> æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"unit-test-for-nodejs-app"</span>,</div><div class="line">  <span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</div><div class="line">  <span class="string">"description"</span>: <span class="string">"unit test for nodejs app"</span>,</div><div class="line">  <span class="string">"main"</span>: <span class="string">"app.js"</span>,</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"dev"</span>: <span class="string">"nodemon app.js"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"keywords"</span>: [</div><div class="line">    <span class="string">"unit-test"</span>,</div><div class="line">    <span class="string">"nodejs"</span></div><div class="line">  ],</div><div class="line">  <span class="string">"author"</span>: <span class="string">"Drake Leung"</span>,</div><div class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span>,</div><div class="line">  <span class="string">"dependencies"</span>: &#123;</div><div class="line">    <span class="string">"config"</span>: <span class="string">"^1.21.0"</span>,</div><div class="line">    <span class="string">"koa"</span>: <span class="string">"^1.2.4"</span>,</div><div class="line">    <span class="string">"koa-router"</span>: <span class="string">"^5.4.0"</span>,</div><div class="line">    <span class="string">"mongodb"</span>: <span class="string">"^2.2.9"</span>,</div><div class="line">    <span class="string">"mongoose"</span>: <span class="string">"^4.6.0"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»ˆç«¯æ‰§è¡Œ <code>npm run dev</code> ä¾¿å¯ä»¥å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ã€‚<br>
ç„¶åè®¿é—®æ¥å£ï¼š<code>localhost:3000/api/hero</code>ï¼Œä¼šè¿”å› <code>[]</code> ï¼Œå› ä¸ºæ•°æ®åº“é‡Œè¿˜æ²¡æœ‰æ•°æ®ã€‚</p>
<h2 id="start-unit-test"><a class="header-anchor" href="#start-unit-test">#</a>Start Unit Test</h2>
<p>åœ¨å¼€å§‹å†™æµ‹è¯•ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹Ÿè®¸ä¼šæƒ³åˆ°å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å¦‚ä½•æ¨¡æ‹Ÿè®¿é—®ä¸€ä¸ªæ¥å£ã€‚</li>
<li>æ¥å£è¿”å›çš„æ•°æ®å“ªé‡Œæ¥ã€‚</li>
<li>æ¥å£è®¿é—®æœ‰æƒé™æ§åˆ¶æ€ä¹ˆåŠã€‚</li>
</ul>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ç”¨åˆ° <a href="https://github.com/mochajs/mocha" target="_blank" rel="external">mocha</a>, <a href="https://github.com/chaijs/chai" target="_blank" rel="external">chai</a> æ¥å†™æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ã€‚<br>
( åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªè®¨è®ºå¦‚ä½•å†™æµ‹è¯•ï¼Œè€Œä¸è®¨è®ºå„ç§æµ‹è¯•æ¡†æ¶çš„ä¼˜åŠ£ã€‚)</p>
<p>é¦–å…ˆï¼Œå®‰è£…ä¾èµ–ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i -D mocha chai</div></pre></td></tr></table></figure>
<p>æ¥ç€ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ <code>test</code> ã€‚<br>
æ–°å»ºä¸€ä¸ªæ–‡ä»¶ <code>index.js</code> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// test/index.js</span></div><div class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>)</div><div class="line"><span class="keyword">const</span> expect = chai.expect</div><div class="line"></div><div class="line">describe(<span class="string">'root app'</span>, () =&gt; &#123;</div><div class="line">  it(<span class="string">'should be ok'</span>, () =&gt; &#123;</div><div class="line">    expect(<span class="number">42</span>).to.be.exist</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>ç„¶åç»™æˆ‘ä»¬çš„ <code>package.json</code> æ·»åŠ ä¸€ä¸ª <code>script</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"script"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"mocha"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åæˆ‘ä»¬æ‰§è¡Œ <code>npm test</code> ï¼Œå°±å¯ä»¥çœ‹åˆ°æµ‹è¯•ç»“æœå•¦ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼Œè§£å†³æ‰ä¸Šé¢è®²åˆ°çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>å¦‚ä½•æ¨¡æ‹Ÿè®¿é—®ä¸€ä¸ªæ¥å£ï¼Œæ¯”å¦‚ï¼š<code>/api/hero</code>ã€‚</p>
</blockquote>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° <a href="https://github.com/visionmedia/supertest" target="_blank" rel="external">supertest</a> ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i -S supertest</div></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œå°±è®©æˆ‘ä»¬å…ˆæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼š<code>test/apis/hero/hero.spec.js</code> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> expect = <span class="built_in">require</span>(<span class="string">'chai'</span>).expect</div><div class="line"><span class="keyword">const</span> supertest = <span class="built_in">require</span>(<span class="string">'supertest'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> heroModel = <span class="built_in">require</span>(<span class="string">'../../../src/apis/hero/hero.model'</span>)</div><div class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'../../../src/app'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> req = supertest(app.listen())</div><div class="line"></div><div class="line">describe(<span class="string">'hero model'</span>, () =&gt; &#123;</div><div class="line">  describe(<span class="string">'GET /api/hero'</span>, () =&gt; &#123;</div><div class="line">    it(<span class="string">'should return all heros'</span>, done =&gt; &#123;</div><div class="line">      req.get(<span class="string">'/api/hero'</span>)</div><div class="line">        .expect(<span class="number">200</span>)</div><div class="line">        .expect(&#123; body &#125; =&gt; &#123;</div><div class="line">          expect(body).to.be([<span class="number">1</span>, <span class="number">2</span>])</div><div class="line">        &#125;, done)</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>æ¥ç€ä¿®æ”¹ <code>package.json</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"scripts"</span>: &#123;</div><div class="line">    <span class="string">"test"</span>: <span class="string">"mocha test/**/*.spec.js"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥çš„æ˜¯é—®é¢˜ï¼š</p>
<blockquote>
<p>æ¥å£è¿”å›çš„æ•°æ®å“ªé‡Œæ¥ï¼Ÿ</p>
</blockquote>
<p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯èƒ½çš„é—®é¢˜æ˜¯ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬çš„æ¥å£é¦–å…ˆä¼šé€šè¿‡ã€Œæƒé™ç›¸å…³ã€çš„ä¸­é—´ä»¶ï¼Œæ€ä¹ˆç»•è¿‡ä»–ä»¬ï¼Ÿ</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;setup-node-js-app&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#setup-node-js-app&quot;&gt;#&lt;/a&gt;Setup Node.js App&lt;/h2&gt;
&lt;p&gt;( &lt;strong&gt;å¦‚æœå·²ç»å»ºå¥½äº† Node.js åº”ç”¨ï¼Œå¯ç›´
    
    </summary>
    
    
      <category term="nodejs" scheme="http://drakeleung.github.io/blog/tags/nodejs/"/>
    
      <category term="testing" scheme="http://drakeleung.github.io/blog/tags/testing/"/>
    
      <category term="koa" scheme="http://drakeleung.github.io/blog/tags/koa/"/>
    
      <category term="mocha" scheme="http://drakeleung.github.io/blog/tags/mocha/"/>
    
      <category term="supertest" scheme="http://drakeleung.github.io/blog/tags/supertest/"/>
    
  </entry>
  
  <entry>
    <title>fetch api ç”¨èµ·æ¥ï¼</title>
    <link href="http://drakeleung.github.io/blog/2016/08/15/fetch-api-now/"/>
    <id>http://drakeleung.github.io/blog/2016/08/15/fetch-api-now/</id>
    <published>2016-08-14T16:16:49.000Z</published>
    <updated>2016-09-08T11:11:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æŠŠ vue-resource ç æ‰ï¼Œæ¢æˆäº† <a href="http://devdocs.io/dom/globalfetch/fetch" target="_blank" rel="external">fetch</a> ã€‚<br>
ç„¶è€Œï¼Œä»£ç ä½“ç§¯åœ¨ build ä¹‹ååªæ˜¯å°‘äº† 2K =ã€‚=</p>
<p>ä¸ºäº†å…¼å®¹æ—§æµè§ˆå™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªçš„ polyfill : <a href="https://github.com/github/fetch" target="_blank" rel="external">whatwg-fetch</a> ï¼›å¦‚æœè¿˜æƒ³å…¼å®¹ node çš„è¯ï¼š<a href="https://github.com/matthew-andrews/isomorphic-fetch" target="_blank" rel="external">isomorphic-fetch</a> ã€‚å®‰è£…è¯·çœ‹å¯¹åº”çš„æ–‡æ¡£ã€‚</p>
<h2 id="fetch-api"><a class="header-anchor" href="#fetch-api">#</a>fetch api</h2>
<p>æœ€ç®€å•çš„ <code>fetch</code> æ¥å£æ˜¯ä¸‹é¢è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * fetch</div><div class="line"> *</div><div class="line"> * @param &#123;string&#125; url </div><div class="line"> * @param &#123;object&#125; config</div><div class="line"> * @return &#123;promise&#125;</div><div class="line">*/</div><div class="line">fetch('/api/heros/, &#123;</div><div class="line">  method: 'GET',</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>æ›´è¯¦æƒ…çš„è¯·çœ‹æ–‡æ¡£å•¦ï¼š<a href="http://devdocs.io/dom/globalfetch/fetch" target="_blank" rel="external">globalfetch.fetch</a> ã€‚</p>
<h2 id="å¸¸ç”¨ä¾‹å­"><a class="header-anchor" href="#å¸¸ç”¨ä¾‹å­">#</a>å¸¸ç”¨ä¾‹å­</h2>
<p>çœ‹è¿™ä¸ªï¼š<a href="https://github.com/github/fetch#usage" target="_blank" rel="external">fetch - usage</a> ã€‚</p>
<h2 id="å¯èƒ½é‡åˆ°çš„å‘"><a class="header-anchor" href="#å¯èƒ½é‡åˆ°çš„å‘">#</a>å¯èƒ½é‡åˆ°çš„å‘</h2>
<ul>
<li>ä¸å‘é€ cookie</li>
<li>ä¸ catch 404 æˆ–è€… 500 ç­‰ HTTP é”™è¯¯çŠ¶æ€ç ã€‚</li>
</ul>
<p>è§£å†³åŠæ³•å¯ä»¥æŸ¥çœ‹ <a href="https://github.com/github/fetch#caveats" target="_blank" rel="external">fetch - caveats</a> ã€‚</p>
<h2 id="æ‹¦æˆªå™¨"><a class="header-anchor" href="#æ‹¦æˆªå™¨">#</a>æ‹¦æˆªå™¨</h2>
<p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨æ¯ä¸ªè¯·æ±‚ä¹‹å‰æˆ–è€…ä¹‹åè¿›è¡ŒæŸäº›æ“ä½œçš„è¯ï¼Œå°±éœ€è¦ç”¨åˆ°æ‹¦æˆªå™¨å•¦ã€‚<br>
ä¸‹é¢æˆ‘ä»¬ç”¨åˆ°çš„æ˜¯æ‹¦æˆªå™¨æ˜¯ <a href="https://github.com/werk85/fetch-intercept" target="_blank" rel="external">fetch-intercept</a> ã€‚å¯ä»¥å»çœ‹çœ‹æºç ï¼Œåªæœ‰ 80 è¡Œä¸åˆ°ï¼Œè¶…çº§ä¼˜ç¾çš„ä»£ç ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³æ¯ä¸ªè¯·æ±‚éƒ½å‘é€ cookie çš„è¯ï¼Œå°±å¿…é¡»è¦è®¾ç½® <a href="https://github.com/github/fetch#sending-cookies" target="_blank" rel="external">credentials</a> ã€‚ä½†æ˜¯æˆ‘ä¸æƒ³æ¯ä¸ªè¯·æ±‚éƒ½è®¾ç½®ä¸€éï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°æ‹¦æˆªå™¨å•¦ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> fetchIntercept</div><div class="line"></div><div class="line">fetchIntercept.register(&#123;</div><div class="line">  request(url, config = &#123;&#125;) &#123;</div><div class="line">    <span class="keyword">const</span> myConf = &#123;</div><div class="line">      credentials: <span class="string">'include'</span>, <span class="comment">// send cookie</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> [</div><div class="line">      url,</div><div class="line">      defaults(config, myConf), <span class="comment">// merge 2 objects</span></div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–è¯·æ±‚çš„ URL ã€‚æ¯”å¦‚è¯´ï¼Œ</p>
<ul>
<li><code>/rootHost/api/heros/</code></li>
<li><code>/rootHost/api/coolBoys/</code></li>
</ul>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æŠŠ <code>/rootHost/api/</code> æå–å‡ºæ¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">fetchIntercept.register(&#123;</div><div class="line">  request(url, config = &#123;&#125;) &#123;</div><div class="line">    <span class="keyword">return</span> [</div><div class="line">     <span class="string">`<span class="subst">$&#123;apiHost()&#125;</span>/api/<span class="subst">$&#123;url&#125;</span>,</span></div><div class="line">     config,</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">&#125;)</div><div class="line"></div><div class="line">fetch('heros/')</div><div class="line">fetch('coolBoys/')</div></pre></td></tr></table></figure>
<p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åœ¨ GET è¯·æ±‚æ—¶å¸¦çš„ query string ã€‚</p>
<p>å¦å¤–ï¼Œå› ä¸º fetch ä¸ä¼š catch 404 ç­‰é”™è¯¯ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fetchIntercept.register(&#123;</div><div class="line">  response(res) &#123;</div><div class="line">    <span class="keyword">if</span> (res.status &gt;= <span class="number">200</span> &amp;&amp; res.status &lt; <span class="number">300</span>) <span class="keyword">return</span> res</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(res.statusText)</div><div class="line">  &#125;,</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†æ‹¦æˆªå™¨ä¹‹åï¼Œæˆ‘ä»¬çš„ä»£ç å°±å˜å¾—ä¼˜ç¾å¤šäº† <img class="emoji" draggable="false" alt="ğŸ˜ƒ" src="https://twemoji.maxcdn.com/2/72x72/1f603.png"></p>
<h2 id="see-also"><a class="header-anchor" href="#see-also">#</a>See Also</h2>
<ul>
<li><a href="https://github.com/github/fetch" target="_blank" rel="external">whatwg-fetch</a></li>
<li><a href="https://github.com/matthew-andrews/isomorphic-fetch" target="_blank" rel="external">isomorphic-fetch</a></li>
<li><a href="https://github.com/werk85/fetch-intercept" target="_blank" rel="external">fetch-intercept</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æŠŠ vue-resource ç æ‰ï¼Œæ¢æˆäº† &lt;a href=&quot;http://devdocs.io/dom/globalfetch/fetch&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;fetch&lt;/a&gt; ã€‚&lt;br&gt;
ç„¶è€Œï¼Œä»£ç ä½“ç§¯åœ¨ build ä¹‹
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>æœ‰è¶£çš„ Nginx</title>
    <link href="http://drakeleung.github.io/blog/2016/08/11/Oh-My-Nginx/"/>
    <id>http://drakeleung.github.io/blog/2016/08/11/Oh-My-Nginx/</id>
    <published>2016-08-10T16:53:50.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºåœ¨å¼€å‘é¡¹ç›®çš„æ—¶å€™ç”¨åˆ°äº† <code>nginx</code> ï¼Œè§‰å¾—æŒºä¸é”™çš„ï¼Œæ‰€ä»¥äº†è§£äº†ä¸€ä¸‹ã€‚</p>
<p>ä¸€ä¸ªé¡¹ç›®çš„å¼€å‘ç¯å¢ƒä¸€èˆ¬éƒ½ä¼šåˆ†ä¸º4ä¸ªé˜¶æ®µã€‚</p>
<ul>
<li>test(local): æœ¬åœ°</li>
<li>alpha</li>
<li>beta</li>
<li>production</li>
</ul>
<p>æ¯ä¸ªç¯å¢ƒä¸‹ï¼Œå‰ç«¯çš„åŸŸåæ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸”è°ƒç”¨åå°æ¥å£çš„ <code>url</code> ä¹Ÿæ˜¯ä¸åŒçš„ã€‚å‡è®¾æˆ‘ä»¬çš„é¡¹ç›®åå­—å«åš <code>toon</code>ï¼Œå¹¶ä¸” root domain æ˜¯ <code>lyyourc.com</code>ï¼Œé‚£ä¹ˆå°±æœ‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># å‰ç«¯4ä¸ªç¯å¢ƒä¸‹çš„åŸŸå</span></div><div class="line">-  <span class="built_in">test</span>: toon.test.lyyourc.net</div><div class="line">- alpha: toon.alpha.lyyourc.net</div><div class="line">-  beta: toon.alpha.lyyourc.net</div><div class="line">-  prod: toon.lyyourc.com</div><div class="line"></div><div class="line"><span class="comment"># åå°æ¥å£</span></div><div class="line">-  alpha: toon-api.alpha.lyyourc.net</div><div class="line">-   beta: toon-api..beta.lyyourc.net</div><div class="line">-   prod: toon-api.lyyourc.com</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•ï¼š</p>
<blockquote>
<p>ä¸åŒç¯å¢ƒä¸‹ï¼Œå‰ç«¯ä½¿ç”¨ä¸åŒçš„åŸŸåï¼Œè®¿é—®å¯¹åº”çš„åå°æ¥å£å‘¢ï¼Ÿ</p>
</blockquote>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦è§£å†³<strong>å‰ç«¯æ€ä¹ˆä½¿ç”¨åŸŸåæ¥è®¿é—®æˆ‘ä»¬çš„ web åº”ç”¨</strong>ã€‚</p>
<p>æœ€ç®€å•çš„åŠæ³•å½“ç„¶æ˜¯<strong>æ”¹ hosts</strong> ã€‚åº”è¯¥è¿˜æœ‰å…¶ä»–åŠæ³•ï¼Œæ¯”å¦‚ <a href="https://github.com/typicode/hotel" target="_blank" rel="external">hotel - get local domain in seconds</a> ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># my project - toon</span></div><div class="line">127.0.0.1 toon.test.lyyourc.net</div></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° nginx ä½œä¸ºä¸€ä¸ª <strong>proxy server</strong> ï¼ŒæŠŠæ¥æ”¶åˆ°è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„åå°æ¥å£ã€‚</p>
<p>å¦‚æœä½ è¿˜æ²¡æ¥è§¦è¿‡ nginx çš„è¯ï¼Œç°åœ¨å°±æ˜¯ä¸€ä¸ªå¥½æœºä¼šå•¦ã€‚æ‰“å¼€ <a href="http://nginx.org/en/docs/" target="_blank" rel="external">nginx çš„å®˜ç½‘</a>ï¼Œå®‰è£…ï¼Œçœ‹ <a href="http://nginx.org/en/docs/beginners_guide.html" target="_blank" rel="external">Beginnerâ€™s Guide</a> ã€‚</p>
<p>ä¸‹é¢ï¼Œä¿®æ”¹æˆ‘ä»¬çš„ <code>nginx.conf</code>(OSX: <code>/usr/local/etc/nginx/</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">worker_processes  7;</div><div class="line">events &#123; worker_connections 256; &#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">  server &#123;</div><div class="line">    <span class="comment"># ç›‘å¬ 80 ç«¯å£</span></div><div class="line">    listen 80; </div><div class="line">    </div><div class="line">    <span class="comment"># åŸŸåç¬¦åˆï¼štoon.*.lyyourc.net ç­‰</span></div><div class="line">    server_name ~^toon\.(.*\.)?(lyyourc)\.net$;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">      root <span class="string">"/Users/drake/Projects/demo/fun/nginx"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment"># åªè¦å«æœ‰ `/api/` è¯·æ±‚ï¼Œéƒ½è½¬å‘</span></div><div class="line">    location /api/ &#123;</div><div class="line">      proxy_pass http://toon-api.alpha.lyyourc.net;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åè¿è¡Œï¼š<code>sudo nginx -s reload</code>ï¼Œé‡æ–°è¯»å– nginx çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœå¤±è´¥çš„è¯ï¼Œä¼šæœ‰ç›¸å…³çš„æç¤ºä¿¡æ¯ã€‚æ¯”å¦‚ä¸‹é¢å°‘å†™äº† <code>event</code> è¿™ä¸ªæŒ‡ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nginx: [emerg] no <span class="string">"events"</span> section <span class="keyword">in</span> configuration</div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ <code>nginx.conf</code> ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ï¼š</p>
<blockquote>
<p>åªè¦è¯·æ±‚æ˜¯æ¥è‡ª 80 ç«¯å£ï¼ŒåŸŸåç¬¦åˆï¼ŒURLä¸­åŒ…å«äº† <code>/api/</code> çš„ï¼Œæˆ‘ä»¬éƒ½è½¬å‘åˆ° <code>http://toon-api.alpha.lyyourc.net</code> ï¼Œå¦‚æœä¸º <code>/</code> çš„è¯ï¼Œç›´æ¥è¯»å– <code>/Users/drake/Projects/demo/fun/nginx</code> ç›®å½•ä¸‹çš„ <code>index.html</code> ã€‚</p>
</blockquote>
<p>ç„¶åï¼Œæˆ‘ä»¬å‰ç«¯éœ€è¦åšçš„æ˜¯ï¼š<strong>æ ¹æ®å½“å‰çš„åŸŸåï¼Œè¯·æ±‚å¯¹åº”çš„åå°æ¥å£ã€‚</strong></p>
<ul>
<li>å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// host.js</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> apiHost = () =&gt; &#123;</div><div class="line">  <span class="keyword">const</span> items = <span class="built_in">window</span>.location.hostname.split(<span class="string">'.'</span>)</div><div class="line">  <span class="keyword">const</span> env = items[<span class="number">1</span>]</div><div class="line"></div><div class="line">  <span class="keyword">switch</span> (env) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'test'</span>: <span class="comment">// æœ¬åœ°å¼€å‘ç¯å¢ƒ =&gt; nginx</span></div><div class="line">      <span class="keyword">return</span> <span class="string">''</span></div><div class="line"></div><div class="line">    <span class="keyword">case</span> <span class="string">'alpha'</span>:</div><div class="line">      <span class="keyword">return</span> <span class="string">'//toon-api.alpha.lyyourc.net'</span></div><div class="line"></div><div class="line">    <span class="keyword">case</span> <span class="string">'beta'</span>:</div><div class="line">      <span class="keyword">return</span> <span class="string">'//toon-api.beta.lyyourc.net'</span></div><div class="line"></div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> <span class="string">'//toon-api.lyyourc.com'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>æ¯æ¬¡è¯·æ±‚çš„æ—¶å€™éƒ½å¸¦ä¸Šè¿™ä¸ª host :</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; apiHost &#125; <span class="keyword">from</span> <span class="string">'host.js'</span></div><div class="line"></div><div class="line">fetch(<span class="string">`<span class="subst">$&#123;apiHot()&#125;</span>/api/heros/`</span>)</div><div class="line">  .then(res =&gt; res.json())</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å°±æœ‰ï¼š</p>
<ul>
<li>å‰ç«¯åŸŸåä¸º <code>toon.test.lyyourc.net</code> çš„æ—¶å€™</li>
<li><code>apiHost</code> è¿”å›ç©ºå­—ç¬¦ä¸² <code>''</code></li>
<li>è®¿é—®åå°æ¥å£çš„ URL ä¸º <code>toon.test.lyyourc.net/api/xx</code></li>
<li>åœ¨ <code>/etc/hosts</code> åŒ¹é…äº†è¿™ä¸ª URL ï¼Œè½¬åˆ° <code>127.0.0.1</code></li>
<li>Nginx æ¥æ”¶ï¼Œè½¬å‘åˆ° <code>http://toon-api.alpha.lyyourc.net</code></li>
</ul>
<p>ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨ <code>host.js</code> é‡Œé¢è¿”å› <code>http://toon-api.alpha.lyyourc.net</code> å‘¢ï¼ŸåŸå› æœ‰2ä¸ªæˆ‘è®¤ä¸ºï¼š1ä¸ªæ˜¯æµè§ˆå™¨çš„åŒæºç­–ç•¥è€Œäº§ç”Ÿçš„<strong>è·¨åŸŸé—®é¢˜</strong>ï¼Œå¦1ä¸ªæ˜¯å½“æˆ‘ä»¬æƒ³è¦æµ‹è¯•ä»»ä½•ç¯å¢ƒä¸‹çš„åå°æ¥å£ï¼Œæˆ‘ä»¬åªéœ€è¦æ”¹ <code>nginx.conf</code> é‡Œé¢çš„ <code>proxy_pass</code> å°±å¥½äº†ã€‚</p>
<p>ç»¼ä¸Šï¼Œ<strong>ä¸çŸ¥é“æ˜¯å¦è¿˜æœ‰æ›´å¥½çš„è§£å†³åŠæ³•å‘¢ï¼Ÿ</strong></p>
<p>å…¶å® nginx è¿˜å¯ä»¥åšå¾ˆå¤šäº‹æƒ…å•¦ã€‚æ¯”å¦‚ä¸€ä¸ªæœåŠ¡å™¨ä¸Šè½»æ¾åœ°è·‘å¤šä¸ª App ï¼Œè¿˜æœ‰åä»£ google ï¼Œé…ç½® HTTPS ç­‰ç­‰ã€‚</p>
<p>Oh~ My Nginx!!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç”±äºåœ¨å¼€å‘é¡¹ç›®çš„æ—¶å€™ç”¨åˆ°äº† &lt;code&gt;nginx&lt;/code&gt; ï¼Œè§‰å¾—æŒºä¸é”™çš„ï¼Œæ‰€ä»¥äº†è§£äº†ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªé¡¹ç›®çš„å¼€å‘ç¯å¢ƒä¸€èˆ¬éƒ½ä¼šåˆ†ä¸º4ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;test(local): æœ¬åœ°&lt;/li&gt;
&lt;li&gt;alpha&lt;/li&gt;
&lt;li&gt;beta&lt;/
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>A Mathematical Expressions Parser</title>
    <link href="http://drakeleung.github.io/blog/2016/07/14/a-mathematical-expressions-parser/"/>
    <id>http://drakeleung.github.io/blog/2016/07/14/a-mathematical-expressions-parser/</id>
    <published>2016-07-14T12:56:20.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ›´å¤šä¿¡æ¯å¯æŸ¥çœ‹ <a href="http://drakeleung.github.io/demo/slides/calc">SLIDE</a> ã€‚</p>
<h2 id="é—®é¢˜"><a class="header-anchor" href="#é—®é¢˜">#</a>é—®é¢˜</h2>
<p>æˆ‘ä»¬çš„é—®é¢˜æ˜¯è¿™æ ·å­çš„ï¼š</p>
<blockquote>
<p>å†™ä¸€ä¸ª <code>calculate</code> å‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯ä¸€ä¸ªå››åˆ™è¿ç®—è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œè¿”å›ç»“æœåˆ™æ˜¯è¯¥å‚æ•°çš„æ±‚å€¼ã€‚</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">calculate(<span class="string">'1+2*3'</span>) <span class="comment">// 7</span></div><div class="line">calculate(<span class="string">'1*(2+3)*4)'</span>) <span class="comment">// 20</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> * è§„åˆ™ï¼š</div><div class="line"> * 1. ç¦æ­¢ eval åŠå…¶ç±»ä¼¼ç‰©</div><div class="line"> * 2. ç¦æ­¢ç¬¬ä¸‰æ–¹åº“</div><div class="line"> */</div></pre></td></tr></table></figure>
<h2 id="æœ€ç®€å•çš„æ€è·¯"><a class="header-anchor" href="#æœ€ç®€å•çš„æ€è·¯">#</a>æœ€ç®€å•çš„æ€è·¯</h2>
<p>å‡è®¾å­—ç¬¦ä¸²å°±æ˜¯ç®€å•çš„ <code>1+2</code>ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æƒ³æ³•å½“ç„¶æ˜¯ï¼š</p>
<blockquote>
<p>éå†è¯¥å­—ç¬¦ä¸²ï¼Œç„¶åæ ¹æ®ä¸åŒçš„æ“ä½œç¬¦ï¼Œè®¡ç®—å…¶ç»“æœï¼Œé‡å¤ä¹‹ã€‚</p>
</blockquote>
<p>ç„¶è€Œï¼Œå½“å­—ç¬¦ä¸²ä¸º <code>1+2*3</code> æ—¶ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ <code>9</code> è€Œä¸æ˜¯ <code>7</code> ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰è€ƒè™‘åˆ°<strong>æ“ä½œç¬¦çš„ä¼˜å…ˆçº§</strong>ã€‚å¹¶ä¸”ï¼Œå¦‚æœåŠ ä¸Šæ‹¬å·ï¼ˆ<code>()</code>ï¼‰çš„è¯ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§å°±å˜å¾—æ›´åŠ å¤æ‚ã€‚</p>
<p>æ‰€ä»¥å•Šï¼Œæˆ‘ä»¬å°±æƒ³ï¼š</p>
<blockquote>
<p>èƒ½ä¸èƒ½æ²¡æœ‰ä¼˜å…ˆçº§ï¼ŒæŒ‰é¡ºåºå°±å¥½å•¦ï¼Œè¿™æ ·å°±ç®€å•å¤šäº†ã€‚</p>
</blockquote>
<h2 id="é€†æ³¢å…°"><a class="header-anchor" href="#é€†æ³¢å…°">#</a>é€†æ³¢å…°</h2>
<p>åªè¦åŠªåŠ› google ä¸€ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°è§£å†³æ–¹æ³•ï¼š</p>
<blockquote>
<p>ä½¿ç”¨ã€Œé€†æ³¢å…°è¡¨è¾¾å¼ã€ã€‚</p>
</blockquote>
<p>åƒæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„ <code>1 + 1</code> å°±å« <em>ä¸­ç¼€è¡¨è¾¾å¼</em> ã€‚è€Œ <em>é€†æ³¢å…°</em>ï¼ˆ<em>åç¼€è¡¨è¾¾å¼</em> ï¼‰åˆ™å½¢å¦‚ <code>1 1 +</code>ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„é—®é¢˜å°±å˜æˆäº†:</p>
<blockquote>
<p>æ€æ ·æŠŠã€Œä¸­ç¼€è¡¨è¾¾å¼ã€è½¬æ¢æˆã€Œé€†æ³¢å…°è¡¨è¾¾å¼ã€ï¼Ÿ</p>
</blockquote>
<h2 id="tokenizer"><a class="header-anchor" href="#tokenizer">#</a>Tokenizer</h2>
<p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// å‡è®¾æˆ‘ä»¬çš„å­—ç¬¦ä¸²å½¢å¦‚ï¼š`1+2*3-4`</div><div class="line">// é‚£ä¹ˆå°±è¦æŠŠä»–è½¬æ¢æˆè¿™æ ·çš„ä¸€ä¸ªæ•°ç»„ï¼š</div><div class="line"></div><div class="line">[</div><div class="line">  &#123; <span class="built_in">type</span>: <span class="string">'number'</span>, value: 1 &#125;,</div><div class="line">  &#123; <span class="built_in">type</span>: <span class="string">'operator'</span>, value: <span class="string">'+'</span> &#125;,</div><div class="line">  &#123; <span class="built_in">type</span>: <span class="string">'number'</span>, value: 2 &#125;,</div><div class="line">  ....</div><div class="line">]</div></pre></td></tr></table></figure>
<p><em>æŸ¥çœ‹ä»£ç è¯·ç‚¹å‡» <a href="https://github.com/DrakeLeung/calc/blob/master/src/tokenizer.js" target="_blank" rel="external">tokenizer</a> ã€‚</em></p>
<h2 id="torpn"><a class="header-anchor" href="#torpn">#</a>toRPN</h2>
<p>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬è¦æŠŠå¾—åˆ°çš„ tokens è½¬æ¢æˆ <em>é€†æ³¢å…°</em> å½¢å¼ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦ç”¨åˆ° <a href="">shunting-yard</a> ç®—æ³•ã€‚</p>
<p><em>æŸ¥çœ‹ä»£ç è¯·ç‚¹å‡» <a href="https://github.com/DrakeLeung/calc/blob/master/src/toRPN.js" target="_blank" rel="external">toRPN</a> ã€‚</em></p>
<h2 id="calculator"><a class="header-anchor" href="#calculator">#</a>Calculator</h2>
<p>ç¬¬ä¸‰æ­¥ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€åä¸€æ­¥ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦æŠŠåˆ›å»ºä¸€ä¸ª <strong>æ“ä½œæ•°æ ˆ</strong> ï¼Œå¦‚æœæ˜¯æ“ä½œæ•°çš„è¯ï¼Œpush åˆ°æ ˆé‡Œå»ï¼›å¦‚æœæ˜¯æ“ä½œç¬¦çš„è¯ï¼ŒæŠŠæ ˆé‡Œçš„å‰ä¸¤ä¸ªæ“ä½œæ•° pop å‡ºæ¥ï¼Œè®¡ç®—ä»–ä»¬å’Œè¯¥æ“ä½œç¬¦çš„ç»“æœã€‚ç„¶åæŠŠç»“æœ push åˆ°æ ˆé‡Œã€‚é‡å¤ä¹‹ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰çš„ tokens ã€‚</p>
<p><em>æŸ¥çœ‹ä»£ç è¯·ç‚¹å‡» <a href="https://github.com/DrakeLeung/calc/blob/master/src/index.js" target="_blank" rel="external">calculator</a> ã€‚</em></p>
<h2 id="æŠ½è±¡è¯­æ³•æ ‘"><a class="header-anchor" href="#æŠ½è±¡è¯­æ³•æ ‘">#</a>æŠ½è±¡è¯­æ³•æ ‘</h2>
<p>å…¶å®ï¼Œæˆ‘ä»¬è¿˜èƒ½åšäº›æ›´æœ‰è¶£çš„äº‹æƒ…ã€‚æ¯”å¦‚ï¼Œæ„å»ºä¸€æ£µ AST ã€‚åšæ³•å…¶å®å’Œç¬¬ä¸‰æ­¥å·®ä¸å¤šã€‚</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª <strong>æ“ä½œæ•°æ ˆ</strong></li>
<li>éå† tokens</li>
<li>å¦‚æœ token ä¸ºæ“ä½œæ•°ï¼Œåˆ™ push åˆ°æ ˆé‡Œã€‚</li>
<li>å¦‚æœ token ä¸ºæ“ä½œç¬¦ï¼Œåˆ™æŠŠ æ ˆé‡Œçš„ä¸¤ä¸ªæ“ä½œæ•° pop å‡ºæ¥ï¼Œä¸è¯¥æ“ä½œç¬¦å½¢æˆ AST çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¥ç€æŠŠè¯¥èŠ‚ç‚¹ push åˆ°æ ˆé‡Œå»</li>
<li>é‡å¤ä¹‹ï¼Œç›´åˆ°éå†å®Œ tokens</li>
</ol>
<p>æœ‰äº† AST ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬å¯¹å…¶åˆ†åˆ«è¿›è¡Œå‰åºï¼Œä¸­åºï¼Œååºéå†çš„è¯ï¼Œå°±å¯ä»¥å¾—åˆ° <strong>å‰ç¼€è¡¨è¾¾å¼</strong> ï¼Œ<strong>ä¸­ç¼€è¡¨è¾¾å¼</strong> ï¼Œä»¥åŠ <strong>åç¼€è¡¨è¾¾å¼</strong> ã€‚</p>
<p><em>æŸ¥çœ‹ä»£ç è¯·ç‚¹å‡» <a href="https://github.com/DrakeLeung/calc/blob/master/src/parser.js" target="_blank" rel="external">parser</a> ã€‚</em></p>
<h2 id="é¡¹ç›®æºç "><a class="header-anchor" href="#é¡¹ç›®æºç ">#</a>é¡¹ç›®æºç </h2>
<p>æ‰€æœ‰ä»£ç å¯æŸ¥çœ‹ï¼š<a href="https://github.com/DrakeLeung/calc" target="_blank" rel="external">https://github.com/DrakeLeung/calc</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ›´å¤šä¿¡æ¯å¯æŸ¥çœ‹ &lt;a href=&quot;http://drakeleung.github.io/demo/slides/calc&quot;&gt;SLIDE&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é—®é¢˜&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#é—®é¢˜&quot;&gt;#&lt;/a&gt;é—®é¢˜&lt;/h
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>å®ç°ä¸€ä¸ª flickr like å¸ƒå±€</title>
    <link href="http://drakeleung.github.io/blog/2016/04/29/justified-layout/"/>
    <id>http://drakeleung.github.io/blog/2016/04/29/justified-layout/</id>
    <published>2016-04-29T15:27:28.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>Flickr å›¢é˜Ÿæœ€è¿‘å¼€æºäº†ä»–ä»¬å›¾ç‰‡å¸ƒå±€çš„é¡¹ç›® - <a href="https://github.com/flickr/justified-layout/blob/master/README.md" target="_blank" rel="external">Flickrâ€™s Justified Layout</a> ã€‚é‚£ä¹ˆï¼Œé€šè¿‡é˜…è¯»å…¶æºä»£ç åï¼Œæˆ‘å®ç°äº†ä¸€ä¸ªç®€å•ç‰ˆ - <a href="https://github.com/DrakeLeung/demo/blob/gh-pages/toys%2Fjjjustify%2FREADME.md" target="_blank" rel="external">jjjustify</a>ã€‚ç‚¹å‡»è¿™é‡Œå¯ä»¥æŸ¥çœ‹åœ¨çº¿ <a href="http://frontend-addiction.github.io/Baidu-IFE/stage03/task43/flickr/index.html" target="_blank" rel="external">demo</a> ã€‚</p>
<h2 id="æ ¸å¿ƒç®—æ³•"><a class="header-anchor" href="#æ ¸å¿ƒç®—æ³•">#</a>æ ¸å¿ƒç®—æ³•</h2>
<p>æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒæ˜¯ï¼š<strong>å¦‚ä½•ç¡®å®šä¸€è¡Œä¸­çš„å›¾ç‰‡æ•°é‡å¹¶ä¸”ä¿æŒæ¨ªçºµæ¯”</strong> ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä¸ªçŸ¥è¯†ï¼š</p>
<blockquote>
<p>å‡è®¾æˆ‘ä»¬ä¸€è¡Œçš„é«˜åº¦ä¸º 300 ï¼Œå®½åº¦ä¸º 1200 ã€‚é‚£ä¹ˆåœ¨è¿™ä¸€è¡Œä¸­çš„æ‰€æœ‰å›¾ç‰‡çš„æ¨ªçºµæ¯”ä¹‹å’Œå°±å°äºç­‰äºè¿™ä¸€è¡Œçš„æ¨ªçºµæ¯”ï¼Œä¹Ÿå°±æ˜¯ 4:1 ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬è¿™é‡Œä¸ç”¨æ•°å­¦æ¥è¯æ˜ã€‚ä½†æ˜¯ä¸å¦¨æƒ³è±¡ï¼Œå½“ä¸€è¡Œä¸­çš„å›¾ç‰‡éƒ½æ”¶ç¼©æˆ–è€…æ‹‰ä¼¸ä¹‹åï¼Œæ˜¯å¯ä»¥å æ»¡æ•´è¡Œçš„ï¼Œè¿™æ—¶ï¼Œå°±ç›¸å½“äºè¿™ä¸€è¡Œã€‚æ‰€ä»¥ï¼Œå½“å‰è¡Œæ‰€æœ‰å›¾ç‰‡çš„æ¨ªçºµæ¯”ä¹‹å’Œè¦<strong>å°äºç­‰äº</strong>åˆå§‹è®¾å®šçš„æ•´è¡Œçš„æ¨ªçºµæ¯”ã€‚</p>

<p>ä½†æ˜¯ï¼Œä¸ºäº†å¢åŠ çµæ´»æ€§ï¼Œæˆ‘ä»¬å¯ä»¥<strong>è®¾å®šä¸€ä¸ªå®¹å¿åº¦</strong>ã€‚ä»–çš„å–å€¼èŒƒå›´æ˜¯ <code>[0, 1]</code> ã€‚å¦‚æœå½“å‰è¡Œæ‰€æœ‰å›¾ç‰‡çš„æ¨ªçºµæ¯”ä¹‹å’Œä»‹äºï¼ˆåˆå§‹è®¾å®šçš„æ•´è¡Œçš„æ¨ªçºµæ¯” * (1 Â± å®¹å¿åº¦ï¼‰çš„è¯ï¼Œæˆ‘ä»¬éƒ½èƒ½æ¥å—ï¼ˆå®¹å¿ï¼‰ï¼Œåœ¨å½“å‰è¡Œæ’å…¥è¯¥å›¾ç‰‡ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šåˆå§‹è®¾å®šçš„æ•´è¡Œçš„æ¨ªçºµæ¯”ï¼ˆ<code>targetRowAspectRatio</code>ï¼‰ä¸º 4 ï¼Œæˆ‘ä»¬çš„å®¹å¿åº¦ï¼ˆ<code>tolerance</code>ï¼‰ä¸º <code>0.25</code> ã€‚æ‰€ä»¥ï¼Œåªè¦å›¾ç‰‡ä»¬çš„æ¨ªçºµæ¯”ä¹‹å’Œä»‹äº <code>targetRowAspectRatio * (1 - tolerance)</code> å’Œ <code>targetRowAspectRatio * (1 + tolerance)</code> å°±è®©ä»–ä»¬åœ¨å½“å‰è¡Œã€‚</p>

<p>å¦‚æœå¤§äºå®¹å¿åçš„æ¨ªçºµæ¯”çš„è¯ï¼Œ<strong>ä¸ºäº†æ›´åŠ ç²¾ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒç»å¯¹å€¼</strong>ã€‚çœ‹çœ‹æ’å…¥å›¾ç‰‡åçš„æ¨ªçºµæ¯”ä¹‹å’Œ - targetRowAspectRatio çš„ç»å¯¹å€¼å°ï¼Œè¿˜æ˜¯æ’å…¥å›¾ç‰‡å‰çš„æ¨ªçºµæ¯”ä¹‹å’Œ - targetRowAspectRatio çš„ç»å¯¹å€¼å°ã€‚å“ªä¸ªå°å°±é‡‡ç”¨å“ªç§æ–¹æ¡ˆã€‚</p>
<p>æ’å…¥æ–°å›¾ç‰‡å‰çš„ç»å¯¹å€¼ä¸º <code>3.5</code> :</p>

<p>æ’å…¥åçš„ç»å¯¹å€¼ä¸º <code>0.5</code> ï¼Œå°äº <code>3.5</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©åœ¨å½“å‰è¡Œæ’å…¥è¯¥å›¾ç‰‡ã€‚</p>

<p>å¦‚æœå°äºå®¹å¿åçš„æ¨ªçºµæ¯”çš„è¯ï¼Œå‡è®¾è¿˜æ²¡æ’å®Œå›¾ç‰‡ï¼Œå°±ç»§ç»­æ’ã€‚å¦‚æœå·²ç»æ’å®Œäº†å›¾ç‰‡ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ˜¯å¦é“ºæ»¡ä¸€è¡Œï¼Œè¿˜æ˜¯å°±è®©ä»–è¿™æ ·ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„é«˜åº¦å°±æ˜¯åŸå§‹è®¾å®šçš„é«˜åº¦ã€‚</p>
<p>è¯¦ç»†ä»£ç å®ç°è¯·å‚è€ƒ <a href="https://github.com/DrakeLeung/demo/blob/gh-pages/toys%2Fjjjustify%2Frrrow.js" target="_blank" rel="external">rrrow.js</a> çš„ <code>addItem()</code> æ–¹æ³•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Flickr å›¢é˜Ÿæœ€è¿‘å¼€æºäº†ä»–ä»¬å›¾ç‰‡å¸ƒå±€çš„é¡¹ç›® - &lt;a href=&quot;https://github.com/flickr/justified-layout/blob/master/README.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Flick
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>bubble sorting visually</title>
    <link href="http://drakeleung.github.io/blog/2016/03/27/bubble-sorting-visually/"/>
    <id>http://drakeleung.github.io/blog/2016/03/27/bubble-sorting-visually/</id>
    <published>2016-03-27T15:01:37.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>TL;DR: <a href="http://plnkr.co/edit/je2wWv?p=preview" target="_blank" rel="external">åœ¨çº¿ä¾‹å­å’Œç›¸å…³ä»£ç è¯·æŸ¥çœ‹è¿™é‡Œã€‚</a></p>
<p>æœ¬æ–‡ç« çš„ç›®çš„æ¥æºäºçŸ¥ä¹çš„ä¸€ä¸ªé—®é¢˜ï¼š<a href="https://www.zhihu.com/question/41642706" target="_blank" rel="external">æˆ‘ç”¨jså†™äº†ä¸€ä¸ªå†’æ³¡æ’åºæ³•ï¼Œæ€ä¹ˆç”¨htmlå’ŒcssæŠŠæ’åºè¿‡ç¨‹å±•ç°å‡ºæ¥ï¼Ÿ</a></p>
<p>ä¸‹é¢è®²ä¸€ä¸‹è¦è§£å†³çš„å‡ ä¸ªé—®é¢˜å’Œ tipsã€‚</p>
<h2 id="å¦‚ä½•å®ç°-äº¤æ¢-çš„åŠ¨ç”»"><a class="header-anchor" href="#å¦‚ä½•å®ç°-äº¤æ¢-çš„åŠ¨ç”»">#</a>å¦‚ä½•å®ç°ã€Œäº¤æ¢ã€çš„åŠ¨ç”»</h2>
<p>æˆ‘è§‰å¾—è¿™ä¸ªæ˜¯æ•´ä¸ªåº”ç”¨çš„éš¾ç‚¹ã€‚</p>
<p>çœ‹äº† <a href="http://visualgo.net/sorting.html" target="_blank" rel="external">visual.net</a>ï¼Œä»–çš„å®ç°æ˜¯åˆ©ç”¨ CSS3 çš„ <code>transform</code> å‡½æ•°é‡Œé¢çš„ <code>translate</code>ã€‚è¿™ä¼¼ä¹æ˜¯ä¸é”™çš„æƒ³æ³•ï¼Œä½†æ˜¯æˆ‘å‘ç°è¦ç”¨ JS è·å– <code>translate</code> å¯¹åº”çš„å€¼çš„è¯ï¼Œ<a href="http://stackoverflow.com/questions/21912684/how-to-get-value-of-translatex-and-translatey" target="_blank" rel="external">æœ‰ç‚¹éº»çƒ¦</a>ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘åˆçœ‹äº†ä¸€ä¸ªç­”æ¡ˆçš„<a href="http://meowtec.github.io/demo/sort-v/" target="_blank" rel="external">å®ç°</a>ã€‚ä»–çš„æ–¹æ³•æ˜¯åˆ©ç”¨ CSS ä¸­çš„ <code>left</code>ã€‚è€Œ <code>left</code> çš„å€¼æ˜¯ç›¸å¯¹äºè®¾å®šäº† <code>position: relative</code> çš„ <em>parent</em>ã€‚</p>
<p>æˆ‘ä¸æ˜¯å¾ˆæ‡‚ä¸Šé¢çš„æ–¹æ³•ã€‚ä½†æ˜¯æˆ‘æƒ³åˆ°äº†å¦ä¸€ä¸ªæ–¹æ³•ï¼š<strong><code>left</code> æ˜¯ç›¸å¯¹äºä»–æœ¬èº«</strong>ã€‚ä¹Ÿå°±æ˜¯è®¾ç½®ä»–æœ¬èº«ä¸º <code>position: relative</code> è€Œä¸æ˜¯ä»–çš„ <em>parent</em>ã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.bar</span> &#123;</div><div class="line">  <span class="attribute">position</span>: relative;</div><div class="line">  <span class="attribute">left</span>: <span class="number">0</span>;  <span class="comment">/* must set, or not transition when value in falsy */</span></div><div class="line">  <span class="comment">/*transition: left 1s;*/</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä¹‹æ‰€ä»¥è®¾ç½® <code>left</code> ä¸º <code>0</code>ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è¦ç”¨ CSS3 çš„ <code>transition</code> å®ç°æ¸å˜çš„æ•ˆæœã€‚</p>
<p>ç„¶åï¼Œæ¯æ¬¡äº¤æ¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä»–å½“å‰çš„ <code>left</code> åŠ /å‡ æŸ±å½¢å›¾çš„å®½åº¦ã€‚æ²¡é”™ï¼Œè¿™å°±æ˜¯è¿™ç§æ–¹æ³•çš„ã€Œç¼ºç‚¹ã€ä¹‹ä¸€ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ JS å†™æ­»æŸ±å½¢å›¾çš„å®½åº¦ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">swap () &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line"></div><div class="line">  <span class="keyword">const</span> getLeft = item =&gt;</div><div class="line">    <span class="built_in">parseInt</span>(item.style.left.slice(<span class="number">0</span>, <span class="number">-2</span>)) || <span class="number">0</span> <span class="comment">// rm 'px'</span></div><div class="line"></div><div class="line">  item1.style.left = <span class="string">`<span class="subst">$&#123;this.barWidth + getLeft(item1)&#125;</span>px`</span></div><div class="line">  item2.style.left = <span class="string">`<span class="subst">$&#123;-this.barWidth + getLeft(item2)&#125;</span>px`</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨äº¤æ¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å…ˆæ‰¾åˆ°å¯¹åº”çš„ DOM å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ä»£ç ä¸­çš„ <code>item</code> å’Œ <code>item2</code>ã€‚</p>
<p>æ€ä¹ˆæ‰¾ï¼Ÿï¼ˆå‡è®¾æˆ‘ä»¬æ’åºçš„æ˜¯ä¸€å †æ•°å­—ï¼‰<br>
ä¸€å¼€å§‹æˆ‘æƒ³åˆ°äº†ä¸¤ç§æ–¹æ³•ã€‚</p>
<p>ç¬¬ä¸€ç§æ˜¯ï¼Œæ ¹æ®æ•°å­—ï¼Œæ‰¾åˆ°å…·æœ‰å¯¹ç”¨æ•°å­—çš„ DOM å…ƒç´ ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">swap (value1, value2) &#123;</div><div class="line">  <span class="keyword">const</span> item1 = <span class="keyword">this</span>.el.querySelector(<span class="string">`[data-value='<span class="subst">$&#123;value1&#125;</span>']`</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½†è¿™ç§æ–¹æ³•æ˜¯è¡Œä¸é€šçš„ã€‚ä¸ºä»€ä¹ˆï¼Ÿ<br>
å› ä¸ºå½“æœ‰å¤šä¸ªæ•°å­—ç›¸åŒçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰¾åˆ°çš„ DOM å…ƒç´ ä¸ä¸€å®šæ˜¯æˆ‘ä»¬æƒ³è¦äº¤æ¢çš„ã€‚å› ä¸º <code>querySelector</code> è¿”å›çš„æ€»æ˜¯ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ã€‚</p>
<p>é‚£æˆ‘ä»¬åœ¨ <code>item1</code> åé¢æ‰å¼€å§‹æ‰¾ <code>item2</code> è¡Œä¸è¡Œï¼Ÿä½¿ç”¨ CSS3 çš„ <code>~</code> é€‰æ‹©å™¨ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">swap (value1, value2) &#123;</div><div class="line">  <span class="keyword">const</span> item1 = <span class="keyword">this</span>.el.querySelector(<span class="string">`[data-value='<span class="subst">$&#123;value1&#125;</span>']`</span>)</div><div class="line">  <span class="keyword">const</span> item2 = <span class="keyword">this</span>.el.querySelector(<span class="string">`[data-value='<span class="subst">$&#123;value2&#125;</span>'] ~ data-value='<span class="subst">$&#123;value2&#125;</span>']`</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•æœ‰æ—¶å¯ä»¥ï¼Œæœ‰æ—¶æ˜¯ä¸å¯ä»¥çš„ã€‚ä¸ºä»€ä¹ˆï¼Ÿ<br>
å› ä¸ºæˆ‘ä»¬çš„ DOM ç»“æ„æ ¹æœ¬å°±æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯ç”¨ CSS çš„ <code>left</code> åœ¨è§†è§‰ä¸Šæ”¹å˜äº†ä½ç½®è€Œå·²ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¬¬äºŒç§æ–¹æ³•å½“ç„¶å°±æ˜¯åœ¨äº¤æ¢çš„æ—¶å€™ï¼Œä¸ä»…æ”¹å˜ <code>left</code> çš„å€¼ï¼Œè€Œä¸”äº¤æ¢ DOM çš„ä½ç½®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">swapDOM</span>(<span class="params">element1, element2</span>) </span>&#123;</div><div class="line">  element1.parentNode.insertBefore(element2, element1);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•è¿˜æ˜¯è¡Œä¸é€šçš„ã€‚å› ä¸º <code>insertBefore</code> ä¼šæŠŠ <code>element2</code> ä» DOM ä¸­åˆ æ‰ã€‚è¿™æ ·çš„è¯ï¼Œå°±æ²¡æœ‰äº†ã€Œäº¤æ¢ã€çš„æ¸å˜æ•ˆæœã€‚</p>
<p>æœç„¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¸èƒ½ DOM å…ƒç´ ã€‚é‚£ä¹ˆåªèƒ½è¿”å›ç¬¬ä¸€ç§æ–¹æ³•ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘çªç„¶æƒ³åˆ°äº† React ä¸­å¾ªç¯çš„æ—¶å€™éœ€è¦å†™ä¸Š <code>key</code> å±æ€§ã€‚ç„¶åã€‚ã€‚ã€‚ç„¶ååªè¦æŠŠ <code>key</code> å’Œ æ•°å­—ç»‘å®šåœ¨ä¸€èµ·ï¼ŒæŸ¥æ‰¾æ•°å­—å¯¹åº”çš„ DOM å…ƒç´ åªéœ€è¦ä½¿ç”¨ <code>key</code> å°±è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// data = [64, 39, 78, 36]</span></div><div class="line"><span class="keyword">this</span>.items = data.map((d, i) =&gt; (&#123;key: <span class="string">`key-<span class="subst">$&#123;i&#125;</span>`</span>, value: d&#125;))</div><div class="line"></div><div class="line">swap (key1, key2) &#123;</div><div class="line">  <span class="keyword">const</span> item1 = <span class="keyword">this</span>.el.querySelector(<span class="string">`[data-key='<span class="subst">$&#123;key1&#125;</span>']`</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»ˆäºæå®šäº†ã€Œäº¤æ¢ã€åŠ¨ç”»äº†ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰æ›´å¥½çš„å®ç°æ–¹æ³•å‘¢ï¼Ÿ</p>
<h2 id="ä¸ºä»€ä¹ˆæˆ‘çš„-äº¤æ¢-åŠ¨ç”»ä¸€ç¬é—´å°±è·‘å®Œäº†"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæˆ‘çš„-äº¤æ¢-åŠ¨ç”»ä¸€ç¬é—´å°±è·‘å®Œäº†">#</a>ä¸ºä»€ä¹ˆæˆ‘çš„ã€Œäº¤æ¢ã€åŠ¨ç”»ä¸€ç¬é—´å°±è·‘å®Œäº†</h2>
<p>å‡è®¾æˆ‘ä»¬çš„æ’åºç®—æ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">sort () &#123;</div><div class="line">  <span class="keyword">const</span> items = <span class="keyword">this</span>.items</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; items.length; i++) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; items.length - i - <span class="number">1</span>; j++) &#123;</div><div class="line">      <span class="keyword">const</span> item1 = items[j]</div><div class="line">      <span class="keyword">const</span> item2 = items[j + <span class="number">1</span>]</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (less(item2.value, item1.value)) &#123;</div><div class="line">        swap(j, j + <span class="number">1</span>, items)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.items</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬çš„ <code>swap</code> å‡½æ•°æ˜¯åœ¨ <code>for</code> å¾ªç¯é‡Œé¢è°ƒç”¨çš„ï¼Œè¿™æ˜¯æ²¡é”™çš„ã€‚</p>
<p>ç„¶è€Œæˆ‘ä»¬çš„ã€Œäº¤æ¢ã€åŠ¨ç”»å°±è·‘å®Œäº†ï¼Œæ ¹æœ¬æ²¡æœ‰æ¸å˜çš„æ•ˆæœï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯ç­‰åˆ°å‰ä¸€ä¸ªäº¤æ¢åŠ¨ç”»å®Œæˆåï¼Œä¸‹ä¸€ä¸ªæ‰å‘ç”Ÿã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„ä¸¤ä¸ª <code>for</code> æ˜¯ç¬é—´å°±å¯ä»¥è·‘å®Œçš„= =</p>
<p>æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ<code>setInterval</code>ï¼Ÿå¥½åƒä¼šæŠŠæ’åºç®—æ³•çš„é€»è¾‘æ‰°ä¹±ã€‚<br>
çªç„¶ï¼Œæˆ‘æƒ³åˆ°äº† jQuery å¥½åƒæœ‰ä¸ªåŠ¨ç”»é˜Ÿåˆ—çš„ä¸œè¥¿ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„åŠ¨ç”»å…ˆæ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢ã€‚ç„¶åå†ä¸€ä¸ªä¸€ä¸ªåœ°å‡ºé˜Ÿï¼Œä¸€ä¸ªä¸€ä¸ªåœ°è°ƒç”¨ã€‚</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> () &#123;</div><div class="line">  <span class="keyword">for</span> () &#123;</div><div class="line">    <span class="keyword">if</span> (less(item2.value, item1.value)) &#123;</div><div class="line">      <span class="keyword">this</span>.queue.push(() =&gt; <span class="keyword">this</span>.swap(item1.key, item2.key))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">play () &#123;</div><div class="line">  <span class="keyword">const</span> intervalId = setInterval(() =&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.queue.length === <span class="number">0</span>) &#123;</div><div class="line">      clearInterval(intervalId)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">const</span> swap = <span class="keyword">this</span>.queue.shift()</div><div class="line">      swap()</div><div class="line">    &#125;</div><div class="line">  &#125;, <span class="number">2</span> * <span class="number">1000</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹äº†çŸ¥ä¹ä¸Šçš„ç­”æ¡ˆï¼Œè¿™ä¸ªé—®é¢˜è¿˜æœ‰å…¶ä»–å®ç°çš„æ–¹æ³•ã€‚<strong>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯å¦‚ä½•è§£å†³å¼‚æ­¥ç¼–ç¨‹é—®é¢˜ã€‚</strong></p>
<h2 id="tips"><a class="header-anchor" href="#tips">#</a>Tips</h2>
<p>å¯ä»¥åˆ©ç”¨ CSS çš„ ä¼ªå…ƒç´ <code>::before</code> ä»¥åŠ <code>attr</code> å‡½æ•°ï¼Œæ¥å®ç°æŸ±å½¢å›¾ä¸Šæ˜¾ç¤ºå¯¹åº”çš„æ•°å­—ã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.bar</span><span class="selector-pseudo">::before</span> &#123;</div><div class="line">  <span class="attribute">content</span>: <span class="built_in">attr</span>(data-value);</div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">  <span class="attribute">top</span>: -<span class="number">16px</span>;</div><div class="line">  <span class="attribute">color</span>: <span class="number">#233</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="continue"><a class="header-anchor" href="#continue">#</a>Continue</h2>
<p>æˆ‘ä»¬çš„ä»£ç è¿˜å¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼Œæ¯”å¦‚æ¥å£å¦‚ä½•è®¾è®¡ï¼Œä½¿å¾—å¯ä»¥æ‰©å±•äºå…¶ä»–çš„æ’åºç®—æ³•ã€‚è¿˜æœ‰ç”¨æˆ·ä½“éªŒ,æ¯”å¦‚ï¼Œæ’åºå‰ä¸­åçŠ¶æ€çš„é¢œè‰²éƒ½è®¾ä¸ºä¸åŒï¼Œç­‰ç­‰ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;TL;DR: &lt;a href=&quot;http://plnkr.co/edit/je2wWv?p=preview&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;åœ¨çº¿ä¾‹å­å’Œç›¸å…³ä»£ç è¯·æŸ¥çœ‹è¿™é‡Œã€‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ç« çš„ç›®çš„æ¥æºäºçŸ¥ä¹çš„ä¸€ä¸ªé—®é¢˜ï¼š&lt;a href
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ã€Œè¯‘ã€Learning React Without Using React Part2</title>
    <link href="http://drakeleung.github.io/blog/2016/03/22/Learning-React-Without-Using-React-Part-2/"/>
    <id>http://drakeleung.github.io/blog/2016/03/22/Learning-React-Without-Using-React-Part-2/</id>
    <published>2016-03-22T08:12:22.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><em><a href="https://medium.com/javascript-inside/learning-react-without-using-react-part-2-703621a89432#.guh60nwi7" target="_blank" rel="external">åŸæ–‡é“¾æ¥</a></em></p>
<p>è¯·é˜…è¯» <a href="http://drakeleung.github.io/blog/2016/03/20/Learning-React-Without-Using-React-Part-1/">Part 1</a> å¦‚æœä½ è¿˜æ²¡æœ‰çš„è¯ã€‚</p>
<p>è®©æˆ‘ä»¬ç»§ç»­ Part1 æ²¡è®²åˆ°çš„ä¸œè¥¿ã€‚<br>
æˆ‘ä»¬è¿™ä¸¤ç¯‡æ–‡ç« ä¸»è¦æ˜¯ä¸“æ³¨äºå¦‚ä½•é‡æ„æˆ‘ä»¬çš„ todo listã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„å®ç°åŒ…å«äº†å¯ä»¥æ¸²æŸ“æ•´ä¸ªåº”ç”¨çš„å‡½æ•°ï¼ˆç»„åˆï¼‰ï¼Œè¿˜æœ‰ç®¡ç†æˆ‘ä»¬çŠ¶æ€ï¼ˆstateï¼‰çš„ <em>store</em>ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šæ–¹æ³•å»ä¼˜åŒ–æˆ‘ä»¬çš„åº”ç”¨ã€‚<a href="http://plnkr.co/edit/fjQbQwZpQlhd5wXoc9J8?p=preview" target="_blank" rel="external">å®Œæ•´ä»£ç è¯·æŸ¥çœ‹è¿™é‡Œ</a>ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æ­£ç¡®åœ°å¤„ç†äº‹ä»¶ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„ç»„ä»¶æ ¹æœ¬å°±æ²¡æœ‰ç»‘å®šä»»ä½•äº‹ä»¶ã€‚åœ¨ React é‡Œé¢ï¼Œæ•°æ®æµæ˜¯ä»ä¸Šå¾€ä¸‹ï¼Œè€Œäº‹ä»¶æµåˆ™æ˜¯ä»ä¸‹å¾€ä¸Šï¼ˆIn React data flows down while events move upï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“äº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥æ²¿ç€ç»„ä»¶é“¾ï¼Œä»ä¸‹å¾€ä¸Šæ‰¾å…¶å¯¹åº”çš„å›è°ƒå‡½æ•°ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬çš„ <code>ItemRow</code> å‡½æ•°åº”è¯¥è°ƒç”¨ä¸€ä¸ªä» <code>props</code> ä¼ é€’ä¸‹æ¥çš„å‡½æ•°ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆå®ç°å‘¢ï¼Ÿä¸‹é¢æ˜¯ä¸€ä¸ªå°å°è¯•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ItemRow</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> className = props.completed ? <span class="string">'item completed'</span> : <span class="string">'item'</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> $(<span class="string">'&lt;li&gt;'</span>)</div><div class="line">    .on(<span class="string">'click'</span>, props.onUpdate.bind(<span class="literal">null</span>, props.id))</div><div class="line">    .addClass(className)</div><div class="line">    .attr(<span class="string">'id'</span>, props.id)</div><div class="line">    .html(props.text)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬ç»™ <code>list</code> å…ƒç´ ç»‘å®šäº†ä¸€ä¸ªäº‹ä»¶ã€‚å½“ç‚¹å‡»ä»–ä»¬çš„æ—¶å€™ï¼Œ<code>onUpdate</code> å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸å¦¨å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä»–å¯ä»¥åœ¨åˆ›å»ºå…ƒç´ çš„æ—¶å€™åŒæ—¶ä¸ºå…¶ç»‘å®šäº‹ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span> (<span class="params">tag, attrs, children</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> elem = $(<span class="string">'&lt;'</span>, + tag + <span class="string">'&gt;'</span>)</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> attrs) &#123;</div><div class="line">    <span class="keyword">var</span> val = attrs[key]</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (key.indexOf(<span class="string">'on'</span>) === <span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">var</span> event = key.substr(<span class="number">2</span>).toLowerCase()</div><div class="line">      elem.on(event, val)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      elem.attr(key, val)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> elem.html(children)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬çš„ <code>ItemRow</code> å‡½æ•°å¯ä»¥å†™æˆè¿™æ ·ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">function ItemRow (props) &#123;</div><div class="line">  var className = props.completed ? 'item completed' : 'item'</div><div class="line"></div><div class="line">  return createElement('li', &#123;</div><div class="line">    id: props.id,</div><div class="line">    class: props.className,</div><div class="line">    onClick: props.onUpdate.bind(null, props.id)</div><div class="line">  &#125;, props.text)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ React ä¸­çš„ <code>createElement</code> å‡½æ•°æ˜¯åˆ›å»ºäº†ä¸€ä¸ª JavaScript å¯¹è±¡æ¥è¡¨ç¤º DOM å…ƒç´ ã€‚è¿˜æœ‰ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ React ä¸­çš„ JSX è¯­æ³•åˆ°åº•æ˜¯æ€æ ·å­çš„ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ª JSX ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> ( <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'el'</span> <span class="attr">className</span>=<span class="string">'entry'</span>&gt;</span> Hello <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</div></pre></td></tr></table></figure>
<p>æ¥ç€ä¼šè½¬æ¢æˆï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> SomeElement = React.createElement(<span class="string">'div'</span>, &#123;</div><div class="line">  id: <span class="string">'el'</span>,</div><div class="line">  className: <span class="string">'entry'</span></div><div class="line">&#125;, <span class="string">'Hello'</span>)</div></pre></td></tr></table></figure>
<p>ç„¶åè°ƒç”¨ <code>SomeElement</code> å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåƒä¸‹é¢å·®ä¸å¤šçš„ JavaScript å¯¹è±¡ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">  type: <span class="string">'div'</span>,</div><div class="line">  key: <span class="literal">null</span>,</div><div class="line">  ref: <span class="literal">null</span>,</div><div class="line">  props: &#123;</div><div class="line">    children: <span class="string">'Hello'</span>,</div><div class="line">    className: <span class="string">'entry'</span>,</div><div class="line">    id: <span class="string">'el'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æƒ³è¦äº†è§£æ›´å¤šçš„è¯ï¼Œè¯·é˜…è¯» <a href="https://medium.com/@dan_abramov/react-components-elements-and-instances-90800811f8ca#.x2b1qra2o" target="_blank" rel="external">React Components, Elements, and Instances</a></p>
<p>å›åˆ°æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ<code>onUpdate</code> å‡½æ•°æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ</p>
<p>ç°åœ¨æ¥çœ‹çœ‹æˆ‘ä»¬çš„ <code>render</code> å‡½æ•°ã€‚ä»–å®šä¹‰äº†ä¸€ä¸ª <code>updateState</code> å‡½æ•°ï¼Œç„¶åé€šè¿‡ <code>props</code> æŠŠè¿™ä¸ªå‡½æ•°ä¼ ç»™ <code>ItemList</code> ç»„ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">props, node</span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateState</span> (<span class="params">toggleId</span>) </span>&#123;</div><div class="line">    state.items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (el.id === toggleId) &#123;</div><div class="line">        el.completed = !el.completed</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    store.setState(state)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  node.empty().append([ItemList(&#123;</div><div class="line">    items: props.items,</div><div class="line">    onUpdate: updateState</div><div class="line">  &#125;)])</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç„¶åï¼Œ<code>ItemList</code> å‡½æ•°ä¼šæŠŠ <code>onUpdate</code> ä¼ åˆ°æ¯ä¸ª <code>ItemRow</code> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">functions extending(base, item) &#123;</div><div class="line">  <span class="keyword">return</span> $.extend(&#123;&#125;, item, base)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ItemsList</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> createElement(<span class="string">'ul'</span>, &#123;&#125;, props.items</div><div class="line">    .map(extending.bind(<span class="literal">null</span>, &#123;onUpdate: props.onUpdate&#125;))</div><div class="line">  )</div><div class="line">    .map(ItemRow)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šæˆ‘ä»¬å®ç°äº†ï¼šæ•°æ®æµæ˜¯ä»ä¸‹å¾€ä¸‹çš„ï¼Œè€Œäº‹ä»¶æµæ˜¯ä»ä¸‹å¾€ä¸Šã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æŠŠå®šä¹‰åœ¨å…¨å±€çš„ç›‘å¬å™¨ç§»é™¤æ‰ï¼ˆç”¨æ¥ç›‘å¬ç‚¹å‡» item çš„æ—¶å€™ï¼Œæ”¹å˜ä»–çš„çŠ¶æ€ï¼‰ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªå‡½æ•°ç§»åˆ°äº† <code>render</code> å‡½æ•°é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯å‰é¢æ‰€è®²çš„ <code>updateState</code>ã€‚</p>
<p>** æˆ‘ä»¬è¿˜å¯ä»¥é‡æ„ã€‚ **</p>
<p>ç°åœ¨æˆ‘ä»¬æŠŠ <code>input</code> å’Œ <code>button</code> ä» HTML æ ‡ç­¾å˜æˆå‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ•´ä¸ª HTML æ–‡ä»¶å°±åªå‰©ä¸‹ä¸€ä¸ª <code>div</code> ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">app</span>&gt;</span></div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„ <code>input</code> å…ƒç´ å¾ˆå®¹æ˜“åˆ›å»ºï¼Œå°±è¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> input = createElement(<span class="string">'input'</span>, &#123;id: <span class="string">'input'</span>&#125;)</div></pre></td></tr></table></figure>
<p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠç›‘å¬æœç´¢æ¡†æŒ‰é’®ç‚¹å‡»çš„å…¨å±€å‡½æ•°æ”¾åœ¨æˆ‘ä»¬çš„ <code>SearchBar</code> å‡½æ•°é‡Œé¢ã€‚<code>SearchBar</code> å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª <code>input</code> å’Œä¸€ä¸ª <code>button</code> å…ƒç´ ï¼Œä»–ä¼šé€šè¿‡ <code>props</code> ä¼ è¿›æ¥çš„å›è°ƒå‡½æ•°æ¥å¤„ç†ç‚¹å‡»äº‹ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">functions SearchBar(props) &#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onButtonClick</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> val = $(<span class="string">'#input'</span>).val()</div><div class="line">    $(<span class="string">'#input'</span>).val(<span class="string">''</span>)</div><div class="line">    props.update(val)</div><div class="line">    e.preventDefault()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> input = createElement(<span class="string">'input'</span>, &#123;id: <span class="string">'input'</span>&#125;)</div><div class="line">  <span class="keyword">var</span> button = createElement(<span class="string">'button'</span>, &#123;</div><div class="line">    id: <span class="string">'add'</span>,</div><div class="line">    onClick: onButtonClick.bind(<span class="literal">null</span>)</div><div class="line">  &#125;, <span class="string">'Add'</span>)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> createElement(<span class="string">'div'</span>, &#123;&#125;, &#123;input, button&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„ <code>render</code> å‡½æ•°è°ƒç”¨ <code>SearchBar</code> çš„åŒæ—¶ä¼ é€’æ­£ç¡®çš„ <code>props</code> å‚æ•°ã€‚åœ¨æˆ‘ä»¬æ›´æ–° <code>update</code> å‡½æ•°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æƒ³æƒ³ <em>re-render</em> åº”è¯¥åœ¨å“ªé‡Œè°ƒç”¨æ‰æ˜¯æ­£ç¡®çš„ã€‚é¦–å…ˆï¼Œå¿½ç•¥æˆ‘ä»¬çš„ <code>store</code>ï¼ŒæŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨å¦‚ä½•åœ¨ä¸€ä¸ª high level component ä¸­å¤„ç† <em>state</em>ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½æ˜¯ <em>stateless</em> çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œä»–ä¼šå¤„ç† <em>state</em> ï¼Œä»¥åŠåœ¨é€‚å½“çš„æ—¶å€™æ›´æ–°å­ç»„ä»¶ï¼ˆchildrenï¼‰ã€‚</p>
<p><strong>Container Component</strong></p>
<p>è®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª high level container å§ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¸ºäº†æ›´å¥½ç†è§£ï¼Œä½ å¯ä»¥é˜…è¯» <a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.iy4tfncwt" target="_blank" rel="external">Presentational and Container Component</a>ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬ç»™è¿™ä¸ª container component å–åä¸º <code>App</code>ã€‚ä»–æ‰€åšçš„äº‹æƒ…å°±æ˜¯è°ƒç”¨ <code>SearchBar</code> å’Œ <code>ItemList</code> å‡½æ•°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­é‡æ„ <code>render</code> å‡½æ•°ã€‚å…¶å®å°±æ˜¯æŠŠä»£ç ç§»åˆ° <code>App</code> é‡Œé¢å»è€Œå·²ã€‚</p>
<p>æˆ‘ä»¬ä¸å¦¨å…ˆæ¥çœ‹çœ‹ <code>render</code> ç°åœ¨æ˜¯æ€æ ·å­çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">component, node</span>) </span>&#123;</div><div class="line">  node.empty().append(component)</div><div class="line">&#125;</div><div class="line"></div><div class="line">render(App(state), $(<span class="string">'#app'</span>))</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„ <code>render</code> å‡½æ•°åªæ˜¯ç®€å•åœ°æŠŠæ•´ä¸ªåº”ç”¨æ¸²æŸ“åˆ°æŒ‡å®šçš„èŠ‚ç‚¹ä¸­ã€‚ä½†æ˜¯ï¼ŒReact çš„å®ç°ä¼šæ¯”è¿™ä¸ªå¤æ‚ä¸€ç‚¹ï¼Œè€Œæˆ‘ä»¬ä»…ä»…æŠŠä¸€æ£µ element tree æ·»åŠ åˆ°æŒ‡å®šçš„æ ¹èŠ‚ç‚¹ä¸­è€Œå·²ã€‚ä½†æ˜¯æŠ½è±¡èµ·æ¥ç†è§£çš„è¯ï¼Œè¿™ä¸ªå·²ç»è¶³å¤Ÿäº†ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„ <code>App</code> å‡½æ•°å…¶å®å°±æ˜¯æˆ‘ä»¬æ—§çš„ <code>render</code> å‡½æ•°ï¼Œé™¤äº† DOM æ“ä½œè¢«åˆ æ‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateSearchBar</span> (<span class="params">value</span>) </span>&#123;</div><div class="line">    state.items.push(&#123;</div><div class="line">      id: state.id++,</div><div class="line">      text: value,</div><div class="line">      completed: <span class="literal">false</span></div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateState</span> (<span class="params">toggleId</span>) </span>&#123;</div><div class="line">    state.items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (el.id === toggleId) &#123;</div><div class="line">        el.completed = !el.completed</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    store.setState(state)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> [</div><div class="line">    SearchBar(&#123;update: updateSearchBar&#125;),</div><div class="line">    ItemsList(&#123;items: props.items, onUpdate: updateState&#125;)</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜éœ€è¦æ”¹è¿›ä¸€æ ·ä¸œè¥¿ï¼šæˆ‘ä»¬è®¿é—®çš„ <code>store</code> æ˜¯å…¨å±€çš„ï¼Œå¹¶ä¸”é‡æ–°æ¸²æŸ“çš„è¯éœ€è¦è°ƒç”¨ <code>setState</code> å‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨æ¥é‡æ„ <code>App</code> å‡½æ•°ï¼Œä½¿å¾—ä»–çš„å­ç»„ä»¶é‡æ–°æ¸²æŸ“çš„æ˜¯ä¸éœ€è¦è°ƒç”¨ <code>store</code> ã€‚é‚£ä¹ˆåº”è¯¥è¦æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦å¿½ç•¥ <code>store</code>ï¼Œå¹¶ä¸”æƒ³æƒ³æ€ä¹ˆè°ƒç”¨ <code>setState</code> å‡½æ•°ï¼Œä»è€Œä½¿å¾—ç»„ä»¶å’Œä»–çš„å­ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦è·Ÿè¸ªè¿™ä¸ª high level component å½“å‰çš„çŠ¶æ€ï¼Œå¹¶ä¸”åªè¦ <code>setState</code> ä¸€è°ƒç”¨ï¼Œå°±ç«‹é©¬é‡æ–°æ¸²æŸ“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å®ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getInitialState</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      items: [],</div><div class="line">      id: <span class="number">0</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> _state = getInitialState(),</div><div class="line">    _node = <span class="literal">null</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setState</span> (<span class="params">state</span>) </span>&#123;</div><div class="line">    _state = state</div><div class="line">    render()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// ..</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>getInitialState</code> æ¥åˆå§‹åŒ–æˆ‘ä»¬çš„ <code>state</code> ï¼Œç„¶åæ¯å½“ä½¿ç”¨ <code>setState</code> æ¥æ›´æ–°çŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ <code>render</code> å‡½æ•°ã€‚</p>
<p>è€Œ <code>render</code> å‡½æ•°è¦ä¹ˆåˆ›å»ºä¸€ä¸ª nodeï¼Œè¦ä¹ˆç®€å•åœ°æ›´æ–° nodeï¼Œåªè¦ <code>state</code> å‘ç”Ÿæ”¹å˜ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// naive implement of render</div><div class="line"></div><div class="line">function render () &#123;</div><div class="line">  var children = [</div><div class="line">    SearchBar(&#123;update: updateSearchState&#125;),</div><div class="line">    ItemList(&#123;</div><div class="line">      items: _state.items,</div><div class="line">      onUpdate: updateState</div><div class="line">    &#125;)</div><div class="line">  ]</div><div class="line"></div><div class="line">  if (!_node) &#123;</div><div class="line">    return _node = createElement('div', &#123;class: 'top'&#125;, children)</div><div class="line">  &#125; else &#123;</div><div class="line">    return _node.html(children)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¾ˆæ˜¾ç„¶ï¼Œè¿™å¯¹æ€§èƒ½æ¥è¯´æ˜¯ä¸å¥½çš„ã€‚éœ€è¦çŸ¥é“çš„æ˜¯ï¼ŒReact ä¸­çš„ <code>setState</code> ä¸ä¼šæ¸²æŸ“æ•´ä¸ªåº”ç”¨ï¼Œè€Œæ˜¯ç»„ä»¶å’Œä»–çš„å­ç»„ä»¶ã€‚</p>
<p>ä¸‹é¢æ˜¯ <code>render</code> å‡½æ•°çš„æœ€æ–°ä»£ç ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>App</code> æ—¶ä¸éœ€è¦å¸¦ä»»ä½•å‚æ•°ï¼Œåªæ˜¯éœ€è¦ç®€å•åœ°è°ƒç”¨ <code>getInitialState</code>è¿”å›åˆå§‹çš„çŠ¶æ€ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">component, node</span>) </span>&#123;</div><div class="line">  node.empty().append(component);</div><div class="line">&#125;</div><div class="line">render(App(), $(<span class="string">'#app'</span>));</div></pre></td></tr></table></figure>
<p><a href="http://plnkr.co/edit/ISi8AiVuYSfFIfMy9z6t?p=preview" target="_blank" rel="external">æŸ¥çœ‹çš„æ‰€æœ‰çš„ä»£ç è¯·ç‚¹å‡»è¿™é‡Œ</a></p>
<p><strong>ç»§ç»­æ”¹è¿›</strong></p>
<p>å¦‚æœæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œä»–ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº† <code>setState</code> å‡½æ•°ï¼Œè¿˜èƒ½å¤ŸåŒºåˆ†ä¼ è¿›æ¥ <code>props</code> å’Œ ç»„ä»¶æœ¬èº«è‡ªå·±çš„ <code>state</code>ã€‚</p>
<p>å·®ä¸å¤šå°±åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">var App = createClass(&#123;</div><div class="line">  updateSearchState: function (string) &#123; /*...*/ &#125;,</div><div class="line"></div><div class="line">  updateState: function (obj) &#123; /*... */ &#125;,</div><div class="line"></div><div class="line">  render: function () &#123;</div><div class="line">    var children = [</div><div class="line">      SearchBar(&#123;</div><div class="line">        updateSearchState: this.updateSearchState</div><div class="line">      &#125;),</div><div class="line">      ItemsList(&#123;</div><div class="line">        items: this.state.items,</div><div class="line">        onUpdate: this.updateState</div><div class="line">      &#125;)</div><div class="line">    ]</div><div class="line"></div><div class="line">    return createElement('div', &#123;class: 'top'&#125;, children)</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>å¾ˆå¹¸è¿çš„æ˜¯ï¼Œåœ¨ React ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>React.createClass</code> æ¥åˆ›å»ºç»„ä»¶ã€‚ä»–æä¾›äº†å¾ˆå¤šé€‰æ‹©ï¼Œæ¯”å¦‚ ES6 Class ï¼Œstateless function ç­‰ï¼Œ<a href="https://facebook.github.io/react/docs/reusable-components.html" target="_blank" rel="external">æ›´å¤šè¯·æŸ¥çœ‹æ–‡æ¡£</a>ã€‚</p>
<p>ç»¼ä¸Šï¼Œæˆ‘ä»¬è®²è§£äº†æ•°æ®æµå¦‚ä½•ä»ä¸Šå¾€ä¸‹ï¼Œè€Œäº‹ä»¶ä»ä¸‹å¾€ä¸Šã€‚æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†å¦‚ä½•å¤„ç†ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€ã€‚å…³äº React çš„ä¸œè¥¿ï¼Œè¿˜æœ‰å¾ˆå¤šè¦å­¦ä¹ ã€‚ä¸‹é¢çš„é“¾æ¥ä¹Ÿè®¸å¯ä»¥å¸®åŠ©åˆ°ä½ ã€‚</p>
<p><strong>æ‰©å±•é˜…è¯»</strong></p>
<ul>
<li><a href="https://facebook.github.io/react/docs/thinking-in-react.html" target="_blank" rel="external">Thnking in React</a></li>
<li><a href="https://facebook.github.io/react/docs/getting-started.html" target="_blank" rel="external">Getting Start React</a></li>
<li><a href="https://medium.com/javascript-scene/jsx-looks-like-an-abomination-1c1ec351a918#.59q26eqe0" target="_blank" rel="external">JSX</a></li>
<li><a href="https://github.com/petehunt/react-howto" target="_blank" rel="external">React How to</a></li>
<li><a href="http://jlongster.com/Removing-User-Interface-Complexity,-or-Why-React-is-Awesome" target="_blank" rel="external">Removing User Interface Complexity, or Why React is Awesome</a></li>
<li><a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.kcyewm6ab" target="_blank" rel="external">Presentational and Container Component</a></li>
<li><a href="https://medium.com/@dan_abramov/react-components-elements-and-instances-90800811f8ca#.xis6z3p1z" target="_blank" rel="external">React Component, Elements, and Instances</a></li>
</ul>
<p><strong>ç»“å°¾è¯­</strong></p>
<p>æœ¬æ¥æ‰“ç®—åœ¨è¿™ç¯‡æ–‡ç« è®²è§£å¦‚ä½•åˆ›å»ºä¸€ä¸ª <em>advanced state container</em> ï¼Œå®ç° <em>undo/redo</em> ä»¥åŠæ›´å¤š feature ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºå·²ç»è¶…å‡ºäº†è¿™ç¯‡æ–‡ç« çš„èŒƒå›´ã€‚</p>
<p>å¦‚æœå¤§å®¶æœ‰å…´è¶£çš„è¯ï¼Œæˆ‘ä¹Ÿè®¸ä¼šå†™ Part 2.1ã€‚</p>
<p><em><a href="https://medium.com/javascript-inside/learning-react-without-using-react-part-2-703621a89432#.guh60nwi7" target="_blank" rel="external">åŸæ–‡é“¾æ¥</a></em></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;&lt;a href=&quot;https://medium.com/javascript-inside/learning-react-without-using-react-part-2-703621a89432#.guh60nwi7&quot; target=&quot;_blank&quot; rel=
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ã€Œè¯‘ã€Learning React Without Using React Part 1</title>
    <link href="http://drakeleung.github.io/blog/2016/03/20/Learning-React-Without-Using-React-Part-1/"/>
    <id>http://drakeleung.github.io/blog/2016/03/20/Learning-React-Without-Using-React-Part-1/</id>
    <published>2016-03-20T05:05:34.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>åŸæ–‡é“¾æ¥ï¼š<a href="https://medium.com/javascript-inside/learn-the-concepts-part-1-418952d968cb#.femmquo5d" target="_blank" rel="external">Learning React Without Using React Part 1</a></em></p>
<p>å½“æˆ‘ä»¬è°ˆèµ· React çš„æ—¶å€™æ€»æ˜¯æœ‰å¾ˆå¤šç–‘æƒ‘ã€‚ä¸‹é¢ç®€å•åœ°ä»‹ç»äº† React ä»¥åŠä»–çš„ä¸€äº›åº•å±‚åŸç†ã€‚</p>
<p>å½“ä½ å®Œæˆ Part1 å’Œ Part2 ä¹‹åï¼Œä½ ä¼šå­¦åˆ°ä»€ä¹ˆå‘¢ï¼Ÿä½ ä¹Ÿè®¸å°±ä¼šçŸ¥é“ä½ ä¸ºä»€ä¹ˆéœ€è¦ React ä»¥åŠ Redux ç±»ä¼¼çš„ state container ï¼ˆçŠ¶æ€ç®¡ç†å™¨ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œ<strong>ä½ å¹¶ä¸éœ€è¦å­¦ä¹ </strong>: JSXï¼ŒES6/ES*ï¼ŒWebpackï¼ŒHot Reloadingï¼Œä¹Ÿä¸éœ€è¦ç†è§£ Virtual DOMï¼Œç”šè‡³ä¸éœ€è¦ React æœ¬èº«ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬é¦–å…ˆè¦åšçš„æ˜¯ï¼š</p>
<p>é˜…è¯» <a href="https://github.com/tastejs/todomvc/blob/gh-pages/examples/jquery/js/app.js" target="_blank" rel="external">Jquery å®ç°çš„ TodoMVC</a> çš„ä»£ç ã€‚</p>
<p>ä¹Ÿè®¸ä½ ä¼šæ³¨æ„åˆ°æœ‰ä¸€ä¸ªå« <code>render</code> çš„æ–¹æ³•ï¼Œä»–ä¼šåœ¨æŸä¸ªäº‹ä»¶è§¦å‘æˆ–è€…æ•°æ®æ›´æ–°çš„æ—¶å€™è¢«è°ƒç”¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ä»å¤´æ¥å®ç°ä¸€ä¸ªä¾‹å­ï¼šå½“ <code>input</code> çš„å€¼æ”¹å˜æ—¶ï¼Œè°ƒç”¨ <code>render</code> å‡½æ•°ï¼Œå¹¶ä¸”æ›´æ–° DOM å…ƒç´ ã€‚ï¼ˆ<a href="http://plnkr.co/edit/fjQbQwZpQlhd5wXoc9J8?p=preview" target="_blank" rel="external">ç‚¹å‡»è¿™é‡Œå¯æŸ¥çœ‹å®Œæ•´çš„ä»£ç </a>ï¼‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> state = &#123;value: <span class="literal">null</span>&#125;</div><div class="line"></div><div class="line">$(<span class="string">'#input'</span>).on(<span class="string">'keyup'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  state.value = $(<span class="keyword">this</span>).val().trim()</div><div class="line">  render()</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  $(<span class="string">'#output'</span>).html(state.value)</div><div class="line">&#125;</div><div class="line"></div><div class="line">render()</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡ <code>state</code> æ¥åŒæ­¥æ‰€æœ‰çš„ä¸œè¥¿ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ <em>input</em> çš„å€¼æ”¹å˜æ—¶ä¼šæ›´æ–°ä¸¤æ ·ä¸œè¥¿ï¼š</p>
<ol>
<li>æ›´æ–°æ•´ä¸ªåº”ç”¨çš„ <code>state</code></li>
<li>æ›´æ–° DOMï¼ˆæ ¹æ®åº”ç”¨å½“å‰çš„ <code>state</code> æ¥è°ƒç”¨ <code>render</code> å‡½æ•°ï¼‰</li>
</ol>
<p>å…ˆè®°ä½è¿™äº›ï¼Œæˆ‘ä»¬ç­‰ä¸€ä¸‹å°±ä¼šè¿”å›æ¥ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ–°æƒ³æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'&lt;div&gt;'</span> + text + <span class="string">'&lt;/div&gt;'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ˜¾ç„¶ï¼Œè°ƒç”¨ <code>output(foo)</code> å°±ä¼šè¿”å› <code>'&lt;div&gt;foo&lt;/div&gt;'</code>ã€‚</p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">h2</span> (<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'&lt;h2&gt;'</span> + text + <span class="string">'&lt;/h2&gt;'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">div</span> (<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'&lt;div&gt;'</span> + text + <span class="string">'&lt;/div&gt;'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">header</span> (<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> div(h2(text))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(header(<span class="string">'foo'</span>) === <span class="string">'&lt;div&gt;&lt;h2&gt;foo&lt;/h2&gt;&lt;/div&gt;'</span>) <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„å‡½æ•°éƒ½æ˜¯åŸºäºä¸€ä¸ª <em>text(input)</em> ç„¶åè¿”å›ä¸€ä¸ª <em>string(text)</em> ã€‚è°ƒç”¨ <code>header</code> çš„æ—¶å€™ä¼ å…¥ç›¸åŒçš„å‚æ•°ï¼ˆ<em>input</em>ï¼‰ï¼Œéƒ½ä¼šå¾—åˆ°ç›¸åŒçš„å­—ç¬¦ä¸²ï¼ˆ<em>output</em>ï¼‰ã€‚å¦‚æœä½ åœ¨æƒ³æ€è€ƒ React ä¸­çš„ <strong>stateless functions</strong> çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå…¶å®å°±æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆã€‚åªæ˜¯ Stateless functions ä¼šè¿”å›ä¸€ä¸ª React Element è€Œä¸æ˜¯ä¸€ä¸ªç®€å•çš„ string ï¼Œä½†æ˜¯æ€è·¯æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªæƒ³æ³•åº”ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ä¸­ã€‚æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª <code>button</code>ï¼Œç”¨æ¥æ·»åŠ  todo item ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> state = &#123;items: [], id: <span class="number">0</span>&#125;</div><div class="line"></div><div class="line">$(<span class="string">'#add'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> value = $(<span class="string">'#input'</span>).val().trim()</div><div class="line">  $(<span class="string">'#input'</span>).val(<span class="string">''</span>)</div><div class="line"></div><div class="line">  state.items.push(&#123;</div><div class="line">    id: state.id++,</div><div class="line">    text: value,</div><div class="line">    completed: <span class="literal">false</span></div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  render()</div><div class="line">&#125;)</div><div class="line"></div><div class="line">$(<span class="string">'#list'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> toggleId = <span class="built_in">parseInt</span>($(<span class="keyword">this</span>).attr(<span class="string">'id'</span>))</div><div class="line"></div><div class="line">  state.items.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</div><div class="line">    el.id === toggleId &amp;&amp; (el.completed = !el.completed)</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  render()</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> items = state.items.map(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> completed = item.completed ? <span class="string">'completed'</span> : <span class="string">''</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="string">'&lt;li class="item + '</span> + completed + <span class="string">'" id="'</span> + item.id + <span class="string">'"&gt;('</span> +</div><div class="line">      item.id + <span class="string">') '</span> + item.text + <span class="string">'&lt;/li&gt;'</span></div><div class="line">  &#125;).join(<span class="string">''</span>)</div><div class="line"></div><div class="line">  <span class="keyword">var</span> html = <span class="string">'&lt;ul&gt;'</span> + items = <span class="string">'&lt;/ul&gt;'</span></div><div class="line"></div><div class="line">  $(<span class="string">'#list'</span>).html(html)</div><div class="line">&#125;</div><div class="line"></div><div class="line">render()</div></pre></td></tr></table></figure>
<p>æ•ˆæœå›¾å¦‚ä¸‹ã€‚æˆ‘ä»¬çš„åº”ç”¨ç°åœ¨å¯ä»¥æ˜¾ç¤ºæ‰€æœ‰çš„ todoï¼Œä¹Ÿå¯ä»¥æ”¹å˜æ¯ä¸ª todo çš„çŠ¶æ€ï¼ˆè¿›è¡Œä¸­æˆ–è€…å®Œæˆï¼‰ã€‚</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*ouOYh6bI3q_8y1XLCoVD-A.png" alt="simple todo lsit"></p>
<p>åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ª <code>click</code> äº‹ä»¶ï¼Œå½“ä»–ä»¬è§¦å‘æ—¶å°±ä¼šæ›´æ–°æˆ‘ä»¬çš„ <code>state</code> ä»¥åŠè°ƒç”¨ <code>render</code> å‡½æ•°ã€‚è€Œ <code>render</code> å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ª todo list ã€‚ <code>state</code> ä½œä¸ºä¸­é—´åª’ä»‹ï¼Œç®€åŒ–äº†äº‹ä»¶å’Œ DOM å…ƒç´ ä¹‹é—´çš„äº¤äº’ï¼Œè€Œä¸æ˜¯** é€šè¿‡äº‹ä»¶æ¥ç›´æ¥æ“ä½œ DOM ** ï¼ˆä¸éœ€è¦å®šä¹‰æ¯ä¸ª DOM å…ƒç´ å’Œæ¯ä¸ªäº‹ä»¶ä»¥åŠä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼‰ã€‚å½“æŸä¸ª <em>action</em>ï¼ˆå¦‚ click äº‹ä»¶ï¼‰ è§¦å‘ä¹‹åï¼Œ<code>state</code> å°±ä¼šæ›´æ–°ï¼Œæ¥ç€è°ƒç”¨ <code>render</code> å‡½æ•°ï¼Œæœ€åæˆ‘ä»¬çš„åº”ç”¨å°±ä¼šæ›´æ–°ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±ç®€åŒ–äº†å¥½å¤šå¤æ‚çš„äº¤äº’ã€‚</p>
<p>ä¸Šé¢çš„ä¾‹å­æ˜¯å¾ˆå¥½çš„ï¼Œæˆ‘ä»¬ä¸å¦¨å†æ¥é‡æ„ä»–ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>render</code> å‡½æ•°æœ‰ä¸€ç‚¹ä¹±ã€‚æˆ‘ä»¬ä¸å¦¨åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œä»–æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼ˆinputï¼‰ï¼Œç„¶ååŸºäºè¿™ä¸ªå‚æ•°è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆoutputï¼‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ItemRow</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> className = props.completed ? <span class="string">' item completed'</span> : <span class="string">'item'</span></div><div class="line">  <span class="keyword">return</span> <span class="string">'&lt;li className="'</span> + className +<span class="string">' "&gt;'</span> + props.text + <span class="string">'&lt;/li&gt;'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ItemsList</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'&lt;ul&gt;'</span> + props.items.map(ItemRow).join(<span class="string">''</span>) + <span class="string">'&lt;/ul&gt;'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çœ‹ï¼Œç°åœ¨æˆ‘ä»¬çš„ <code>render</code> å‡½æ•°ä¼˜ç¾å¤šäº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  $(<span class="string">'#list'</span>).html(ItemsList(&#123;</div><div class="line">    items: state.items</div><div class="line">  &#125;))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœ <code>render</code> å‡½æ•°å¹¶ä¸çŸ¥é“ <code>state</code> æ˜¯ä»€ä¹ˆï¼Œè€Œæ˜¯æœŸæœ›ä¸€ä¸ª <em>input</em> ä½œä¸ºå‚æ•°å‘¢ï¼Ÿå¥½å§ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥é‡æ„ä¸€ä¸‹ <code>render</code> å‡½æ•°ï¼Œä»–æœŸæœ›æ¥æ”¶ä¸€ä¸ª <code>props</code> å¯¹è±¡ï¼ˆè¿™å…¶å®å°±æ˜¯ React Component æ‰€æœŸæœ›çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">props</span>) </span>&#123;</div><div class="line">  $(<span class="string">'#list'</span>).html(ItemsList(&#123;</div><div class="line">    items: props.items</div><div class="line">  &#125;))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œ<code>render</code> å‡½æ•°å¹¶ä¸ä¾èµ–å¤–éƒ¨çš„çŠ¶æ€ï¼ˆstateï¼‰ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬åœ¨è°ƒç”¨ <code>render</code> æ—¶å¯ä»¥éšä¾¿ä¼ å…¥ä¸€ä¸ª <em>input</em> ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬çš„åº”ç”¨é‡æ–°æ¸²æŸ“æ—¶ï¼Œç›¸åŒçš„ <em>input</em> ä¼šæœ‰ç›¸åŒçš„ <em>output</em> ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDOM æ“ä½œå…¶å®æ˜¯ä¸€ä¸ª side effectï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æš‚æ—¶å¿½ç•¥ä»–ã€‚</p>
<p>æŠŠ <code>state</code> ä» <code>render</code> å‡½æ•°ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¯ä»¥ä½¿å¾—æˆ‘ä»¬å¾ˆå®¹æ˜“å®ç° <code>Undo/Redo</code>ã€‚è¿™ä¹Ÿæ„å‘³ç€æ¯å½“ * å½“å‰çš„ state * æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ª history ï¼Œä¿å­˜è¿™ä¸ªå½“å‰çš„ state ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªä¼˜åŒ–å°±æ˜¯ä¼ ä¸€ä¸ª root node ä½œä¸ºå‚æ•°ï¼Œè€Œä¸æ˜¯å†™æ­»åœ¨ <code>render</code> å‡½æ•°é‡Œé¢ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">props, node</span>) </span>&#123;</div><div class="line">  node.html(ItemsList(&#123;</div><div class="line">    items: props.items</div><div class="line">  &#125;))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è°ƒç”¨ <code>render</code> å‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">render(state, $(<span class="string">'#list'</span>))</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¼šå¾ˆå®¹æ˜“æƒ³åˆ°ï¼šå½“ <code>state</code> æ”¹å˜çš„æ—¶å€™ï¼Œèƒ½ä¸èƒ½è‡ªåŠ¨åœ°æ›´æ–°åº”ç”¨ï¼Ÿä¹Ÿå°±æ˜¯ï¼Œä¸ç”¨æ‰‹åŠ¨åœ°è°ƒç”¨ <code>render</code> å‡½æ•°ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª <em>store</em> ï¼Œä»–çš„ä½œç”¨æ˜¯å½“ <code>state</code> æ”¹å˜ä¹‹åï¼Œå°±ç«‹é©¬è°ƒç”¨ <code>render</code> å‡½æ•°ã€‚ä¸‹é¢çš„å®ç°è™½ç„¶ç®€å•ï¼Œä½†ä¹Ÿæ˜¯ä¸€ä¸ª advanced state container çš„é›å½¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStore</span> (<span class="params">initialState</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> _state = initialState || &#123;&#125;,</div><div class="line">    _listeners = []</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">updateListeners</span> (<span class="params">state</span>) </span>&#123;</div><div class="line">    _listeners.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">listener</span>) </span>&#123;</div><div class="line">      listener.cb(state)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    setState: <span class="function"><span class="keyword">function</span> (<span class="params">state</span>) </span>&#123;</div><div class="line">      _state = state</div><div class="line">      updateListeners(state)</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    getState: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> _state</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    onUpdate: <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</div><div class="line">      _listeners.push(&#123;name: name, cb: cb&#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ›´æ–° <code>state</code> åªéœ€è¦ç®€å•åœ°è°ƒç”¨ <code>setState</code> æ–¹æ³•ã€‚åªè¦ <code>state</code> ä¸€æ”¹å˜ï¼Œæˆ‘ä»¬çš„ <code>render</code> å‡½æ•°å°±ä¼šè¢«è°ƒç”¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = createStore(store)</div><div class="line"></div><div class="line">store.onUpdate(<span class="string">'rootRender'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">state</span>) </span>&#123;</div><div class="line">  render(state, $(<span class="string">'#list'</span>))</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><a href="http://plnkr.co/edit/fjQbQwZpQlhd5wXoc9J8?p=preview" target="_blank" rel="external">ç‚¹å‡»è¿™é‡Œå¯æŸ¥çœ‹å®Œæ•´çš„ä»£ç </a></p>
<p>** ç°åœ¨æˆ‘ä»¬å­¦ä¼šäº†ä»€ä¹ˆï¼Ÿ ** æˆ‘ä»¬çŸ¥é“äº†ç®€å•çš„å•å‘æ•°æ®æµï¼ˆone-way data flowï¼‰çš„åŸåˆ™ã€‚æˆ‘ä»¬ç»™ <code>render</code> å‡½æ•°ä¼ äº†ä¸€ä¸ª <code>state</code> å‚æ•°ï¼Œç„¶å <code>state</code> å°±ä¼šåƒæµæ°´ä¸€æ ·ï¼Œæµåˆ° <code>render</code> å‡½æ•°çš„æ¯ä¸ªå±‚æ¬¡ä¸­ã€‚æ¯”å¦‚ï¼Œ<code>ItemRow</code> å‡½æ•°éœ€è¦ <code>ItemsList</code> ç»™ä»–ä¼ è¿›æ­£ç¡®çš„å‚æ•°ã€‚</p>
<p>æˆ‘ä»¬å·²ç»åˆ›å»ºäº†å¤šä¸ªç»„ä»¶ï¼ˆcomponentï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬æŠŠè¿™äº›ç»„ä»¶ç»„åˆï¼ˆcomposeï¼‰åœ¨ä¸€èµ·ã€‚å›æƒ³ä¸€ä¸‹å‰é¢çš„ <code>header</code> ä¾‹å­ï¼Œæˆ‘ä»¬æŠŠ <code>div</code> å’Œ <code>h2</code> å‡½æ•°ç»„åˆæˆäº†ä¸€ä¸ª <code>header</code> å‡½æ•°ã€‚å¹¶ä¸”ï¼Œè¿™äº›å‡½æ•°éƒ½æ˜¯ <em>pure function</em> ï¼Œè¿™ä½¿å¾—æ‰€æœ‰æ›´æ–°éƒ½æ˜¯å¯é¢„æµ‹çš„ã€‚</p>
<p>å¹¶ä¸”ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <em>store</em> æ¥ç®¡ç†æˆ‘ä»¬çš„ <code>state</code>ã€‚</p>
<p>è€Œï¼ŒReact ä¼šç”¨æ›´å¥½æ›´ä¼˜ç¾çš„æ–¹æ³•æ¥å®ç°ä¸Šé¢è¿™äº›ä¸œè¥¿ã€‚ç»„ä»¶ï¼ˆç»„åˆï¼‰ï¼Œä½¿ç”¨ Virtual DOM ä¼˜åŒ–æ¸²æŸ“ï¼Œå•å‘æ•°æ®æµç­‰ç­‰ã€‚</p>
<blockquote>
<p>â€¦we can focus on examining Reactâ€™s true strengths: composition, unidirectional data flow, freedom from DSLs, explicit mutation and static mental model.</p>
</blockquote>
<p>From <a href="https://medium.com/@dan_abramov/youre-missing-the-point-of-react-a20e34a51e1a" target="_blank" rel="external">Dan Abramov - youâ€™re missing the point of react</a></p>
<p>æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–çš„ä¸œè¥¿è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ç»§ç»­ä¼˜åŒ– state containerï¼Œé‡æ„æˆ‘ä»¬çš„ listenersï¼Œå®ç° undo/redoï¼Œä»¥åŠæ›´å¤šæ›´å¥½çš„ featureã€‚<strong>è¿™äº›ä¸œè¥¿æˆ‘ä»¬éƒ½ä¼šåœ¨ Part 2 å‘ˆç°</strong>ã€‚</p>
<p><em>åŸæ–‡é“¾æ¥ï¼š<a href="https://medium.com/javascript-inside/learn-the-concepts-part-1-418952d968cb#.femmquo5d" target="_blank" rel="external">Learning React Without Using React Part 1</a></em></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://medium.com/javascript-inside/learn-the-concepts-part-1-418952d968cb#.femmquo5d&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Medium æ˜¯å¦‚ä½•åŠ è½½å›¾ç‰‡çš„ï¼Ÿ</title>
    <link href="http://drakeleung.github.io/blog/2016/03/01/How-Medium-Load-Images/"/>
    <id>http://drakeleung.github.io/blog/2016/03/01/How-Medium-Load-Images/</id>
    <published>2016-03-01T09:11:29.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="what"><a class="header-anchor" href="#what">#</a>What</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ Medium åŠ è½½å›¾ç‰‡çš„æ•ˆæœæ˜¯æ€æ ·å­çš„ï¼š</p>
<div class="video-container"><iframe src="//player.vimeo.com/video/157258221" frameborder="0" allowfullscreen></iframe></div>
<p>æˆ‘çš„<a href="http://drakeleung.github.io/blog/">åšå®¢é¦–é¡µ</a>ä¹Ÿå®ç°äº†è¿™ç§æ•ˆæœã€‚ä¸‹é¢æˆ‘ä»¬å°±åˆ†æå¦‚ä½•å®ç°ã€‚</p>
<h2 id="how"><a class="header-anchor" href="#how">#</a>How</h2>
<p>æˆ‘ä»¬éšä¾¿æ‰“å¼€ Medium ä¸­æœ‰å›¾ç‰‡çš„<a href="https://medium.com/tag/javascript" target="_blank" rel="external">é¡µé¢</a>ï¼Œç„¶å <em>å®¡æŸ¥å…ƒç´ </em>ï¼Œå°±å¯ä»¥å¾—åˆ°ï¼š</p>

<p>ç®€åŒ–ä¹‹åå¾—åˆ°ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prossiveMedia"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"img-samll"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">canvas</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"img-large"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></div></pre></td></tr></table></figure>
<p>å®ç°çš„è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä½¿ç”¨ä¸€ä¸ª <code>placeholder</code> æ¥é˜²æ­¢å›¾ç‰‡ <em>collapse</em>ã€‚</li>
<li>å…ˆåŠ è½½ä¸€ä¸ªå¾ˆå°çš„å›¾ç‰‡</li>
<li>å½“è¿™ä¸ªå°å›¾ç‰‡åŠ è½½å®Œæ¯•ä¹‹åï¼ŒæŠŠä»–ç”»åœ¨ <code>&lt;canvas&gt;</code> é‡Œé¢ï¼Œç„¶åæŠŠå›¾ç‰‡å¼„æ¨¡ç³Šã€‚</li>
<li>å½“å¤§å›¾ç‰‡åŠ è½½å®Œæ¯•ä¹‹åï¼Œæ˜¾ç¤ºä»–ã€‚</li>
</ol>
<h2 id="do-it"><a class="header-anchor" href="#do-it">#</a>Do it</h2>
<p>é¦–å…ˆï¼ŒHTML ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"banner"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">img</span></span></div><div class="line">    <span class="attr">class</span>=<span class="string">"img-small"</span></div><div class="line">    <span class="attr">src</span>=<span class="string">"https://cdn-images-1.medium.com/freeze/max/27/1*sg-uLNm73whmdOgKlrQdZA.jpeg?q=20"</span></div><div class="line">    <span class="attr">data-large</span>=<span class="string">"https://cdn-images-1.medium.com/max/1800/1*sg-uLNm73whmdOgKlrQdZA.jpeg"</span></div><div class="line">   &gt;</div><div class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>.placeholder</code> æ˜¯ç”¨æ¥æ’‘èµ· <code>.banner</code> çš„é«˜åº¦ã€‚å› ä¸ºå¦‚æœæˆ‘ä»¬æƒ³è¦è®©ä¸¤å¼ å›¾ç‰‡é‡å çš„è¯ï¼Œä¼šç”¨åˆ° <code>position: absolute</code>ï¼Œå®šä½å…ƒç´ ä¼šè„±ç¦»æ–‡æ¡£æµï¼Œé‚£ä¹ˆ <code>.banner</code> çš„é«˜åº¦å°±ä¼šä¸º <code>0</code>ã€‚</p>
<p><code>.img-small</code> é¦–å…ˆåŠ è½½çš„æ˜¯å°å›¾ç‰‡ã€‚å¤§å›¾ç‰‡çš„ URL æ”¾åœ¨äº† <code>data-large</code> å±æ€§é‡Œé¢ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯ï¼ŒCSSéƒ¨åˆ†ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.banner</span> &#123;</div><div class="line">  <span class="attribute">position</span>: relative;</div><div class="line">  <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.placeholder</span> &#123;</div><div class="line">  <span class="attribute">padding-bottom</span>: <span class="number">66.6%</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">img</span> &#123;</div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">transition</span>: opacity <span class="number">1s</span> linear;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">img</span><span class="selector-class">.loaded</span> &#123;</div><div class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.img-small</span> &#123;</div><div class="line">  <span class="attribute">filter</span>: <span class="built_in">blur</span>(50px);</div><div class="line">  <span class="attribute">-webkit-filter</span>: <span class="built_in">blur</span>(50px);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>.banner</code> è®¾ç½®äº† <code>relative</code>ï¼Œæ‰€ä»¥ä»–æˆä¸ºäº†ä»– children (<code>.placeholder</code>, <code>img</code>) çš„ <em>containning block</em> äº†ã€‚</p>
<p>æ³¨æ„åˆ°ï¼Œ<code>.placeholder</code> è®¾ç½®äº† <code>padding-bottom: 66.6%</code>ã€‚<code>66.6%</code> æ˜¯ç›¸å¯¹äºä»–çš„ <em>containning block</em> çš„å®½åº¦ï¼Œä¹Ÿå°±æ˜¯ <code>.banner</code> çš„å®½åº¦ã€‚<br>
è¿™ä¸ªå€¼åº”è¯¥å’Œ <code>img</code> çš„é«˜åº¦ä¸€æ ·ï¼Œè¿™æ ·ä¸€æ¥ï¼Œ<code>.banner</code> çš„é«˜åº¦å°±æ˜¯ <code>img</code> çš„é«˜åº¦äº†ã€‚</p>
<p>åˆ©ç”¨ <code>transition</code> è®©é€æ˜åº¦å˜åŒ–æœ‰ä¸ªæ¸å˜æ•ˆæœã€‚</p>
<p>å®ç°æ¨¡ç³Šæ•ˆæœæ˜¯ä½¿ç”¨äº† <code>filter: blur()</code>ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨ <code>&lt;canvas&gt;</code>ã€‚</p>
<p>ç„¶åï¼ŒJavaScript ä»£ç éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> app = (() =&gt; &#123;</div><div class="line">  <span class="keyword">const</span> imgSmall = <span class="built_in">document</span>.querySelector(<span class="string">'.img-small'</span>)</div><div class="line"></div><div class="line">  <span class="keyword">const</span> loadImage = () =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> img = <span class="keyword">new</span> Image()</div><div class="line"></div><div class="line">    img.src = imgSmall.src</div><div class="line">    img.addEventListener(<span class="string">'load'</span>, (e) =&gt; &#123;</div><div class="line">      imgSmall.classList.add(<span class="string">'loaded'</span>)</div><div class="line">    &#125;, <span class="literal">false</span>)</div><div class="line"></div><div class="line">    <span class="keyword">const</span> imgLarge = <span class="keyword">new</span> Image()</div><div class="line"></div><div class="line">    imgLarge.src = imgSmall.dataset.large</div><div class="line">    imgLarge.addEventListener(<span class="string">'load'</span>, (e) =&gt; &#123;</div><div class="line">      imgLarge.classList.add(<span class="string">'loaded'</span>)</div><div class="line">    &#125;, <span class="literal">false</span>)</div><div class="line"></div><div class="line">    imgSmall.parentNode.appendChild(imgLarge)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    loadImage</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;)()</div><div class="line"></div><div class="line">app.loadImage()</div></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ç›‘å¬ <code>.img-small</code> çš„ <code>load</code> äº‹ä»¶ï¼Œè¦ <code>new Image</code>ï¼Œç„¶åèµ‹äºˆå…¶ <code>src</code>ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç›‘å¬ä»–çš„ <code>load</code> äº‹ä»¶äº†ã€‚</p>
<p>æœ€åï¼Œä¸ºäº†å‡¸æ˜¾æ•ˆæœï¼Œæˆ‘ä»¬è¦ç¦æ­¢ç¼“å­˜å’Œè®¾ç½®è¾ƒå·®çš„ç½‘ç»œç¯å¢ƒã€‚å…·ä½“åšæ³•å¦‚å›¾ï¼š</p>

<p>å®é™…æ•ˆæœå¦‚ä¸‹ï¼š</p>
<iframe scrolling="no" width="100%" height="300" src="http://jsfiddle.net/5sLzjk99/embedded/js,resources,html,css,result/light" frameborder="0" allowfullscreen></iframe>
<h2 id="resources"><a class="header-anchor" href="#resources">#</a>Resources</h2>
<ul>
<li><a href="https://jmperezperez.com/medium-image-progressive-loading-placeholder/" target="_blank" rel="external">How Medium does progressive image loading</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;what&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#what&quot;&gt;#&lt;/a&gt;What&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ Medium åŠ è½½å›¾ç‰‡çš„æ•ˆæœæ˜¯æ€æ ·å­çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;video-container&quot;&gt;&lt;iframe
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä¸ºä½ çš„JavaScriptä»£ç å†™æµ‹è¯•</title>
    <link href="http://drakeleung.github.io/blog/2016/02/17/Write-Test-For-Your-JavaScript/"/>
    <id>http://drakeleung.github.io/blog/2016/02/17/Write-Test-For-Your-JavaScript/</id>
    <published>2016-02-17T11:32:51.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸‹é¢ä¼šè®²è§£å¦‚ä½•ä½¿ç”¨ karama, jasmine ä»¥åŠ webpackï¼Œæ¥ä¸ºæˆ‘ä»¬çš„ ES6 ä»£ç ç¼–å†™æµ‹è¯•ã€‚<br>
ï¼ˆæœ€åæˆ‘å†™äº†ä¸€ä¸ªå¯ç”¨çš„ä¾‹å­ï¼Œè¯·æŸ¥çœ‹ <a href="https://github.com/DrakeLeung/ES2015-Starter-Kit/tree/master" target="_blank" rel="external">ES2015-Starter-Kit</a> ï¼‰</p>
<h2 id="è‰°éš¾çš„æŠ‰æ‹©"><a class="header-anchor" href="#è‰°éš¾çš„æŠ‰æ‹©">#</a>è‰°éš¾çš„æŠ‰æ‹©</h2>
<blockquote>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å†™æµ‹è¯•ï¼Œç”¨ä»€ä¹ˆå†™ï¼Ÿè‡ªå·±å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¿˜æ˜¯ä½¿ç”¨æŸä¸ªæµ‹è¯•æ¡†æ¶ï¼Ÿ</p>
</blockquote>
<p>çœ‹èµ·æ¥ï¼Œåè€…å¯è§‚ä¸€ç‚¹ã€‚</p>
<blockquote>
<p>ç„¶åï¼Œæœ‰å“ªäº›æµ‹è¯•æ¡†æ¶å¯ä»¥é€‰æ‹©ï¼Ÿé€‰å“ªä¸ªï¼Ÿ</p>
</blockquote>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬ google ä¹‹ï¼Œæ‰¾åˆ° stackoverflow çš„ä¸€ä¸ªé—®é¢˜ <a href="http://stackoverflow.com/questions/300855/javascript-unit-test-tools-for-tdd" target="_blank" rel="external">JavaScript unit test tools for TDD</a>ã€‚</p>
<p>çœ‹äº†é—®é¢˜å›ç­”ï¼Œå¾ˆçº ç»“ï¼Œå¤ªå¤šäº†ä¸çŸ¥é“é€‰æ‹©å“ªä¸ªï¼æœ€åï¼Œæˆ‘å†³å®šé€‰æ‹© <a href="https://karma-runner.github.io/0.13/index.html" target="_blank" rel="external">Karma</a>, <a href="https://github.com/jasmine/jasmine" target="_blank" rel="external">Jasmine</a> å’Œ <a href="http://mochajs.org/" target="_blank" rel="external">Mocha</a> è¿™ä¸‰è€…ä¹‹ä¸€ï¼Œæ ¹æ® Star æ•°é‡ä»¥åŠç»´æŠ¤å›¢é˜Ÿã€‚</p>

<blockquote>
<p>é‚£ä¹ˆï¼Œ<em>Karma</em>, <em>Jasmine</em> ä»¥åŠ <em>Mocha</em> è¿™ä¸‰è€…ä¹‹é—´å“ªä¸ªå¥½ï¼Œæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p>
</blockquote>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬ä¸å¦¨ googleï¼Œæ‰¾åˆ°äº† <a href="http://stackoverflow.com/questions/24391462/what-are-the-differences-between-mocha-chai-karma-jasmine-should-js-etc-te" target="_blank" rel="external">What are the differences between mocha, chai, karma, jasmine, should.js, etc. testing frameworks?</a> è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä»å›ç­”ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š<em>Karma</em> åªæ˜¯ä¸€ä¸ª test runnerï¼Œä»–è´Ÿè´£æä¾› environmentã€‚è€Œ <em>Jasmine</em> å’Œ <em>Mocha</em> æ˜¯ç¼–å†™æµ‹è¯•è„šæœ¬çš„æ¡†æ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹© <em>Karma + Jasmine</em>æˆ–è€… <em>Karma + Mocha</em>ã€‚æˆ‘ä»¬ä¸å¦¨å…ˆé€‰æ‹©å‰è€…~</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<strong>æˆ‘ä»¬è¦ä½¿ç”¨ <em>Karma + Jasmine</em> ç»„åˆæ¥ä¸ºæˆ‘ä»¬çš„ JavaScript ä»£ç å†™æµ‹è¯•</strong>ã€‚</p>
<h2 id="æˆ˜æ–—çš„å·è§’"><a class="header-anchor" href="#æˆ˜æ–—çš„å·è§’">#</a>æˆ˜æ–—çš„å·è§’</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ ¹æ®æ–‡æ¡£ï¼ˆ<a href="https://karma-runner.github.io/0.13/intro/installation.html" target="_blank" rel="external">karma - Installation</a>, <a href="https://karma-runner.github.io/0.13/intro/configuration.html" target="_blank" rel="external">karma - Configuration</a> å’Œ <a href="http://jasmine.github.io/2.0/introduction.html" target="_blank" rel="external">Jasmine - introduction</a>ï¼‰ï¼Œå¾ˆå®¹æ˜“å°±èƒ½æèµ·æ¥ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼šå½“ç¼–å†™å¤šä¸ªæµ‹è¯•è„šæœ¬çš„æ—¶å€™ï¼Œä½ ä¹Ÿè®¸å¯ä»¥ä½¿ç”¨ <code>beforeEach</code> å’Œ <code>afterEach</code>ã€‚ä»–ä»¬åˆ†åˆ«ä¼šåœ¨æ¯ä¸ªæµ‹è¯•ï¼ˆspecï¼‰çš„ä¹‹å‰å’Œä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<h2 id="å‰¯æœ¬"><a class="header-anchor" href="#å‰¯æœ¬">#</a>å‰¯æœ¬</h2>
<p>æœ€åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯<em>å¦‚ä½•ç»“åˆ <a href="http://webpack.github.io/" target="_blank" rel="external">Webpack</a></em> æ¥ä¸ºæˆ‘ä»¬çš„ES6ä»£ç ç¼–å†™æµ‹è¯•ã€‚</p>
<p>æˆ‘ä¸å¾—ä¸æ‰¿è®¤ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„é—®é¢˜ã€‚ç„¶è€Œï¼Œæˆ‘ä¹Ÿé€šè¿‡googleæ‰¾åˆ°äº†ç­”æ¡ˆã€‚</p>
<p>è¯¦ç»†æ•™ç¨‹è¯·çœ‹ <em>VueJS</em> çš„ <a href="https://vuejs.github.io/vue-loader/workflow/testing.html" target="_blank" rel="external">Testing</a> æ–‡æ¡£ã€‚</p>
<h2 id="æˆ˜æ–—çš„è£è€€"><a class="header-anchor" href="#æˆ˜æ–—çš„è£è€€">#</a>æˆ˜æ–—çš„è£è€€</h2>
<p>ä½ å¯ä»¥ä¸ºä½ çš„ä»“åº“å¼„ä¸€ä¸ªäº®æ™¶æ™¶çš„ <a href="https://docs.travis-ci.com/user/status-images/" target="_blank" rel="external">travis ci status image</a>ï¼š</p>
<p><img src="https://travis-ci.org/travis-ci/travis-web.svg?branch=master" alt=""></p>
<p>è¯¦ç»†è®¾ç½®è¯·æŸ¥çœ‹ <a href="https://docs.travis-ci.com/user/getting-started/" target="_blank" rel="external">travis docs</a>ä»¥åŠè¿™ç¯‡æ•™ç¨‹ <a href="http://www.sitepoint.com/testing-javascript-jasmine-travis-karma/" target="_blank" rel="external">Testing JavaScript with Jasmine, Travis, and Karma</a>ã€‚</p>
<p>æœ€åï¼Œå¦‚æœè¿˜æ˜¯ä¸æ‡‚çš„è¯ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘å†™çš„ä¸€ä¸ªä¾‹å­ï¼š<a href="https://github.com/DrakeLeung/ES2015-Starter-Kit/tree/master" target="_blank" rel="external">ES2015-Starter-Kit</a></p>
<h2 id="resources"><a class="header-anchor" href="#resources">#</a>Resources</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/300855/javascript-unit-test-tools-for-tdd" target="_blank" rel="external">JavaScript unit test tools for TDD</a></li>
<li><a href="http://stackoverflow.com/questions/24391462/what-are-the-differences-between-mocha-chai-karma-jasmine-should-js-etc-te" target="_blank" rel="external">What are the differences between mocha, chai, karma, jasmine, should.js, etc. testing frameworks?</a></li>
<li><a href="https://vuejs.github.io/vue-loader/workflow/testing.html" target="_blank" rel="external">vuejs - Testing</a></li>
<li><a href="http://www.sitepoint.com/testing-javascript-jasmine-travis-karma/" target="_blank" rel="external">Testing JavaScript with Jasmine, Travis, and Karma</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸‹é¢ä¼šè®²è§£å¦‚ä½•ä½¿ç”¨ karama, jasmine ä»¥åŠ webpackï¼Œæ¥ä¸ºæˆ‘ä»¬çš„ ES6 ä»£ç ç¼–å†™æµ‹è¯•ã€‚&lt;br&gt;
ï¼ˆæœ€åæˆ‘å†™äº†ä¸€ä¸ªå¯ç”¨çš„ä¾‹å­ï¼Œè¯·æŸ¥çœ‹ &lt;a href=&quot;https://github.com/DrakeLeung/ES2015-Starter-Kit/tr
    
    </summary>
    
    
      <category term="JavaScript" scheme="http://drakeleung.github.io/blog/tags/JavaScript/"/>
    
      <category term="test" scheme="http://drakeleung.github.io/blog/tags/test/"/>
    
  </entry>
  
  <entry>
    <title>å®ç°ä¸€ä¸ªç®€å•çš„ AMD æ¨¡å—åŠ è½½å™¨</title>
    <link href="http://drakeleung.github.io/blog/2016/02/11/implement-a-simple-AMD-module-loader/"/>
    <id>http://drakeleung.github.io/blog/2016/02/11/implement-a-simple-AMD-module-loader/</id>
    <published>2016-02-11T15:32:53.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>(å®Œæ•´ä»£ç è¯·çœ‹<a href="https://github.com/DrakeLeung/tiny-module-loader" target="_blank" rel="external">GitHub - tiny module loader</a>)</p>
<h2 id="what"><a class="header-anchor" href="#what">#</a>What</h2>
<p>ä¸äº†è§£JavaScriptæ¨¡å—åŒ–çš„è¯·çœ‹<a href="http://drakeleung.github.io/blog/2016/02/07/JavaScript-Module-A-Beginner-Guide/">ã€Œè¯‘ã€JavaScript Modules Part1: A Beginner Guide</a>ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ŒAMDè§„èŒƒå®šä¹‰äº†æ¨¡å—åŠ è½½çš„æ–¹å¼æ˜¯å¼‚æ­¥çš„è€Œä¸æ˜¯åŒæ­¥ã€‚</p>
<p>æ¥ç€ï¼Œè¯­æ³•æ˜¯è¿™æ ·å­çš„ï¼š<code>define</code>å‡½æ•°å»è¯·æ±‚ä¾èµ–ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¾èµ–çš„æ¨¡å—æ•°ç»„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°ã€‚å½“ä¾èµ–éƒ½åŠ è½½å®Œæ¯•ä¹‹åï¼Œå°±ä¼šä½œä¸ºå‚æ•°ï¼Œä¼ è¿›è¿™ä¸ªå‡½æ•°é‡Œé¢ã€‚</p>
<h2 id="why"><a class="header-anchor" href="#why">#</a>Why</h2>
<p>ä¸ºäº†æ¢ç©¶ AMD æ¨¡å—åŠ è½½å™¨çš„åŸç†ï¼Œæˆ‘ä»¬ä¸å¦¨å°è¯•ç€ä»é›¶å¼€å§‹å®ç°ä»–ã€‚</p>
<p>æˆ‘ä»¬åªå®ç°ä¸€ä¸ª <code>define</code> å‡½æ•°ã€‚å…¶ä»–åé¢å†æ…¢æ…¢å®Œå–„ã€‚</p>
<h2 id="how"><a class="header-anchor" href="#how">#</a>How</h2>
<p>ä¸»è¦åˆ†æˆ3éƒ¨åˆ†ï¼šä¸‹è½½ä¾èµ–ï¼Œæ‰§è¡Œä¾èµ–å¹¶å¯¼å‡ºï¼Œè¯»å–ä¾èµ–å¹¶æ‰§è¡Œå›è°ƒ(é€’å½’åœ°)ã€‚</p>
<h3 id="ä¸‹è½½ä¾èµ–"><a class="header-anchor" href="#ä¸‹è½½ä¾èµ–">#</a>ä¸‹è½½ä¾èµ–</h3>
<p>æ¥å—ä¸€ä¸ªä¾èµ–æ¨¡å—çš„URLï¼Œç„¶åç”¨Ajaxè¯·æ±‚ã€‚è¿™æ—¶ä¼šè¿”å›åŒ…å«æ–‡ä»¶å†…å®¹çš„å­—ç¬¦ä¸²ã€‚</p>
<p>è¿™ä¸ªå¾ˆç®€å•ï¼Œåªæ˜¯ç”¨<em>Promise</em>ç®€ä¾¿ä¸€ç‚¹è€Œå·²ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// getModule.js</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchDeps = name =&gt;</div><div class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) =&gt; &#123;</div><div class="line">    <span class="keyword">let</span> req = <span class="keyword">new</span> XMLHttpRequest()</div><div class="line"></div><div class="line">    req.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</div><div class="line">      <span class="keyword">if</span> (req.status &lt; <span class="number">400</span>) resolve(req.responseText)</div><div class="line">      <span class="keyword">else</span> reject(req.status)</div><div class="line">    &#125;, <span class="literal">false</span>)</div><div class="line"></div><div class="line">    req.addEventListener(<span class="string">'error'</span>, () =&gt; &#123;</div><div class="line">      reject(req.status)</div><div class="line">    &#125;, <span class="literal">false</span>)</div><div class="line"></div><div class="line">    req.open(<span class="string">'GET'</span>, name, <span class="literal">true</span>)</div><div class="line">    req.send(<span class="literal">null</span>)</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<h3 id="æ‰§è¡Œä¾èµ–"><a class="header-anchor" href="#æ‰§è¡Œä¾èµ–">#</a>æ‰§è¡Œä¾èµ–</h3>
<p>ç”±äºè¯·æ±‚ä¾èµ–è¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä½†æˆ‘ä»¬æƒ³è¦çš„æ˜¯æŠŠè¿™ä¸ªå­—ç¬¦ä¸²å½“ä½œ JavaScript ä»£ç æ¥æ‰§è¡Œï¼Œè§£å†³æ–¹æ³•æœ‰2ç§ï¼Œåˆ†åˆ«æ˜¯ <code>eval()</code> å’Œ <code>new Function()</code>ã€‚æˆ‘ä»¬é‡‡å–åè€…ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•åº”è¯¥å¯ä»¥ï¼šåŠ¨æ€åˆ›å»º <code>&lt;script&gt;</code> æ ‡ç­¾ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// getModule.js</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> currentModule = <span class="literal">null</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> getModule = code =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> <span class="built_in">module</span> = &#123;</div><div class="line">    exports: <span class="literal">null</span>,</div><div class="line">    exported: <span class="literal">false</span>,</div><div class="line">    onExport: []</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  currentModule = <span class="built_in">module</span></div><div class="line">  <span class="keyword">new</span> <span class="built_in">Function</span> (<span class="string">''</span>, code)() <span class="comment">// work with eval(), as well</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="built_in">module</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> &#123;</div><div class="line">  currentModule,</div><div class="line">  getModule</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæˆ‘è§‰å¾—æ˜¯æœ€éš¾çš„é—®é¢˜ï¼šç”±äº <code>new Function()</code> æ‰§è¡Œçš„æ—¶å€™ï¼Œæ˜¯ä¸è¿”å›ä¸œè¥¿çš„ï¼ˆå…¶å®æˆ‘å¹¶ä¸çŸ¥é“ <code>new Function</code> çš„å·¥ä½œåŸç†)ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™ä¾èµ–è™½ç„¶æ˜¯è¯·æ±‚å›æ¥å¹¶æ‰§è¡Œäº†ï¼Œä½†æ˜¯ä»–ä¾ç„¶è¿˜æ²¡æœ‰å¯¼å‡º(<code>exports</code>)ã€‚æ‰€ä»¥ï¼Œè¿”å›çš„ <code>module</code> å¯¹è±¡çš„ <code>exports</code> æ˜¯ <code>null</code>çš„ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬è¿˜ç”¨äº†ä¸€ä¸ªå˜é‡ <code>currentModule</code> è¿˜å­˜å‚¨å½“å‰çš„å˜é‡ã€‚</p>
<h3 id="å¯¼å‡ºä¾èµ–å¹¶æ‰§è¡Œå›è°ƒå‡½æ•°"><a class="header-anchor" href="#å¯¼å‡ºä¾èµ–å¹¶æ‰§è¡Œå›è°ƒå‡½æ•°">#</a>å¯¼å‡ºä¾èµ–å¹¶æ‰§è¡Œå›è°ƒå‡½æ•°</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// myDefine.js</span></div><div class="line"></div><div class="line"><span class="comment">// import &#123;</span></div><div class="line"><span class="comment">//   currentModule,</span></div><div class="line"><span class="comment">//   getModule</span></div><div class="line"><span class="comment">// &#125; from './getModule'</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// import &#123;fetchDeps&#125; from './fetchDeps'</span></div><div class="line"><span class="comment">// import &#123;whenDepsExported&#125; from './whenDepsExported'</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> define = (deps, callback) =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> myModule = currentModule <span class="comment">// #0</span></div><div class="line">  <span class="keyword">const</span> getDeps = deps.map(fetchDeps)</div><div class="line"></div><div class="line">  <span class="built_in">Promise</span>.all(getDeps)</div><div class="line">    .then(codes =&gt; &#123;</div><div class="line">      <span class="keyword">const</span> modules = codes.map(getModule)</div><div class="line"></div><div class="line">      <span class="comment">// #1</span></div><div class="line">      modules.forEach(m =&gt;</div><div class="line">        !m.exported &amp;&amp; m.onExport.push(() =&gt;</div><div class="line">          whenDepsExported(callback, modules, myModule)</div><div class="line">        )</div><div class="line">      )</div><div class="line"></div><div class="line">      whenDepsExported(callback, modules, myModule) <span class="comment">// #2</span></div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>#0</code> æˆ‘ä»¬æŠŠ <code>currentModule</code> èµ‹ç»™ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œè¿™æ ·ä½¿å¾—æ¯ä¸ª <code>define</code> éƒ½æœ‰è‡ªå·±çš„ã€Œæ¨¡å—ã€ã€‚è¿™ä¸ªä¹Ÿæ˜¯å›°æƒ‘äº†æˆ‘å¥½ä¹…çš„ä¸€æ­¥ã€‚æˆ‘ä¹Ÿä¼¼æ‡‚éæ‡‚ï¼Œå› ä¸ºåæ­£å·²ç» work èµ·æ¥äº†= =</p>
<p>è¿™ä¸ªæ—¶å€™é—®é¢˜å°±æ¥äº†ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦é€’å½’åœ°åŠ è½½ä¾èµ–ï¼Œé‚£ä¹ˆï¼Œè‚¯å®šæ˜¯åŠ è½½æœ€å¤–é¢çš„ä¾èµ–ï¼Œç„¶åæ‰åˆ°é‡Œé¢ã€‚å¦‚æœæ²¡æœ‰äº† <code>#1</code>ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œ <code>#2</code>ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å’Œæƒ³æˆ‘ä»¬æƒ³è¦çš„ç›¸åï¼Œå³å…ˆæ‰§è¡Œæœ€é‡Œé¢çš„ä¾èµ–çš„å›è°ƒï¼Œå†æ‰§è¡Œå¤–é¢çš„ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æŠŠæœ€é‡Œé¢çš„æ¨¡å—å…ˆæ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œé¢ï¼Œç„¶åå½“ä»–çš„ä¾èµ–æ‰§è¡Œå®Œä¹‹åï¼Œå†å»æ‰§è¡Œä»–çš„å›è°ƒï¼Œè¿™æ—¶ä»–çš„å›è°ƒçš„å‚æ•°æ‰æœ‰å€¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// whenDepsExported.js</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> whenDepsExported = (cb, deps, myModule) =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (!deps.every(dep =&gt; dep.exported)) <span class="keyword">return</span></div><div class="line"></div><div class="line">  <span class="comment">// params for 'callback of define'</span></div><div class="line">  <span class="keyword">let</span> args = deps.map(dep =&gt; dep.exports)</div><div class="line">  <span class="keyword">let</span> exports = cb.apply(<span class="literal">null</span>, args)</div><div class="line"></div><div class="line">  <span class="comment">// #0</span></div><div class="line">  <span class="keyword">if</span> (myModule) &#123;</div><div class="line">    myModule.exports = exports</div><div class="line">    myModule.exported = <span class="literal">true</span></div><div class="line">    myModule.onExport.forEach(f =&gt; f())</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> exports</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>#0</code> ä¸­ï¼Œæˆ‘ä»¬å¯¼å‡ºäº†ä¾èµ–ï¼Œå¹¶ä¸”æ‰§è¡Œäº† <code>onExport</code> çš„å›è°ƒå‡½æ•°ã€‚</p>
<h2 id="wrap-up"><a class="header-anchor" href="#wrap-up">#</a>Wrap up</h2>
<p>åŸç†çœ‹èµ·æ¥ä¸æ˜¯å¾ˆéš¾ï¼Œä½†è‡ªå·±å®ç°ä¸€éè¿˜æ˜¯æŒºéš¾çš„ã€‚</p>
<p>ä¸è¿‡ AMDï¼ŒCommonJS è¿™äº›è§„èŒƒå€’æ˜¯æ”¹å–„äº† JavaScript æ¨¡å—ç³»ç»Ÿï¼Œä½¿å¾— JavaScript èƒ½å¤Ÿåœ¨è§„æ¨¡è¾ƒå¤§çš„é¡¹ç›®ä¸­æ›´åŠ å®¹æ˜“å¼€å‘ï¼Œä»¥åŠç»´æŠ¤ã€‚</p>
<p>(å®Œæ•´ä»£ç è¯·çœ‹<a href="https://github.com/DrakeLeung/tiny-module-loader" target="_blank" rel="external">GitHub - tiny module loader</a>)</p>
<h2 id="resources"><a class="header-anchor" href="#resources">#</a>Resources</h2>
<ul>
<li><a href="http://eloquentjavascript.net/10_modules.html" target="_blank" rel="external">eloquent javascript - modules</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;(å®Œæ•´ä»£ç è¯·çœ‹&lt;a href=&quot;https://github.com/DrakeLeung/tiny-module-loader&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub - tiny module loader&lt;/a&gt;)&lt;/p&gt;
&lt;h2
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ã€Œè¯‘ã€JavaScript Modules Part2: Module Bundling</title>
    <link href="http://drakeleung.github.io/blog/2016/02/08/JavaScript-Modules-Part-2/"/>
    <id>http://drakeleung.github.io/blog/2016/02/08/JavaScript-Modules-Part-2/</id>
    <published>2016-02-08T07:57:07.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>(åŸæ–‡ï¼š<a href="https://medium.freecodecamp.com/javascript-modules-part-2-module-bundling-5020383cf306#.m5o3ar7dt" target="_blank" rel="external">JavaScript Modules Part 2: Module Bundling</a>)</strong></p>
<p>åœ¨Part 1ï¼Œæˆ‘è®²è§£äº†ä»€ä¹ˆæ˜¯ <em>module</em> ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»–ä»¬ï¼Œä»¥åŠåˆå¹¶ module çš„å„ç§æ–¹æ³•ã€‚åœ¨Part 2ï¼Œæˆ‘ä¼šè®²è§£ä»€ä¹ˆæ˜¯ <em>bundle modules</em> : ä¸ºä»€ä¹ˆè¦ï¼Œä¸åŒæ–¹æ³•çš„å®ç°ï¼Œä»¥åŠ module åœ¨ä»Šåwebå¼€å‘çš„æƒ…å†µã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-module-bundling"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-module-bundling">#</a>ä»€ä¹ˆæ˜¯ module bundling?</h2>
<p>ç®€å•æ¥è¯´ï¼Œ<em>module bundling</em> å…¶å®å°±æ˜¯æŠŠä¸€ç»„ module (ä»¥åŠä»–ä»¬çš„ä¾èµ–)ï¼ŒæŒ‰ç…§æ­£ç¡®çš„é¡ºåºï¼Œæ‰“åŒ…(bundle)åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶(æˆ–è€…ä¸€ç»„æ–‡ä»¶)é‡Œé¢ã€‚ä½†æ˜¯å¯¹äºwebå¼€å‘æ¥è¯´ï¼Œç»†èŠ‚æ‰æ˜¯é­”é¬¼ <img class="emoji" draggable="false" alt="ğŸ˜ƒ" src="https://twemoji.maxcdn.com/2/72x72/1f603.png"></p>
<h2 id="ä¸ºä»€ä¹ˆæŠŠæ‰€æœ‰çš„-module-éƒ½æ‰“åŒ…åœ¨ä¸€èµ·ï¼Ÿ"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæŠŠæ‰€æœ‰çš„-module-éƒ½æ‰“åŒ…åœ¨ä¸€èµ·ï¼Ÿ">#</a>ä¸ºä»€ä¹ˆæŠŠæ‰€æœ‰çš„ module éƒ½æ‰“åŒ…åœ¨ä¸€èµ·ï¼Ÿ</h2>
<p>å½“ä½ æŠŠç¨‹åºåˆ†æˆå¤šä¸ª module çš„æ—¶å€™ï¼Œä½ å¾ˆå¯èƒ½ä¼šæŠŠä»–ä»¬ç»„ç»‡åœ¨ä¸åŒçš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä¸­ã€‚å¶å°”ä½ ä¼šæœ‰ç¬¬ä¸‰æ–¹ module ï¼Œæ¯”å¦‚<code>Underscore</code>æˆ–è€…<code>React</code>ã€‚</p>
<p>é‚£ä¹ˆï¼Œå½“ç”¨æˆ·æµè§ˆä½ çš„é¡µé¢æ—¶ï¼Œè¿™äº›æ–‡ä»¶éƒ½ä¼šé€šè¿‡ <code>&lt;script&gt;</code> æ ‡ç­¾å¼•å…¥åˆ°ä½ çš„ HTML æ–‡ä»¶ã€‚æ¯ä¸ªæ–‡ä»¶å°±éœ€è¦ä¸€ä¸ª <code>&lt;script&gt;</code> æ ‡ç­¾ï¼Œå°±æ„å‘³ç€ï¼Œæµè§ˆå™¨éœ€è¦å•ç‹¬åœ°åŠ è½½æ¯ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªâ€¦æ¥ç€â€¦ä¸€ä¸ªã€‚</p>
<p>â€¦ç„¶è€Œè¿™å¯¹äºé¡µé¢çš„åŠ è½½æ—¶é—´æ˜¯å¾ˆä¸å‹å¥½çš„ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ <em>bundle</em>ï¼Œæˆ–è€… <em>concatenate</em> æ‰€æœ‰çš„æ–‡ä»¶åˆ°ä¸€ä¸ªå¤§æ–‡ä»¶é‡Œé¢(æˆ–è€…ä¸€ç»„æ–‡ä»¶ï¼Œæ ¹æ®æƒ…å†µ)ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘è¯·æ±‚çš„æ•°é‡ã€‚è¿™ä¸ªå°±æ˜¯ä½ å¬åˆ«çš„å¼€å‘äººå‘˜æ‰€è¯´çš„ã€Œbuild stepã€æˆ–è€…ã€Œbuild processã€ã€‚</p>
<p>å¦ä¸€ä¸ªåŠ é€Ÿ bundling æ“ä½œçš„çš„æ–¹æ³•æ˜¯ã€Œminifyã€(å‹ç¼©)ä»£ç ã€‚<em>minification</em> å°±æ˜¯ä»æºä»£ç ä¸­å»é™¤ä¸å¿…è¦çš„å­—ç¬¦(æ¯”å¦‚ï¼Œç©ºæ ¼ï¼Œæ³¨é‡Šï¼Œæ¢è¡Œç¬¦ç­‰)ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸ä»…å‡å°‘äº†ä»£ç çš„å¤§å°ï¼Œè€Œä¸”ä¸å½±å“å…¶æœ¬èº«çš„åŠŸèƒ½ã€‚</p>
<p>æ›´å°‘çš„æ•°æ®å°±æ„å‘³ç€æµè§ˆå™¨å¤„ç†çš„æ—¶é—´æ›´å°‘ï¼Œå› ä¸ºå‡å°‘äº†ä¸‹è½½æ–‡ä»¶çš„æ—¶é—´ã€‚å¦‚æœä½ æ›¾ç»è§è¿‡æ–‡ä»¶åæœ‰åç¼€<code>min</code>ï¼Œæ¯”å¦‚<code>underscore.min.js</code>ï¼Œå…¶å®å°±æ˜¯ç›¸å¯¹äºå®Œæ•´ç‰ˆçš„ä¸€ä¸ªä¸å…·å¯è¯»æ€§ï¼Œå‹ç¼©è¿‡çš„ç‰ˆæœ¬ã€‚</p>
<p>åƒ <em>gulp</em> æˆ–è€… <em>Grunt</em> è¿™æ ·çš„ Task runnersï¼Œå¯¹å¼€å‘è€…æ¥è¯´ï¼Œæ˜¯å¾ˆå®¹æ˜“è¿›è¡Œ<code>concatenations</code>å’Œ<code>minification</code>ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¿è¯äº†ä»£ç å¯¹å¼€å‘è€…çš„å¯è¯»æ€§çš„åŒæ—¶ï¼Œä¹Ÿä¿è¯äº†å¯¹æµè§ˆå™¨çš„ä¼˜åŒ–ã€‚</p>
<h2 id="å®ç°bundle-moduleçš„å„ç§æ–¹æ³•"><a class="header-anchor" href="#å®ç°bundle-moduleçš„å„ç§æ–¹æ³•">#</a>å®ç°bundle moduleçš„å„ç§æ–¹æ³•</h2>
<p>å½“ä½ ä½¿ç”¨æ ‡å‡†çš„ module pattern (å‰é¢è®²è§£çš„)çš„å…¶ä¸­ä¸€ç§æ¥å®šä¹‰ module çš„æ—¶å€™ï¼Œ<em>concatenating</em> å’Œ <em>minifying</em> ä½ çš„æ–‡ä»¶æ˜¯æå¥½çš„ï¼Œä½ æ‰€éœ€è¦åšçš„å°±æ˜¯æŠŠä½ çš„ä¸€å †JavaScriptä»£ç æ‰“åŒ…åœ¨ä¸€èµ·ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“ä½ ä½¿ç”¨æµè§ˆå™¨ä¸èƒ½è§£æçš„éåŸç”Ÿæ¨¡å—ç³»ç»Ÿæ—¶ï¼Œæ¯”å¦‚ CommonJSï¼ŒAMDã€‚ä½ éœ€è¦ä¸€ç§ç‰¹æ®Šçš„å·¥å…·æ¥æŠŠä½ çš„ä»£ç è½¬æ¢æˆæµè§ˆå™¨å¯ä»¥è§£æçš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <em>Browserify</em>ï¼Œ<em>RequireJS</em>ï¼Œ<em>Webpack</em>ï¼Œå’Œå…¶ä»–ã€Œmodule bundlersã€åˆæˆ–è€…ã€Œmodule loadersã€ä¼šå‡ºç°ã€‚</p>
<p>ä¸ºäº† bundling æˆ–è€… loading ä½ çš„ä»£ç ï¼Œmodule bundlers æä¾›äº†å¥½å¤šé¢å¤–çš„ featureã€‚æ¯”å¦‚å½“ä½ ä¿®æ”¹ä»£ç æ—¶è‡ªåŠ¨é‡ç¼–è¯‘ï¼Œè¿˜æœ‰æä¾›è°ƒè¯•æ—¶æ‰€éœ€è¦çš„ source mapsã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ module bundling çš„å‡ ç§æ–¹æ³•:</p>
<h3 id="bundling-commonjs"><a class="header-anchor" href="#bundling-commonjs">#</a>Bundling CommonJS</h3>
<p>ä» Part1 å¯çŸ¥ï¼ŒCommonJS æ˜¯åŒæ­¥åŠ è½½ module çš„ï¼Œè¿™æ˜¯å¾ˆå¥½çš„é™¤äº†å¯¹æµè§ˆå™¨ä¸é€‚ç”¨ä¹‹å¤–ã€‚æˆ‘æåˆ°è¿‡æœ‰è§£å†³æ–¹æ³•â€”â€”å…¶ä¸­ä¸€ç§å°±æ˜¯ä½¿ç”¨ <em>Browserify</em> ã€‚Browserify å¯ä»¥ç»™æµè§ˆå™¨ç¼–è¯‘ CommonJS çš„ moduleã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª <code>main.js</code> æ–‡ä»¶ï¼Œä»– <em>import</em> äº†ä¸€ä¸ªå¯ä»¥è®¡ç®—æ•°ç»„å¹³å‡å€¼çš„ module:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myDependency = <span class="built_in">require</span>(â€˜myDependencyâ€™);</div><div class="line"><span class="keyword">var</span> myGrades = [<span class="number">93</span>, <span class="number">95</span>, <span class="number">88</span>, <span class="number">0</span>, <span class="number">91</span>];</div><div class="line"><span class="keyword">var</span> myAverageGrade = myDependency.average(myGrades);</div></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¾èµ–(<code>myDependency</code>)ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œ<em>Browserify</em> ä¼šé€’å½’åœ°æŠŠ<code>main.js</code>å‰é¢æ‰€æœ‰éœ€è¦çš„moduleæ‰“åŒ…åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶é‡Œ(<code>bundle.js</code>)ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">browserify main.js -o bundle.js</div></pre></td></tr></table></figure>
<p><em>Browserify</em> çš„å®ç°æ–¹æ³•ï¼šä¸ºäº†éå†ä½ æ•´ä¸ªé¡¹ç›®çš„ä¾èµ–ï¼Œä»–ä¼šæŠŠæ¯ä¸ª <code>require</code> è§£ææˆÂ <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank" rel="external">AST</a>ã€‚å½“ä»–è®¡ç®—å‡ºä½ é¡¹ç›®çš„ä¾èµ–å…³ç³»æ—¶ï¼Œä»–å°±ä¼šæŒ‰ç…§æ­£ç¡®çš„é¡ºåºæŠŠä»–ä»¬éƒ½æ‰“åŒ…åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶é‡Œé¢ã€‚å› æ­¤ï¼Œä½ åªéœ€è¦æŠŠä¸€ä¸ªå•ç‹¬çš„ï¼Œå¸¦ä¸Š<code>bundle.js</code>çš„<code>&lt;script&gt;</code>æ ‡ç­¾æ”¾åœ¨ä½ çš„ HTML æ–‡ä»¶é‡Œé¢ã€‚è¿™æ ·ä¸€æ¥ï¼Œåªè¦ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå°±å¯ä»¥åŠ è½½æ‰€æœ‰çš„modulesã€‚è±ªçˆ½~</p>
<p>ç›¸ä¼¼åœ°ï¼Œå¦‚æœä½ æœ‰å¤šä¸ªæ–‡ä»¶ä¸”æœ‰å¤šä¸ªä¾èµ–ï¼Œä½ åªéœ€è¦ç®€å•åœ°å‘Šè¯‰ <em>Browserify</em> ä½ çš„ <code>entry file</code>ï¼Œç„¶ååä¸‹ï¼Œ<em>Browserify</em> å°±ä¼šå¼€å§‹æ–½é­”æ³•ã€‚</p>
<p>æœ€åï¼šå‡†å¤‡å¥½ä½ æ‰“åŒ…å¥½çš„æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨åƒ <em>Minify-JS</em> è¿™æ ·çš„å·¥å…·æ¥å‹ç¼©çš„ä½ çš„ä»£ç ã€‚</p>
<h3 id="bundling-amd"><a class="header-anchor" href="#bundling-amd">#</a>Bundling AMD</h3>
<p>å¦‚æœä½ ä½¿ç”¨AMDï¼Œä¹Ÿè®¸ä½ ä¼šä½¿ç”¨ä¸€ä¸ªåƒ<code>RequireJS</code>æˆ–è€…<code>Curl</code>è¿™æ ·çš„AMDåŠ è½½å™¨ã€‚ä¸€ä¸ªmodule loader(vs. a bundler)ä¼šåŠ¨æ€åœ°åŠ è½½moduleï¼Œå½“ä½ ç¨‹åºéœ€è¦çš„æ—¶å€™ã€‚</p>
<p>æé†’ä¸€ä¸‹ï¼ŒAMDä¸CommonJSä¸åŒçš„åœ°æ–¹ä¹‹ä¸€æ˜¯ï¼Œå‰è€…æ˜¯åŠ¨æ€åŠ è½½æ¨¡å—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº†AMDï¼Œä½ å®é™…ä¸Šä¸éœ€è¦<em>build step</em>(æ‰“åŒ…ä½ æ‰€æœ‰çš„moduleåˆ°ä¸€ä¸ªå•ç‹¬æ–‡ä»¶)ï¼Œå› ä¸ºä½ æ˜¯åŠ¨æ€åŠ è½½moduleâ€”â€”ä¹Ÿå°±æ˜¯åªæœ‰å½“ä½ éœ€è¦moduleçš„æ—¶å€™æ‰å»ä¸‹è½½æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡æµè§ˆçš„æ—¶å€™ï¼Œå°±æŠŠæ‰€æœ‰çš„moduleéƒ½ä¸‹è½½ã€‚</p>
<p>ä½†åœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œç”¨æˆ·æ¯æ¬¡è¡Œä¸ºå°±éœ€è¦è¯·æ±‚ä¸‹è½½å¯¹åº”çš„moduleæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å› æ­¤å¾ˆå¤šwebå¼€å‘è€…ä¸ºäº†é¢å¤–çš„æ€§èƒ½ï¼Œéƒ½ä¼šä½¿ç”¨å·¥å…·å»æ‰“åŒ…å’Œå‹ç¼©ä»–ä»¬çš„AMD modulesï¼Œæ¯”å¦‚<em>RequireJS optimizer</em>ï¼Œ<em>r.js</em>ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒAMDå’ŒCommonJSå…³äºbundlingçš„åŒºåˆ«æ˜¯ï¼šå‰è€…å¯ä»¥ä¸éœ€è¦build stepã€‚é™¤éï¼Œä½ æƒ³<em>push the code live</em>ï¼Œè¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨åƒ<code>r.js</code>è¿™æ ·çš„ä¼˜åŒ–å™¨ã€‚</p>
<p>æ›´å¤šå…³äºCommonJSå’ŒAMDçš„è®¨è®ºï¼Œè¯·æŸ¥çœ‹è¿™ç¯‡æ–‡ç« <a href="http://tomdale.net/2012/01/amd-is-not-the-answer/" target="_blank" rel="external">Tom Daleâ€™s blog</a>Â <img class="emoji" draggable="false" alt="ğŸ˜ƒ" src="https://twemoji.maxcdn.com/2/72x72/1f603.png"></p>
<h3 id="webpack"><a class="header-anchor" href="#webpack">#</a>Webpack</h3>
<p>å°±ç›®å‰çš„bundlersæ¥è¯´ï¼Œ<em>Webpack</em>æ˜¯é”‹èŠ’åˆç°çš„ã€‚ä»–å¯ä»¥è¯†åˆ«ä»»æ„ä¸€ç§æ¨¡å—ç³»ç»Ÿï¼Œæ¯”å¦‚CommonJSï¼ŒAMDæˆ–è€…ES6ã€‚</p>
<p>ä½ ä¹Ÿè®¸ä¼šè¿™æ ·æƒ³åˆ°ï¼šæ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†Browserifyå’ŒRequireJSè¿™æ ·çš„å·¥å…·ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦Webpackã€‚å…¶å®ï¼ŒWebpackæä¾›äº†å¾ˆæœ‰ç”¨çš„featureåƒ<strong>code splitting</strong>â€”æŠŠä½ çš„ä»£ç æ‹†åˆ†æˆåŠ¨æ€åŠ è½½çš„ã€Œchuncksã€ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ çš„webåº”ç”¨æœ‰ä¸€å—ä»£ç æ˜¯åœ¨ç‰¹å®šæƒ…å†µä¸‹æ‰åŠ è½½çš„ï¼Œé‚£ä¹ˆæŠŠæ‰€æœ‰çš„ä»£ç æ‰“åŒ…åœ¨ä¸€ä¸ªå•ç‹¬çš„å¾ˆå¤§çš„æ–‡ä»¶é‡Œé¢å°±ä¸æ˜¯å¾ˆé€‚åˆäº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨<em>code splitting</em>æå–ä»£ç åˆ°æŒ‰éœ€åŠ è½½çš„<em>chunks</em>é‡Œé¢ï¼Œè¿™æ ·å°±é¿å…äº†ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶éœ€è¦åŠ è½½ä½“ç§¯å¾ˆå¤§çš„<code>bundle.js</code>ã€‚</p>
<p><em>Code splitting</em>æ˜¯Webpackæä¾›çš„featureä¹‹ä¸€ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šè®¨è®ºWebpackå’ŒBrowserifyçš„æ–‡ç« ï¼Œä¸å¦¨çœ‹ä¸‹é¢çš„é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://gist.github.com/substack/68f8d502be42d5cd4942" target="_blank" rel="external">https://gist.github.com/substack/68f8d502be42d5cd4942</a></li>
<li><a href="http://mattdesl.svbtle.com/browserify-vs-webpack" target="_blank" rel="external">http://mattdesl.svbtle.com/browserify-vs-webpack</a></li>
<li><a href="http://blog.namangoel.com/browserify-vs-webpack-js-drama" target="_blank" rel="external">http://blog.namangoel.com/browserify-vs-webpack-js-drama</a></li>
</ul>
<h2 id="es6-modules"><a class="header-anchor" href="#es6-modules">#</a>ES6 Modules</h2>
<p>æ¥ä¸‹æ¥æˆ‘ä¼šè®¨è®ºES6 modulesï¼Œä»–ä¹Ÿè®¸åœ¨æœªæ¥è®©ä»¥ä¸Šçš„bundlersçš„ä½¿ç”¨å˜å°‘(ç­‰ä¸€ä¸‹ä½ å°±ä¼šæ˜ç™½æˆ‘åœ¨è®²ä»€ä¹ˆ)ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥ç†è§£ES6 modulesæ˜¯å¦‚ä½•åŠ è½½çš„ã€‚</p>
<p>ES6 modulesä¸AMDï¼ŒCMDæœ€å¤§çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå‰è€…è®¾è®¡æ—¶è€ƒè™‘åˆ°äº†é™æ€åˆ†æ(static analysis)ã€‚è¿™å°±æ„å‘³ç€ï¼Œå½“ä½ <code>import</code> æ¨¡å—æ—¶ï¼Œè¿™ä¸ª<code>import</code>åŠ¨ä½œåœ¨ç¼–è¯‘çš„æ—¶å€™å°±å®Œæˆäº†ã€‚ä¹Ÿå°±æ˜¯ï¼Œåœ¨æ‰§è¡Œè„šæœ¬ä¹‹å‰ï¼Œå¯ä»¥è®©æˆ‘ä»¬ç§»é™¤æ‰ä¸éœ€è¦çš„<code>exports</code>ã€‚ç§»é™¤æ‰ä¸å¿…è¦çš„<code>exports</code>ä¸ä½†å¯ä»¥å‡å°‘ç©ºé—´ï¼Œè¿˜èƒ½å‡è½»æµè§ˆå™¨çš„å‹åŠ›ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šè¿™ä¸ªå’Œ<em>dead code elimination</em>(å¦‚ä½¿ç”¨UglifyJSå»å‹ç¼©ä»£ç )æœ‰ä»€ä¹ˆä¸åŒï¼Ÿç­”æ¡ˆæ˜¯ï¼š<strong>çœ‹æƒ…å†µ</strong>ã€‚</p>
<p>(æ³¨æ„ï¼š<em>Dead code elimination</em>å…¶å®æ˜¯ç§»é™¤æ‰ä¸å¿…è¦çš„ä»£ç å’Œå˜é‡ã€‚ä¸å¦¨è¿™æ ·æƒ³ï¼šä»–æ˜¯æŠŠä½ <strong>æ‰“åŒ…å</strong>çš„ç¨‹åºçš„å¤šä½™çš„ä»£ç å’Œå˜é‡ç§»é™¤æ‰ã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œ<em>dead code elimination</em>åœ¨ES6 moduleå’ŒUglifyJSä¸­æ˜¯ä¸€æ ·çš„ï¼Œä½†æœ‰æ—¶å€™åˆä¸æ˜¯ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šä½ å¯ä»¥æŸ¥çœ‹åœ¨<a href="https://github.com/rollup/rollup" target="_blank" rel="external">Rollupâ€™s wiki</a>çš„ä¸€ä¸ªå¾ˆæ£’çš„ä¾‹å­ã€‚</p>
<p>ES6ä¸åŒçš„åœ°æ–¹åœ¨äºå®ç°dead code eliminationçš„æ–¹æ³•ï¼Œå«<strong>tree shaking</strong>ã€‚Tree shakingå®é™…ä¸Šä¸dead code eliminationçš„ç†å¿µæ˜¯ç›¸åçš„ã€‚ä»–åªæ‰“åŒ…äº†ä½ æ‰€å¿…éœ€çš„ä»£ç ï¼Œè€Œä¸æ˜¯æŠŠä¸éœ€è¦çš„ä»£ç ç§»é™¤æ‰ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹tree shakingçš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª<code>util.js</code>æ–‡ä»¶ ï¼Œä»–æœ‰å¤šä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç”¨ES6çš„è¯­æ³•æ¥å¯¼å‡ºä»–ä»¬ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">each</span>(<span class="params">collection, iterator</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(collection)) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; collection.length; i++) &#123;</div><div class="line">      iterator(collection[i], i, collection);</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> collection) &#123;</div><div class="line">      iterator(collection[key], key, collection);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">collection, test</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> filtered = [];</div><div class="line">  each(collection, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (test(item)) &#123;</div><div class="line">      filtered.push(item);</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> filtered;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">map</span>(<span class="params">collection, iterator</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> mapped = [];</div><div class="line">  each(collection, <span class="function"><span class="keyword">function</span>(<span class="params">value, key, collection</span>) </span>&#123;</div><div class="line">    mapped.push(iterator(value));</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> mapped;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reduce</span>(<span class="params">collection, iterator, accumulator</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> startingValueMissing = accumulator === <span class="literal">undefined</span>;</div><div class="line">  each(collection, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (startingValueMissing) &#123;</div><div class="line">      accumulator = item;</div><div class="line">      startingValueMissing = <span class="literal">false</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      accumulator = iterator(accumulator, item);</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> accumulator;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬å¹¶ä¸çŸ¥é“æˆ‘ä»¬éœ€è¦<code>util.js</code>çš„å“ªä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ï¼Œåœ¨<code>main.js</code>ä¸­æˆ‘ä»¬è¿™æ ·å¼•å…¥ä»–ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Utils <span class="keyword">from</span> â€˜./utils.jsâ€™;</div></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬å¼€å§‹ä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Utils <span class="keyword">from</span> â€˜./utils.jsâ€™;</div><div class="line"></div><div class="line">Utils.each([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="built_in">console</span>.log(x) &#125;);</div></pre></td></tr></table></figure>
<p>è€Œï¼Œ<code>main.js</code>è¢«<em>tree shaking</em>ç¼–è¯‘ä¹‹åï¼Œæ˜¯é•¿è¿™æ ·çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">each</span>(<span class="params">collection, iterator</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(collection)) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; collection.length; i++) &#123;</div><div class="line">      iterator(collection[i], i, collection);</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> collection) &#123;</div><div class="line">      iterator(collection[key], key, collection);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">each([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(x)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°ï¼Œåªæœ‰æˆ‘ä»¬ä½¿ç”¨çš„<code>each</code>è¢«å¼•å…¥äº†ï¼Œè€Œä¸æ˜¯<code>util.js</code>é‡Œæ‰€æœ‰çš„å‡½æ•°ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>filter</code>å‡½æ•°è€Œä¸æ˜¯<code>each</code>çš„è¯ï¼Œæˆ‘ä»¬çš„<code>main.js</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Utils <span class="keyword">from</span> â€˜./utils.jsâ€™;</div><div class="line">Utils.filter([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x === <span class="number">2</span> &#125;);</div></pre></td></tr></table></figure>
<p>tree shaking ç¼–è¯‘åï¼Œ<code>main.js</code>å˜æˆäº†è¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">each</span>(<span class="params">collection, iterator</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(collection)) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; collection.length; i++) &#123;</div><div class="line">      iterator(collection[i], i, collection);</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> collection) &#123;</div><div class="line">      iterator(collection[key], key, collection);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">collection, test</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> filtered = [];</div><div class="line">  each(collection, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (test(item)) &#123;</div><div class="line">      filtered.push(item);</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> filtered;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">filter([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> x === <span class="number">2</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°è¿™ä¸ªæ—¶å€™,<code>each</code>å’Œ<code>filter</code>éƒ½è¢«å¼•å…¥äº†ï¼Œè¿™æ˜¯å› ä¸º<code>filter</code>å‡½æ•°æ˜¯ä¾èµ–äº<code>each</code>çš„ã€‚</p>
<p>å¾ˆcoolï¼Œå¯¹ä¸å¯¹ï¼Ÿ</p>
<p>æˆ‘å»ºè®®ä½ é€šè¿‡<em>Rollup.js</em>çš„Â <a href="http://rollupjs.org/" target="_blank" rel="external">live demo and editor</a> ï¼Œå»ç©ç©å’Œäº†è§£ä¸€ä¸‹tree shakingã€‚</p>
<h2 id="æ„å»ºes6-modules"><a class="header-anchor" href="#æ„å»ºes6-modules">#</a>æ„å»ºES6 modules</h2>
<p>å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ES6 modulesçš„åŠ è½½å¾ˆå…¶ä»–module formatæ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡è®²æ€ä¹ˆæ„å»ºES6 modulesã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼ŒES6 modules è¿˜éœ€è¦é¢å¤–çš„å·¥ä½œï¼Œå› ä¸ºæµè§ˆå™¨è¿˜æ²¡æœ‰å®ç°åŸç”Ÿçš„ES6 moduleåŠ è½½ã€‚</p>
<p>ä¸‹é¢æœ‰ä¸¤ç§æ–¹æ³•æ¥æ„å»º/è½¬æ¢ ES6 modulesï¼Œä½¿å¾—åœ¨æµè§ˆå™¨ä¸­å¯ä»¥ä½¿ç”¨ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€ç§æ˜¯å½“å‰æœ€å¸¸è§çš„ï¼š</p>
<ol>
<li>ä½¿ç”¨è½¬æ¢å™¨(æ¯”å¦‚ï¼ŒBabelæˆ–è€…Traceur)ï¼ŒæŠŠä½ ES6ä»£ç è½¬æ¢æˆCommonJSï¼ŒAMDæˆ–è€…UMDæ ¼å¼çš„ES5ä»£ç ã€‚ç„¶åæŠŠè½¬æ¢å¥½çš„ä»£ç é€åˆ°ä¸€ä¸ªmodule bundleré‡Œå»ï¼Œæ¯”å¦‚Browserifyæˆ–è€…Webpackï¼Œè¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªæˆ–å¤šä¸ªæ‰“åŒ…å¥½çš„æ–‡ä»¶ã€‚</li>
<li>ä½¿ç”¨<a href="http://rollupjs.org/" target="_blank" rel="external">Rollup.js</a>ï¼šè¿™ç§æ–¹æ³•å’Œå‰é¢çš„å¾ˆç›¸ä¼¼ï¼Œé™¤äº†åœ¨æ‰“åŒ…ä¹‹å‰ä¼šä½¿ç”¨ES6 moduleçš„é™æ€åˆ†æã€‚ä»–åˆ©ç”¨<strong>tree shaking</strong>æŠŠæœ€å°‘çš„ä»£ç é‡æ‰“åŒ…ã€‚æ€»ä½“æ¥è¯´ï¼ŒRollup.jsæ¯”Webpackæˆ–è€…Browserifyæœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œå½“ä½ ä½¿ç”¨ES6 moduleæ—¶ï¼Œå¯ä»¥ä½¿ä½ çš„ä»£ç çš„ä½“ç§¯æ›´å°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRollupæä¾›äº†å¤šç§æ ¼å¼æ¥æ‰“åŒ…ä½ çš„ä»£ç ï¼ŒåŒ…æ‹¬ES6ï¼ŒCommonJSï¼ŒAMDï¼ŒCMDï¼ŒUMDæˆ–è€…IIFEã€‚IIFEå’ŒUMDå¯ä»¥é€‚ç”¨äºä½ çš„æµè§ˆå™¨ï¼Œä½†å¦‚æœä½ é€‰æ‹©äº†AMDï¼ŒCommonJSæˆ–è€…ES6çš„è¯ï¼Œä½ éœ€è¦æ‰¾å…¶ä»–æ–¹æ³•æŠŠä½ çš„ä»£ç è½¬æˆæµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„ï¼Œæ¯”å¦‚ä½¿ç”¨Browserifyï¼ŒWebpackï¼ŒRequireJSç­‰ç­‰ã€‚</li>
</ol>
<h2 id="jumping-through-hoops"><a class="header-anchor" href="#jumping-through-hoops">#</a>Jumping through hoops</h2>
<p>ä½œä¸ºwebå¼€å‘è€…ï¼Œæˆ‘ä»¬éœ€è¦è·³è¿‡è¿™äº›ç¹æ–‡ç¼›èŠ‚ã€‚å› ä¸ºæŠŠES6 modulesä»£ç è½¬æ¢æˆæµè§ˆå™¨å¯ä»¥è§£é‡Šçš„ES5ä¸æ˜¯ä¸€ä»¶æ˜“äº‹ã€‚</p>
<p>é—®é¢˜å°±æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä½¿ç”¨ES6 moduleï¼Œä¸”ä¸ç”¨å¼„ä¸Šé¢è¯´åˆ°çš„ä¸¤ç§æ–¹æ³•å—ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼šå¾ˆå¿«ã€‚</p>
<p>ECMAScriptç°åœ¨å·²ç»æœ‰è§£å†³æ–¹æ¡ˆçš„è§„èŒƒäº†ï¼Œå«åš<a href="https://github.com/ModuleLoader/es6-module-loader" target="_blank" rel="external">ECMAScript 6 module loader API</a>ã€‚ç®€å•ä»‹ç»ï¼Œä»–æ˜¯ä¸€ç§å¯ç¼–ç¨‹çš„ï¼ŒåŸºäºPromiseçš„APIï¼Œå¯ä»¥åŠ¨æ€åŠ è½½ä½ çš„modulesï¼Œå¹¶ä¸”cacheä»–ä»¬ï¼Œä½¿å¾—éšåçš„<code>import</code>ä¸éœ€è¦åŠ è½½å¦å¤–ä¸€ä»½æ–°ç‰ˆæœ¬çš„moduleã€‚</p>
<p>ä»–å¤§æ¦‚æ˜¯è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// myModule.js</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">myModule</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello, I am a module'</span>);</div><div class="line">  &#125;</div><div class="line">  hello() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'hello!'</span>);</div><div class="line">  &#125;</div><div class="line">  goodbye() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'goodbye!'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// main.js</span></div><div class="line"></div><div class="line">System.import(â€˜myModuleâ€™).then(<span class="function"><span class="keyword">function</span>(<span class="params">myModule</span>) </span>&#123;</div><div class="line">  <span class="keyword">new</span> myModule.hello();</div><div class="line">&#125;);</div><div class="line"><span class="comment">// â€˜hello!â€™</span></div></pre></td></tr></table></figure>
<p>å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨<code>script</code>æ ‡ç­¾é‡Œï¼Œç›´æ¥æ³¨æ˜<code>type=module</code>æ¥å®šä¹‰modulesã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt; script type = <span class="string">"module"</span> &gt;</div><div class="line">  <span class="comment">// loads the 'myModule' export from 'mymodule.js'</span></div><div class="line">  <span class="keyword">import</span> &#123;</div><div class="line">    hello</div><div class="line">  &#125; <span class="keyword">from</span> <span class="string">'mymodule'</span>;</div><div class="line"><span class="keyword">new</span> Hello(); <span class="comment">// 'Hello, I am a module!'</span></div><div class="line">&lt; <span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure>
<p>å¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡module loader APIçš„polyfillï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ è‡³å°‘å»<a href="https://github.com/ModuleLoader/es6-module-loader" target="_blank" rel="external">çœ‹ä¸€çœ‹</a>ã€‚</p>
<p>å¦‚æœä½ æƒ³è¦æµ‹è¯•ä¸€ä¸‹è¿™ç§æ–¹æ³•çš„è¯ï¼Œä½ å¯ä»¥è¯•è¯•<a href="https://github.com/systemjs/systemjs" target="_blank" rel="external">SystemJS</a>ã€‚ä»–æ˜¯åŸºäº<a href="https://github.com/ModuleLoader/es6-module-loader" target="_blank" rel="external">ES6 Module Loader polyfill</a>åˆ›å»ºçš„ã€‚ä»–å¯ä»¥åœ¨æµè§ˆå™¨å’ŒNodeç¯å¢ƒä¸­ï¼ŒåŠ¨æ€åœ°åŠ è½½ä»»ä½•æ ¼å¼çš„modules(ES6 modulesï¼ŒAMDï¼ŒCommonJSä»¥åŠå…¨å±€çš„scripts)ã€‚ä»–ä¼šè·Ÿè¸ªæ‰€æœ‰å·²ç»åŠ è½½åˆ°ã€Œmodule registryã€çš„modulesï¼Œé¿å…äº†é‡æ–°åŠ è½½å·²ç»åŠ è½½è¿‡çš„modulesã€‚å€¼å¾—æé†’çš„æ˜¯ï¼Œä»–ä¹Ÿå¯ä»¥è‡ªåŠ¨åœ°è½¬æ¢ES6 modules(å¦‚æœä½ å¼€å¯è¿™ä¸ªoptionçš„è¯)ï¼Œè¿˜å¯ä»¥ä»ä»»ä½•ä¸€ç§æ¨¡å—æ ¼å¼ä¸­åŠ è½½ä»»ä½•ä¸€ç§æ ¼å¼çš„æ¨¡å—ã€‚å¤ªæ£’äº†ã€‚</p>
<h2 id="æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†es6-modules-è¿˜éœ€è¦bundlerså—ï¼Ÿ"><a class="header-anchor" href="#æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†es6-modules-è¿˜éœ€è¦bundlerså—ï¼Ÿ">#</a>æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†ES6 modulesï¼Œè¿˜éœ€è¦bundlerså—ï¼Ÿ</h2>
<p>ES6 modulesçš„é€æ¸æµè¡Œï¼Œäº§ç”Ÿäº†ä¸€äº›æœ‰è¶£çš„é—®é¢˜ï¼š</p>
<h3 id="http-2ä¼šä½¿module-bundlersè¿‡æ—¶å—ï¼Ÿ"><a class="header-anchor" href="#http-2ä¼šä½¿module-bundlersè¿‡æ—¶å—ï¼Ÿ">#</a>HTTP/2ä¼šä½¿module bundlersè¿‡æ—¶å—ï¼Ÿ</h3>
<p>å¯¹äºHTTP/1ï¼Œæˆ‘ä»¬çš„æ¯ä¸ªTCPè¿æ¥åªå…è®¸ä¸€ä¸ªè¯·æ±‚ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŠ è½½å¤šä¸ªèµ„æºéœ€è¦å¤šä¸ªè¯·æ±‚ã€‚æœ‰äº†HTTP/2ï¼Œä¸€åˆ‡éƒ½å˜äº†ã€‚HTTP/2æ˜¯<em>fully multiplexed</em>ï¼Œè¿™å°±æ„å‘³ç€å¤šä¸ªè¯·æ±‚å’Œå¤šä¸ªå“åº”å¯ä»¥å¹¶è¡Œã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­ï¼Œè¿›è¡Œå¤šä¸ªè¯·æ±‚ã€‚</p>
<p>æ—¢ç„¶æ¯ä¸ªHTTP/2è¯·æ±‚çš„å¼€é”€å·²ç»æ¯”HTTP/1å°å¾—å¤šï¼Œé‚£ä¹ˆé•¿è¿œæ¥çœ‹ï¼ŒåŠ è½½ä¸€å †çš„moduleså¹¶ä¸ä¼šé™ä½å¾ˆå¤šçš„æ€§èƒ½ã€‚äºæ˜¯æœ‰äº›äººå°±è®¤ä¸ºï¼Œmodule bundlingå·²ç»ä¸éœ€è¦äº†ã€‚è¿™å…¶å®æ˜¯æœ‰å¯èƒ½çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜è¦è§†æƒ…å†µè€Œå®šã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œmodule bundlingæä¾›äº†HTTP/2æ²¡æœ‰æä¾›çš„ä¼˜ç‚¹ï¼Œåƒç§»é™¤æ‰ä¸éœ€è¦çš„<code>exports</code>ä»è€Œå‡å°‘ç©ºé—´ã€‚å¦‚æœä½ æ­å»ºçš„ç½‘é¡µæ˜¯æ¯ä¸ªå¾®å°çš„<code>bit</code>éƒ½ä¼šå½±å“æ€§èƒ½çš„è¯ï¼Œé‚£ä¹ˆbundlingå°±ç»™äº†ä½ å·¨å¤§çš„å¥½å¤„ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å¯¹æ€§èƒ½è¦æ±‚ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½ å¯ä»¥è·³è¿‡æ„å»ºè¿‡ç¨‹ï¼Œä»è€ŒèŠ‚çœäº†ä¸€äº›æ—¶é—´ã€‚</p>
<p>æ€»èµ·æ¥è¯´ï¼Œæˆ‘ä»¬ç°åœ¨ç¦»äº«å—HTTP/2å¸¦æ¥çš„å¥½å¤„è¿˜å¾ˆè¿œã€‚æˆ‘ä¸ªäººçŒœæµ‹build processè¿˜ä¼šæŒç»­ä¸€æ®µæ—¶é—´ã€‚</p>
<h3 id="commonjs-amdå’Œumdè¿˜è¿‡æ—¶å—ï¼Ÿ"><a class="header-anchor" href="#commonjs-amdå’Œumdè¿˜è¿‡æ—¶å—ï¼Ÿ">#</a>CommonJSï¼ŒAMDå’ŒUMDè¿˜è¿‡æ—¶å—ï¼Ÿ</h3>
<p>ä¸€æ—¦ES6å˜æˆäº†æ ‡å‡†ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœŸçš„è¿˜éœ€è¦éåŸç”Ÿçš„module featureå—ï¼Ÿ</p>
<p>æˆ‘è¡¨ç¤ºæ€€ç–‘ã€‚</p>
<p>å¦‚æœåªéµå¾ªå•ä¸€çš„è¯­æ³•å»åŠ è½½å’Œå¼•å…¥moduleï¼Œå¹¶ä¸”ä¸éœ€è¦ä¸­é—´æ­¥éª¤ï¼Œè¿™å¯¹äºwebå¼€å‘è€…æ¥è¯´å¾ˆæ£’çš„ã€‚ä½†åˆ°è¾¾è¿™ä¸€æ­¥è¿˜éœ€è¦å¤šä¹…å‘¢ï¼Ÿ</p>
<p>æœºä¼šæ˜¯æœ‰çš„ï¼Œä½†éœ€è¦ä¸€æ®µæ—¶é—´ã€‚</p>
<p>å¹¶ä¸”ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥æ ¹æ®è‡ªå·±çš„å£å‘³å»é€‰æ‹©ï¼Œå› æ­¤ã€Œone truthful approachã€å¹¶ä¸ä¼šæˆä¸ºç°å®ã€‚</p>
<h2 id="ç»“è®º"><a class="header-anchor" href="#ç»“è®º">#</a>ç»“è®º</h2>
<p>å½“å¼€å‘è€…è®¨è®ºmoduleså’Œmodule bundlingçš„æ—¶å€™ï¼Œæˆ‘å¸Œæœ›è¿™ä¸¤ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©ä»–ä»¬å˜æ¸…è¿™äº›æœ¯è¯­ã€‚å¦‚æœä½ æœ‰ç–‘é—®çš„è¯ï¼Œä½ å›å¤´çœ‹çœ‹<a href="https://medium.freecodecamp.com/javascript-modules-a-beginner-s-guide-783f7d7a5fcc#.y8hs0nsne" target="_blank" rel="external">part I</a>Â ã€‚</p>
<p>åŒæ ·åœ°ï¼Œå¯ä»¥åœ¨è¯„è®ºä¸­å’Œæˆ‘è®¨è®ºï¼ŒåŒæ—¶éšæ—¶æ¬¢è¿ä½ æé—®é¢˜ã€‚</p>
<p>Happy bundling <img class="emoji" draggable="false" alt="ğŸ˜ƒ" src="https://twemoji.maxcdn.com/2/72x72/1f603.png"></p>
<p><strong>(åŸæ–‡ï¼š<a href="https://medium.freecodecamp.com/javascript-modules-part-2-module-bundling-5020383cf306#.m5o3ar7dt" target="_blank" rel="external">JavaScript Modules Part 2: Module Bundling</a>)</strong></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;(åŸæ–‡ï¼š&lt;a href=&quot;https://medium.freecodecamp.com/javascript-modules-part-2-module-bundling-5020383cf306#.m5o3ar7dt&quot; target=&quot;_blank&quot; r
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://drakeleung.github.io/blog/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>ã€Œè¯‘ã€JavaScript Modules Part1: A Beginner Guide</title>
    <link href="http://drakeleung.github.io/blog/2016/02/07/JavaScript-Module-A-Beginner-Guide/"/>
    <id>http://drakeleung.github.io/blog/2016/02/07/JavaScript-Module-A-Beginner-Guide/</id>
    <published>2016-02-07T13:50:52.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>(åŸæ–‡ï¼š<a href="https://medium.freecodecamp.com/javascript-modules-a-beginner-s-guide-783f7d7a5fcc#.4ufizwkud" target="_blank" rel="external">JavaScript Modules: A Beginnerâ€™s Guide - Preethi Kasireddy</a>)</strong></p>
<p>å¦‚æœä½ æ˜¯åˆšæ¥è§¦ JavaScript çš„è¯ï¼Œåƒã€Œmodule bundler vs. module loadersã€ï¼Œ ã€ŒWebpack vs. Browserifyã€ ä»¥åŠã€ŒAMD vs. CommonJSã€è¿™äº›æœ¯è¯­å¯ä»¥ä¸€ä¸‹å­æŠŠä½ ææ™•ã€‚</p>
<p>JavaScriptçš„æ¨¡å—ç³»ç»Ÿ(module system)ä¹Ÿè®¸æ˜¯å¾ˆå“äººçš„ï¼Œä½†æ˜¯å¯¹äºwebå¼€å‘è€…æ¥è¯´ï¼Œç†è§£ä»–æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
<p>åœ¨æœ¬æ–‡ï¼Œæˆ‘ä¼šä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯(ä»¥åŠä¸€äº›ä»£ç )æ¥è§£é‡Šè¿™äº›æœ¯è¯­ã€‚æˆ‘å¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ã€‚</p>
<p>æ³¨æ„ï¼šä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä¼šåˆ†æˆ2éƒ¨åˆ†æ¥è¯´ï¼šPart 1 ä¼šè§£é‡Šä»€ä¹ˆæ˜¯ <em>module</em> ä»¥åŠä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»–ä»¬ã€‚Part 2 (åœ¨ä¸‹å‘¨å‘è¡¨)ä¼šæ¥ç€è§£é‡Šä»€ä¹ˆæ˜¯ <em>bundle modules</em> ä»¥åŠå…¶å®ç°æ–¹æ³•ã€‚</p>
<h2 id="part-1-æœ‰è°å¯ä»¥å†è§£é‡Šè§£é‡Šä»€ä¹ˆæ˜¯-module-å—ï¼Ÿ"><a class="header-anchor" href="#part-1-æœ‰è°å¯ä»¥å†è§£é‡Šè§£é‡Šä»€ä¹ˆæ˜¯-module-å—ï¼Ÿ">#</a>Part 1: æœ‰è°å¯ä»¥å†è§£é‡Šè§£é‡Šä»€ä¹ˆæ˜¯ module å—ï¼Ÿ</h2>
<p>å¥½çš„ä½œè€…ä¼šæŠŠä»–ä»¬çš„ä¹¦ç±åˆ†æˆå¤šä¸ªç« èŠ‚ï¼›å¥½çš„ç¨‹åºå‘˜ä¹Ÿä¼šæŠŠä»–ä»¬çš„ç¨‹åºåˆ†æˆå¤šä¸ªæ¨¡å—ã€‚</p>
<p>å°±åƒä¹¦çš„ç« èŠ‚ä¸€æ ·ï¼Œmodule åªæ˜¯å•è¯(åœ¨è¿™é‡Œï¼Œå³æ˜¯ code )çš„é›†åˆã€‚</p>
<p>ä½†æ˜¯ï¼Œå¥½çš„æ¨¡å—æ˜¯é«˜åº¦åŒ…å«è‡ªå·±ç‹¬ç«‹çš„åŠŸèƒ½ã€‚è¿™è®©ä»–ä»¬å¯ä»¥æ ¹æ®éœ€æ±‚æ›´æ”¹ï¼Œåˆ é™¤ï¼Œå¢åŠ ï¼Œè€Œä¸æ‰°ä¹±æ•´ä¸ªç³»ç»Ÿã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-module-ï¼Ÿ"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆä½¿ç”¨-module-ï¼Ÿ">#</a>ä¸ºä»€ä¹ˆä½¿ç”¨ module ï¼Ÿ</h2>
<p>ä½¿ç”¨moduleså¯¹äºå¤§å‹ï¼Œç›¸äº’ä¾èµ–çš„ä»£ç åº“æ¥è¯´æ˜¯å¾ˆå¤šå¥½å¤„çš„ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œæœ€é‡è¦çš„æ˜¯ï¼š</p>
<p>**1) å¯ç»´æŠ¤æ€§ï¼š**æ ¹æ®å®šä¹‰ï¼Œmodule æ˜¯ç‹¬ç«‹çš„ã€‚ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ module æ˜¯å°½å¯èƒ½å¤šåœ°å‡å°‘ä»£ç çš„è€¦åˆï¼Œä»è€Œä»–èƒ½å¤Ÿç‹¬ç«‹åœ°å¼€å‘å’Œæ”¹è¿›ã€‚å½“ä¸€ä¸ª module çš„è€¦åˆåº¦ä½çš„æ—¶å€™ï¼Œæ›´æ–°ä»–æ˜¯å¾ˆå®¹æ˜“ä¸€ä»¶äº‹æƒ…ã€‚</p>
<p>å›åˆ°æˆ‘ä»¬ä¹¦ç±çš„ä¾‹å­ï¼Œå½“ä½ å› ä¸ºæ›´æ–°äº†ä¸€ä¸ªç« èŠ‚ï¼Œä»è€Œéœ€è¦è°ƒæ•´å‰©ä½™ç« èŠ‚çš„è¯ï¼Œè¿™ç®€ç›´æ˜¯å™©è€—ã€‚ç›¸åï¼Œä½ æ›´æ„¿æ„ç¼–å†™ç« èŠ‚çš„æ—¶å€™ï¼Œä¸å½±å“å…¶ä»–ç« èŠ‚ã€‚</p>
<p>**2) å‘½åç©ºé—´(namespacing)ï¼š**åœ¨ JavaScript ä¸­ï¼Œåœ¨ top-level å‡½æ•°çš„ä½œç”¨åŸŸçš„å¤–é¢çš„å˜é‡å°±æ˜¯ <em>global</em> (å…¨å±€)å˜é‡ï¼Œå…¨å±€å˜é‡å³æ˜¯æ¯ä¸ªäººéƒ½å¯ä»¥ access ä»–ä»¬ã€‚å› ä¸ºè¿™æ ·ï¼Œå°±å¾ˆå®¹æ˜“é€ æˆ&quot;å‘½åç©ºé—´æ±¡æŸ“â€ï¼Œä¹Ÿå°±æ˜¯æ— ç›¸å…³çš„ä»£ç å…±äº«å…¨å±€å˜é‡ã€‚</p>
<p>åœ¨æ¯«æ— ç›¸å…³çš„ä»£ç ä¸­å…±äº«å…¨å±€å˜é‡åœ¨å¼€å‘ä¸­ <a href="http://c2.com/cgi/wiki?GlobalVariablesAreBad" target="_blank" rel="external">is a big no no</a>ã€‚</p>
<p>åœ¨æœ¬æ–‡çš„ä¸‹é¢ï¼Œæˆ‘ä»¬ä¼šè§£é‡Š module å¯ä»¥è®©æˆ‘ä»¬é¿å…å‘½åç©ºé—´æ±¡æŸ“ï¼Œé€šè¿‡ä¸ºæˆ‘ä»¬çš„å˜é‡åˆ›å»ºç§æœ‰ç©ºé—´ã€‚</p>
<p>**3) å¯é‡ç”¨æ€§ï¼š**æˆ‘ä»¬ä¸å¦¨è€å®æ‰¿è®¤ï¼Œæˆ‘ä»¬è¿‡å»æ˜¯æŠŠä¸€ä¸ªé¡¹ç›®çš„ä»£ç copyåˆ°å¦ä¸€ä¸ªé¡¹ç›®ä¸­ã€‚æ¯”æ–¹è¯´ï¼Œä½ copyäº†ä½ ä¹‹å‰é¡¹ç›®çš„ä¸€äº›utilæ–¹æ³•åˆ°å½“å‰çš„é¡¹ç›®ä¸­ã€‚</p>
<p>è¿™æ˜¯å¾ˆæµªè´¹æ—¶é—´çš„ã€‚ä½†æ˜¯æ…¢ç€ï¼Œå¦‚æœä½¿ç”¨ module ï¼Œä¸€ä¸ªæˆ‘ä»¬å¯ä»¥ä¸æ–­å¤ç”¨çš„ module ï¼Œè¿™ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿ</p>
<h2 id="ä½ æ˜¯å¦‚ä½•åˆå¹¶æ¨¡å—-incorporate-modules"><a class="header-anchor" href="#ä½ æ˜¯å¦‚ä½•åˆå¹¶æ¨¡å—-incorporate-modules">#</a>ä½ æ˜¯å¦‚ä½•åˆå¹¶æ¨¡å—(incorporate modules)?</h2>
<p>æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥åœ¨ä½ çš„ç¨‹åºä¸­åˆå¹¶æ¨¡å—ã€‚æˆ‘ä»¬ç°åœ¨å°±æ¥è®²è§£ä»–ä»¬çš„å…¶ä¸­ä¸€äº›ï¼š</p>
<h3 id="module-pattern"><a class="header-anchor" href="#module-pattern">#</a>Module Pattern</h3>
<p><em>Module pattern</em> å…¶å®å°±æ˜¯æ¨¡ä»¿ <em>class</em> çš„æ¦‚å¿µ(å› ä¸º JavaScript å¹¶ä¸çœŸæ­£åœ°æ”¯æŒ class )ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠå…¬æœ‰æ–¹æ³•ï¼Œç§æœ‰æ–¹æ³•ä»¥åŠå˜é‡éƒ½ä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œé¢â€”â€”è¿™ä¸ªå°±æœ‰ç‚¹ç±»ä¼¼äº class åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€(å¦‚ Java æˆ–è€… Python )ä¸­çš„ä½¿ç”¨ã€‚è¿™å¯ä»¥è®©æˆ‘ä»¬ç»™å…¬æœ‰æ–¹æ³•åˆ›å»º API ï¼Œç„¶åæš´éœ²å‡ºå»ï¼›å¹¶ä¸”åŒæ—¶å¯ä»¥æŠŠç§æœ‰çš„å˜é‡å’Œæ–¹æ³•éƒ½å°è£…åœ¨ä¸€ä¸ªé—­åŒ…ä½œç”¨åŸŸ(closure scope)ä¸­ã€‚</p>
<p>æœ‰å‡ ä¸ªæ–¹æ³•å¯ä»¥å®ç° module patternã€‚åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ã€‚æˆ‘ä¼šä½¿ç”¨ <em>anonymous closure</em>ã€‚ä»–ä¼šæŠŠæˆ‘ä»¬æ‰€æœ‰çš„ä»£ç éƒ½æ”¾è¿›ä¸€ä¸ªåŒ¿åå‡½æ•°é‡Œé¢ã€‚(è®°ä½ï¼šåœ¨ JavaScript ä¸­ï¼Œ<code>function</code> æ˜¯åˆ›å»ºä½œç”¨åŸŸçš„å”¯ä¸€æ–¹æ³•ï¼Ÿ)</p>
<p><strong>ä¾‹å­ä¸€ï¼šAnonymous closure</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// We keep these variables private inside this closure scope</span></div><div class="line"></div><div class="line">  <span class="keyword">var</span> myGrades = [<span class="number">93</span>, <span class="number">95</span>, <span class="number">88</span>, <span class="number">0</span>, <span class="number">55</span>, <span class="number">91</span>];</div><div class="line"></div><div class="line">  <span class="keyword">var</span> average = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> total = myGrades.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">accumulator, item</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> accumulator + item&#125;, <span class="number">0</span>);</div><div class="line"></div><div class="line">      <span class="keyword">return</span> <span class="string">'Your average grade is '</span> + total / myGrades.length + <span class="string">'.'</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> failing = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> failingGrades = myGrades.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> item &lt; <span class="number">70</span>;&#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="string">'You failed '</span> + failingGrades.length + <span class="string">' times.'</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(failing());</div><div class="line"></div><div class="line">&#125;());</div><div class="line"></div><div class="line"><span class="comment">// â€˜You failed 2 times.â€™</span></div></pre></td></tr></table></figure>
<p>æœ‰äº†è¿™ä¸ªï¼Œæˆ‘ä»¬çš„åŒ¿åå‡½æ•°å°±æœ‰äº†å®ƒè‡ªå·±çš„æ±‚å€¼ç¯å¢ƒ(evaluation environment)æˆ–è€…&quot;closure&quot;ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ç«‹é©¬å¯¹ä»–æ±‚å€¼(evaluate)ã€‚è¿™å¯ä»¥è®©æˆ‘ä»¬ä» parent namespace(global) ä¸­éšè—å˜é‡ã€‚</p>
<p>è¿™ç§æ–¹æ³•çš„å¥½å¤„å°±æ˜¯ï¼Œä½ å¯ä»¥åœ¨åŒ¿åå‡½æ•°ä¸­ä½¿ç”¨å±€éƒ¨å˜é‡è€Œä¸ä¼š overwrite(è¦†ç›–) å·²ç»å­˜åœ¨çš„å…¨å±€å˜é‡ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œä½ è¿˜å¯ä»¥ access å…¨å±€å˜é‡ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> global = <span class="string">'Hello, I am a global variable :)'</span>;</div><div class="line"></div><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// We keep these variables private inside this closure scope</span></div><div class="line"></div><div class="line">  <span class="keyword">var</span> myGrades = [<span class="number">93</span>, <span class="number">95</span>, <span class="number">88</span>, <span class="number">0</span>, <span class="number">55</span>, <span class="number">91</span>];</div><div class="line"></div><div class="line">  <span class="keyword">var</span> average = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> total = myGrades.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">accumulator, item</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> accumulator + item&#125;, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="string">'Your average grade is '</span> + total / myGrades.length + <span class="string">'.'</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> failing = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> failingGrades = myGrades.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> item &lt; <span class="number">70</span>;&#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="string">'You failed '</span> + failingGrades.length + <span class="string">' times.'</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(failing());</div><div class="line">  <span class="built_in">console</span>.log(global);</div><div class="line">&#125;());</div><div class="line"></div><div class="line"><span class="comment">// 'You failed 2 times.'</span></div><div class="line"><span class="comment">// 'Hello, I am a global variable :)'</span></div></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°åœ¨åŒ¿åå‡½æ•°2æ—çš„æ‹¬å·æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºä»¥å…³é”®å­—<code>function</code>å¼€å¤´çš„è¯­å¥ä¼šè¢«è®¤ä¸ºæ˜¯ <em>function declaration</em> (è®°ä½ï¼Œåœ¨ JavaScript ä¸­ï¼Œä½ æ˜¯ä¸èƒ½å®šä¹‰æ²¡æœ‰åå­—çš„function declarationã€‚) å› æ­¤ï¼Œè¿™å¯¹æ‹¬å·å°±åˆ›å»ºä¸€ä¸ª <em>function expression</em>ã€‚å¦‚æœä¸æ˜ç™½çš„è¯ï¼Œä½ å¯ä»¥<a href="http://stackoverflow.com/questions/1634268/explain-javascripts-encapsulated-anonymous-function-syntax" target="_blank" rel="external">é˜…è¯»è¿™é‡Œ</a>ã€‚</p>
<p><strong>ä¾‹å­äºŒï¼šGlobal import</strong></p>
<p>å¦ä¸€ä¸ªè¾ƒæµè¡Œçš„æ–¹æ³•æ˜¯ <em>global import</em> ï¼Œå°±åƒ jQuery ä¸€æ ·ã€‚ä»–æœ‰ç‚¹ç±»ä¼¼äºä¸Šé¢çš„ã€€<em>anonymous closure</em>ï¼Œåªæ˜¯ç°åœ¨æˆ‘ä»¬æŠŠå…¨å±€å˜é‡ä½œä¸ºå‚æ•°ä¼ è¿›äº†åŒ¿åå‡½æ•°ä¸­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">globalVariable</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// Keep this variables private inside this closure scope</span></div><div class="line">  <span class="keyword">var</span> privateFunction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Shhhh, this is private!'</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// Expose the below methods via the globalVariable interface while</span></div><div class="line">  <span class="comment">// hiding the implementation of the method within the</span></div><div class="line">  <span class="comment">// function() block</span></div><div class="line"></div><div class="line">  globalVariable.each = <span class="function"><span class="keyword">function</span>(<span class="params">collection, iterator</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(collection)) &#123;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; collection.length; i++) &#123;</div><div class="line">        iterator(collection[i], i, collection);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> collection) &#123;</div><div class="line">        iterator(collection[key], key, collection);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  globalVariable.filter = <span class="function"><span class="keyword">function</span>(<span class="params">collection, test</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> filtered = [];</div><div class="line">    globalVariable.each(collection, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (test(item)) &#123;</div><div class="line">        filtered.push(item);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> filtered;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  globalVariable.map = <span class="function"><span class="keyword">function</span>(<span class="params">collection, iterator</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> mapped = [];</div><div class="line">    globalUtils.each(collection, <span class="function"><span class="keyword">function</span>(<span class="params">value, key, collection</span>) </span>&#123;</div><div class="line">      mapped.push(iterator(value));</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> mapped;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  globalVariable.reduce = <span class="function"><span class="keyword">function</span>(<span class="params">collection, iterator, accumulator</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> startingValueMissing = accumulator === <span class="literal">undefined</span>;</div><div class="line"></div><div class="line">    globalVariable.each(collection, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span>(startingValueMissing) &#123;</div><div class="line">        accumulator = item;</div><div class="line">        startingValueMissing = <span class="literal">false</span>;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        accumulator = iterator(accumulator, item);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> accumulator;</div><div class="line"></div><div class="line">  &#125;;</div><div class="line"></div><div class="line"> &#125;(globalVariable));</div></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>globalVariable</code> åœ¨å…¨å±€ä¸­å”¯ä¸€çš„ä¸€ä¸ªå˜é‡ã€‚è¿™ä¸ªæ–¹æ³•æ¯”å‰ä¸€ä¸ªæ–¹æ³•å¥½çš„åœ°æ–¹åœ¨äºï¼šä½ å¯ä»¥åœ¨å‰é¢å°±å®šä¹‰å…¨å±€å˜é‡ï¼Œè¿™æ ·å°±æ–¹ä¾¿åˆ«äººé˜…è¯»ä½ çš„ä»£ç ã€‚</p>
<p><strong>ä¾‹å­ä¸‰ï¼šObject interface</strong></p>
<p>åˆ›å»º module çš„ä¾‹å­è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ä½¿ç”¨ç‹¬ç«‹çš„ <em>object interface</em>ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myGradesCalculate = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// Keep this variable private inside this closure scope</span></div><div class="line">  <span class="keyword">var</span> myGrades = [<span class="number">93</span>, <span class="number">95</span>, <span class="number">88</span>, <span class="number">0</span>, <span class="number">55</span>, <span class="number">91</span>];</div><div class="line"></div><div class="line">  <span class="comment">// Expose these functions via an interface while hiding</span></div><div class="line">  <span class="comment">// the implementation of the module within the function() block</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    average: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> total = myGrades.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">accumulator, item</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> accumulator + item;</div><div class="line">        &#125;, <span class="number">0</span>);</div><div class="line"></div><div class="line">      <span class="keyword">return</span><span class="string">'Your average grade is '</span> + total / myGrades.length + <span class="string">'.'</span>;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    failing: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> failingGrades = myGrades.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> item &lt; <span class="number">70</span>;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">      <span class="keyword">return</span> <span class="string">'You failed '</span> + failingGrades.length + <span class="string">' times.'</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)();</div><div class="line"></div><div class="line">myGradesCalculate.failing(); <span class="comment">// 'You failed 2 times.'</span></div><div class="line">myGradesCalculate.average(); <span class="comment">// 'Your average grade is 70.33333333333333.'</span></div></pre></td></tr></table></figure>
<p>æ˜¾è€Œæ˜“è§ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬è‡ªå·±å®šä¹‰å“ªäº›å˜é‡/æ–¹æ³•æ˜¯ç§æœ‰çš„(ä¾‹å¦‚ï¼Œ<code>myGrads</code>)ï¼Œä»¥åŠå“ªäº›å˜é‡/æ–¹æ³•æ˜¯æˆ‘ä»¬æƒ³è¦æš´éœ²ç»™ä»–ä»¬çš„ï¼Œé€šè¿‡ <code>return</code> è¯­å¥(æ¯”å¦‚ï¼Œ<code>average</code> &amp; <code>failing</code>)ã€‚</p>
<p><strong>ä¾‹å­å››ï¼šRevealing module pattern</strong></p>
<p>è¿™ä¸ªè·Ÿä¸Šé¢çš„æ–¹æ³•æ˜¯å¾ˆç›¸ä¼¼çš„ï¼Œé™¤äº†ä»–ä¿è¯æ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•éƒ½æ˜¯ç§æœ‰çš„ï¼Œç›´åˆ°æˆ‘ä»¬æ˜¾å¼åœ°æš´éœ²å‡ºå»ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myGradesCalculate = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// Keep this variable private inside this closure scope</span></div><div class="line">  <span class="keyword">var</span> myGrades = [<span class="number">93</span>, <span class="number">95</span>, <span class="number">88</span>, <span class="number">0</span>, <span class="number">55</span>, <span class="number">91</span>];</div><div class="line"></div><div class="line">  <span class="keyword">var</span> average = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> total = myGrades.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">accumulator, item</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> accumulator + item;</div><div class="line">      &#125;, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span><span class="string">'Your average grade is '</span> + total / myGrades.length + <span class="string">'.'</span>;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> failing = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> failingGrades = myGrades.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> item &lt; <span class="number">70</span>;</div><div class="line">      &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="string">'You failed '</span> + failingGrades.length + <span class="string">' times.'</span>;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="comment">// Explicitly reveal public pointers to the private functions</span></div><div class="line">  <span class="comment">// that we want to reveal publicly</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    average: average,</div><div class="line">    failing: failing</div><div class="line">  &#125;</div><div class="line">&#125;)();</div><div class="line"></div><div class="line">myGradesCalculate.failing(); <span class="comment">// 'You failed 2 times.'</span></div><div class="line">myGradesCalculate.average(); <span class="comment">// 'Your average grade is 70.33333333333333.'</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢å¥½åƒè®²äº†å¥½å¤šä¸œè¥¿ï¼Œå…¶å®å¯¹äº module pattern æ¥è¯´ï¼Œåªæ˜¯å†°å±±ä¸€è§’ã€‚ä¸‹é¢æ˜¯ä¸€äº›æˆ‘è®¤ä¸ºæ¯”è¾ƒæœ‰ç”¨çš„èµ„æºï¼š</p>
<ul>
<li><a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/#modulepatternjavascript" target="_blank" rel="external">Learn JavaScript Design Patterns</a> - by <em>Addy Osmani</em></li>
<li><a href="http://www.adequatelygood.com/JavaScript-Module-Pattern-In-Depth.html" target="_blank" rel="external">Adequately Good by Ben Cherry</a> - é€šè¿‡ä¾‹å­è®²è¿°module patternçš„é«˜çº§ä½¿ç”¨</li>
<li><a href="https://carldanley.com/js-module-pattern/" target="_blank" rel="external">Blog of Carl Danley</a> - module patternçš„æ¦‚è¿°ä»¥åŠå…¶ä»– JavaScript pattern çš„èµ„æº</li>
</ul>
<h2 id="commonjs-and-amd"><a class="header-anchor" href="#commonjs-and-amd">#</a>CommonJS and AMD</h2>
<p>ä¸Šé¢è®²åˆ°çš„æ‰€æœ‰æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼šä½¿ç”¨å…¨å±€å˜é‡å°†å…¶æ‰€æœ‰ä»£ç éƒ½å°è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œä»è€Œä½¿ç”¨ <em>closure scope</em> ä¸ºä»–è‡ªå·±åˆ›å»ºå‡ºäº†ä¸€ä¸ªç§æœ‰çš„å‘½åç©ºé—´ã€‚</p>
<p>ä»–ä»¬å„è‡ªæœ‰å„è‡ªçš„ä¼˜ç‚¹ï¼Œä½†æ˜¯ä»–ä»¬ä¹Ÿæœ‰ä»–ä»¬çš„å¼Šç«¯ã€‚</p>
<p>å…¶ä¸­ä¸€ä¸ªï¼Œä½œä¸ºä¸€åå¼€å‘è€…ï¼Œä¸ºäº†åŠ è½½ä½ çš„æ–‡ä»¶ï¼Œä½ éœ€è¦çŸ¥é“æ­£ç¡®çš„ä¾èµ–é¡ºåºã€‚æ¯”å¦‚ï¼Œä½ è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ <code>Backbone</code>ï¼Œé‚£ä¹ˆä½ éœ€è¦é€šè¿‡ <code>script</code> æ ‡ç­¾æ¥åŠ è½½ä»–çš„æºæ–‡ä»¶ã€‚</p>
<p>ä½†æ˜¯ï¼Œå› ä¸º <code>Backbone</code> æ˜¯ä¾èµ– <code>Underscore.js</code>ï¼Œé‚£ä¹ˆåŠ è½½ <code>Backbone</code> çš„ <code>script</code> æ ‡ç­¾å°±ä¸èƒ½åœ¨ <code>Underscore</code> çš„å‰é¢ã€‚</p>
<p>ä½œä¸ºä¸€åå¼€å‘è€…ï¼Œç»´æŠ¤ä¾èµ–ä»¥åŠè®©ä»–ä»¬çš„é¡ºåºéƒ½æ­£ç¡®çš„è¯ï¼Œæœ‰æ—¶æ˜¯ä¸€ä»¶å¾ˆå¤´ç–¼çš„äº‹æƒ…ã€‚</p>
<p>å¦ä¸€ä¸ªå¼Šç«¯å°±æ˜¯ä»–ä»¬ä»ç„¶ä¼šäº§ç”Ÿå‘½åç©ºé—´å†²çªã€‚æ¯”å¦‚ï¼Œä½ çš„ä¸¤ä¸ª module å…·æœ‰ç›¸åŒçš„åå­—ã€‚åˆæˆ–è€…ï¼Œä½ çš„ä¸€ä¸ªæ¨¡å—æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸”ä½ åŒæ—¶éœ€è¦ä»–ä»¬ã€‚</p>
<p>å› æ­¤ï¼Œä½ ä¹Ÿä¼šè¿™æ ·æƒ³åˆ°ï¼šèƒ½ä¸èƒ½è®¾è®¡ä¸€ç§æ–¹æ³•ï¼Œæ—¢å¯ä»¥è®¿é—® module çš„æ¥å£ï¼Œä½†åŒæ—¶åˆä¸æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚</p>
<p>å…¶å®æœ‰ä¸¤ç§å·²ç»å®ç°å¥½çš„æ–¹æ³•ï¼šå³æ˜¯ CommonJS å’Œ AMD ã€‚</p>
<h3 id="commonjs"><a class="header-anchor" href="#commonjs">#</a>CommonJS</h3>
<p>CommonJSæ˜¯ä¸€ä¸ªè‡ªæ„¿çš„å·¥ä½œå°ç»„ï¼Œè®¾è®¡å’Œå®ç° JavaScript æ¨¡å—ç³»ç»Ÿçš„ APIã€‚</p>
<p>ä¸€ä¸ª CommonJS æ¨¡å—å…¶å®å°±æ˜¯ <code>exports</code> äº†å…·ä½“å¯¹è±¡çš„ JavaScript ä»£ç å—ï¼Œä½¿å¾—ä»–ä»¬èƒ½å¤Ÿè¢«ç¨‹åºä¸­çš„å…¶ä»–æ¨¡å— <code>require</code> ã€‚å¦‚æœä½ å†™è¿‡ <code>Node.js</code> çš„è¯ï¼Œä½ åº”è¯¥å¯¹ä»–å¾ˆç†Ÿæ‚‰ã€‚</p>
<p>æœ‰äº† CommonJSï¼Œæ¯ä¸ª JavaScript æ–‡ä»¶åœ¨ä»–ä»¬å„è‡ªå”¯ä¸€çš„ module context (å°±åƒå°è£…åœ¨ä¸€ä¸ªé—­åŒ…ä¸­)ä¿å­˜äº†æ¨¡å—ã€‚åœ¨è¿™ä¸ªä½œç”¨åŸŸé‡Œé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>module.exports</code> å¯¹è±¡æ¥æš´éœ²æ¨¡å—ï¼Œä½¿ç”¨<code>require</code>æ¥åŠ è½½ä»–ä»¬ã€‚</p>
<p>å½“ä½ å®šä¹‰äº†ä¸€ä¸ª CommonJS æ–‡ä»¶ï¼Œä¹Ÿè®¸ä»–å°±é•¿è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myModule</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.hello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'hello!'</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>.goodbye = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'goodbye!'</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = myModule;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä½¿ç”¨ç‰¹æ®Šçš„å¯¹è±¡<code>module</code>ï¼Œç„¶åæŠŠæˆ‘ä»¬å‡½æ•°çš„å¼•ç”¨èµ‹ç»™<code>module.exports</code>ã€‚è¿™ä¸ªè®©CommonJSçš„æ¨¡å—ç³»ç»ŸçŸ¥é“æˆ‘ä»¬æƒ³è¦æš´éœ²å“ªäº›ï¼Œä»è€Œè®©åˆ«çš„æ–‡ä»¶å¼•ç”¨ã€‚</p>
<p>ç„¶åï¼Œå¦‚æœåˆ«äººæƒ³ä½¿ç”¨æˆ‘çš„<code>myModule</code>ï¼Œä»–ä»¬å¯ä»¥å¼•ç”¨å®ƒåˆ°æ–‡ä»¶ä¸­ï¼Œåƒè¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myModule = <span class="built_in">require</span>(<span class="string">'myModule'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> myModuleInstance = <span class="keyword">new</span> myModule();</div><div class="line">myModuleInstance.hello(); <span class="comment">// 'hello!'</span></div><div class="line">myModuleInstance.goodbye(); <span class="comment">// 'goodbye!'</span></div></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•æ¯”å‰é¢æ‰€è®²çš„ <em>module pattern</em> æœ‰2ä¸ªæ˜æ˜¾çš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>é¿å…å…¨å±€å‘½åç©ºé—´çš„æ±¡æŸ“</li>
<li>è®©æˆ‘ä»¬çš„ä¾èµ–æ›´åŠ æ¸…æ™°</li>
</ol>
<p>è€Œä¸”ï¼Œè¯­æ³•å¾ˆç®€æ´ï¼Œæˆ‘å¾ˆå–œæ¬¢ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªæ³¨æ„çš„æ˜¯ï¼ŒCommonJSæ˜¯é’ˆå¯¹serverå®ç°çš„ï¼Œå¹¶ä¸”<strong>åŒæ­¥åŠ è½½modules</strong>ã€‚è¿™æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬æœ‰3ä¸ªmoduleéœ€è¦å¼•å…¥ï¼Œé‚£ä¹ˆä»–ä¼šä¸€ä¸ªæ¥ç€ä¸€ä¸ªåŠ è½½ã€‚</p>
<p>ç°åœ¨ï¼ŒCommonJSå¯¹äºserverç«¯å¾ˆæå¥½çš„ã€‚ä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œä»–ä¸é€‚ç”¨äºæµè§ˆå™¨ã€‚å› ä¸ºåœ¨webè¯»å–ä¸€ä¸ªmoduleæ¯”åœ¨ç£ç›˜ä¸­è¯»å–æ…¢å¾—å¤šã€‚å¦‚æœå¼€å§‹åŠ è½½moduleï¼Œå°±ä¼šé˜»å¡æµè§ˆå™¨ç›´åˆ°moduleså…¨éƒ¨åŠ è½½å®Œæ¯•ã€‚(æˆ‘ä¼šåœ¨ Part 2 è®²è¿°è§£å†³æ–¹æ³•)ã€‚</p>
<h3 id="amd"><a class="header-anchor" href="#amd">#</a>AMD</h3>
<p>CommonJSæ˜¯å¾ˆå¥½ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦å¼‚æ­¥åŠ è½½moduleså‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯<em>Asynchronous Module Definition</em>ï¼Œå³<em>AMD</em>ã€‚</p>
<p>ä½¿ç”¨AMDåŠ è½½moduleå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define([<span class="string">'myModule'</span>, <span class="string">'myOtherModule'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">myModule, myOtherModule</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(myModule.hello());</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>define</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä»–åŒ…å«äº†æ‰€éœ€çš„ä¾èµ–ã€‚è¿™äº›ä¾èµ–ä¼šåœ¨èƒŒååŠ è½½(ä¸ä¼šé˜»å¡)ï¼Œè€Œä¸”ä¸€æ—¦åŠ è½½å®Œæ¯•ï¼Œ<code>define</code>å°±ä¼šè°ƒç”¨ä¼ ç»™ä»–çš„callbackå‡½æ•°ã€‚</p>
<p>æ¥ç€ï¼Œcallbackå‡½æ•°å°±ä¼šæŠŠåŠ è½½å¥½çš„ä¾èµ–ä½œä¸ºä»–çš„å‚æ•°â€”â€”åœ¨ä¸Šé¢ä¾‹å­ä¸­ï¼Œå³æ˜¯<code>myModule</code>å’Œ<code>myOtherModule</code>ã€‚æœ€åï¼Œè¿™äº›ä¾èµ–ä»–ä»¬è‡ªå·±å¿…é¡»é€šè¿‡å…³é”®å­—<code>define</code>æ¥å®šä¹‰ã€‚</p>
<p>æ¯”å¦‚ï¼Œ<code>myModule</code>ä¹Ÿè®¸æ˜¯è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">define([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    hello: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'hello'</span>);</div><div class="line">    &#125;,</div><div class="line">    goodbye: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'goodbye'</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>ä¸åƒCommonJSï¼ŒAMDæ˜¯ä»¥æµè§ˆå™¨ä¸ºæ ¸å¿ƒæ¥å®ç°å¼‚æ­¥åŠ è½½moduleçš„ã€‚(æ³¨æ„åˆ°ï¼Œæœ‰å¾ˆå¤šäººå¼ºçƒˆåœ°è®¤ä¸ºåŠ¨æ€åŠ è½½æ–‡ä»¶æ˜¯ä¸å¥½çš„ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨Part 2ä¼šè®²åˆ°)ã€‚</p>
<p>é™¤äº†å¼‚æ­¥ä¹‹å¤–ï¼ŒAMDçš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œä½ çš„moduleå¯ä»¥æ˜¯å¯¹è±¡ï¼Œå‡½æ•°ï¼Œæ„é€ å‡½æ•°ï¼Œå­—ç¬¦ä¸²ï¼ŒJSONä»¥åŠå…¶ä»–ç±»å‹ã€‚è€ŒCommonJSåªæ”¯æŒå¯¹è±¡ä½œä¸ºmoduleã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒAMDå¹¶ä¸å…¼å®¹ioï¼Œæ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠå…¶ä»–é¢å‘serverçš„featureï¼Œå¹¶ä¸”ï¼Œå°è£…çš„è¯­æ³•æ¯”<code>require</code>è¾ƒå¤æ‚ä¸€ç‚¹ã€‚</p>
<h3 id="umd"><a class="header-anchor" href="#umd">#</a>UMD</h3>
<p>å¯¹äºéœ€è¦ä½ åŒæ—¶æ”¯æŒAMDå’ŒCommonJSçš„é¡¹ç›®ï¼Œä½ å¯ä»¥é€‰æ‹©<em>Universal Module Definition (UMD)</em>ã€‚</p>
<p>UMDæœ¬è´¨ä¸Šåˆ›å»ºäº†ä¸€ä¸ªæ–¹å¼ï¼Œæ”¯æŒä»–ä»¬å…¶ä¸­çš„ä¸€ç§ï¼Œä¹Ÿæ”¯æŒå…¨å±€å˜é‡çš„å®šä¹‰ã€‚å› æ­¤ï¼ŒUMD moduleå¯ä»¥åŒæ—¶åœ¨clientå’Œserverç«¯ä½¿ç”¨ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹UMDæ˜¯æ€æ ·å­çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd) &#123;</div><div class="line">      <span class="comment">// AMD</span></div><div class="line">    define([<span class="string">'myModule'</span>, <span class="string">'myOtherModule'</span>], factory);</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">'object'</span>) &#123;</div><div class="line">      <span class="comment">// CommonJS</span></div><div class="line">    <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">'myModule'</span>), <span class="built_in">require</span>(<span class="string">'myOtherModule'</span>));</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// Browser globals (Note: root is window)</span></div><div class="line">    root.returnExports = factory(root.myModule, root.myOtherModule);</div><div class="line">  &#125;</div><div class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">myModule, myOtherModule</span>) </span>&#123;</div><div class="line">  <span class="comment">// Methods</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">notHelloOrGoodbye</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// A private method</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// A public method because it's returned (see below)</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">goodbye</span>(<span class="params"></span>)</span>&#123;&#125;; <span class="comment">// A public method because it's returned (see below)</span></div><div class="line"></div><div class="line">  <span class="comment">// Exposed public methods</span></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">      hello: hello,</div><div class="line">      goodbye: goodbye</div><div class="line">  &#125;</div><div class="line">&#125;));</div></pre></td></tr></table></figure>
<p>æ›´å¤šå…³äºUMDçš„ä¾‹å­ï¼Œè¯·æŸ¥çœ‹Â <a href="https://github.com/umdjs/umd" target="_blank" rel="external">enlightening repo</a>ã€‚</p>
<h2 id="native-js"><a class="header-anchor" href="#native-js">#</a>Native JS</h2>
<p>å“ˆï¼ä½ å±…ç„¶èƒ½çœ‹åˆ°è¿™é‡Œï¼Œçœ‹æ¥æˆ‘æ²¡æœ‰ææ™•ä½ ã€‚å¤ªæ£’äº†ã€‚å› ä¸ºåœ¨ç»“æŸä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå®šä¹‰moduleçš„æ–¹æ³•ã€‚</p>
<p>å¦‚ä½ æ‰€è§ï¼Œä¸Šé¢çš„æ–¹æ³•æ²¡æœ‰ä¸€ç§æ˜¯åŸç”ŸJavaScriptæ”¯æŒçš„ã€‚ç›¸åï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å„ç§å„æ ·çš„æ–¹å¼å»æ¨¡æ‹Ÿä¸€ä¸ªæ¨¡å—ç³»ç»Ÿã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œåœ¨TC39å·¥ä½œçš„äºº(è®¾è®¡ECMAScriptçš„è¯­æ³•å’Œè¯­ä¹‰)åœ¨ES6å®ç°äº†å†…ç½®çš„æ¨¡å—ç³»ç»Ÿã€‚</p>
<p>ä¸‹é¢çš„èµ„æºå¾ˆå¥½åœ°è®²è§£äº†ES6çš„æ¨¡å—ç³»ç»Ÿï¼š</p>
<ul>
<li><a href="http://jsmodules.io/cjs.html" target="_blank" rel="external">jsmodules.io</a></li>
<li><a href="http://exploringjs.com/es6/ch_modules.html" target="_blank" rel="external">exploringjs.com</a></li>
</ul>
<p>ES6çš„moduleç»“åˆäº†CommonJSå’ŒAMDçš„ä¼˜ç‚¹ï¼Œæ¯”å¦‚ç®€æ´çš„è¯­æ³•å’Œå¼‚æ­¥åŠ è½½ã€‚è¿˜æœ‰ä¼˜ç‚¹æ˜¯ï¼Œæ¯”å¦‚æ”¯æŒå¾ªç¯ä¾èµ–ã€‚</p>
<p>æˆ‘æœ€å–œæ¬¢çš„ES6 modulesçš„featureæ˜¯ï¼Œ<em>imports</em>æ˜¯<em>exports</em>çš„<strong>live read-only views</strong>(è€ŒCommonJSçš„importåªæ˜¯exportsçš„ä¸€ä»½copyè€Œå·²ï¼Œå¹¶ä¸”ä¸æ˜¯å³æ—¶)ã€‚</p>
<p>ä¸‹é¢ä¾‹å­ä¼šè®²è¿°live read-only viewæ˜¯æ€æ ·å­çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// lib/counter.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> counter = <span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  counter++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrement</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  counter--;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  counter: counter,</div><div class="line">  increment: increment,</div><div class="line">  decrement: decrement</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// src/main.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> counter = <span class="built_in">require</span>(<span class="string">'../../lib/counter'</span>);</div><div class="line"></div><div class="line">counter.increment();</div><div class="line"><span class="built_in">console</span>.log(counter.counter); <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†moduleçš„<strong>2ä»½copy</strong>ï¼šä¸€ä¸ªæ˜¯å½“æˆ‘ä»¬<code>export</code>ä»–ï¼Œå¦ä¸€ä¸ªæ˜¯å½“æˆ‘ä»¬<code>require</code>ä»–ã€‚</p>
<p>å¹¶ä¸”ï¼Œåœ¨<code>main.js</code>çš„é‚£ä»½copyå·²ç»å’ŒåŸæœ¬çš„å¤±å»è¿æ¥äº†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬ç»™<code>counter</code>å¢åŠ æ—¶ä»–è¿˜æ˜¯<code>1</code>â€”â€”å› ä¸ºæˆ‘ä»¬<code>import</code>çš„<code>counter</code>å·²ç»å’ŒåŸæ¥çš„å¤±å»è”ç³»ã€‚</p>
<p>å› ä¸ºï¼Œå¢åŠ <code>counter</code>ä¼šåœ¨åŸæ¥çš„moduleå¯ä»¥å®ç°ï¼Œä½†æ˜¯åœ¨ä½ copyçš„é‚£ä»½å°±å®ç°ä¸äº†ã€‚å¦‚æœæƒ³è¦åè€…å®ç°çš„è¯ï¼Œåªèƒ½æ‰‹åŠ¨åœ°æ“ä½œäº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">counter.counter++;</div><div class="line"><span class="built_in">console</span>.log(counter.counter); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p>åœ¨å¦ä¸€ä¸ªæ–¹é¢ï¼ŒES6å¯¹äºæˆ‘ä»¬<code>import</code>çš„moduleåˆ›å»ºäº†ä¸€ä¸ª<strong>live read-only view</strong>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// lib/counter.js</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">let</span> counter = <span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  counter++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">decrement</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  counter--;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// src/main.js</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> counter <span class="keyword">from</span> <span class="string">'../../counter'</span>;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(counter.counter); <span class="comment">// 1</span></div><div class="line">counter.increment();</div><div class="line"><span class="built_in">console</span>.log(counter.counter); <span class="comment">// 2</span></div></pre></td></tr></table></figure>
<p>å¾ˆcoolï¼Œå¯¹å§ã€‚</p>
<h2 id="å‘å‰çœ‹ï¼šbunding-modules"><a class="header-anchor" href="#å‘å‰çœ‹ï¼šbunding-modules">#</a>å‘å‰çœ‹ï¼šbunding modules</h2>
<p>å“‡ã€‚æ—¶é—´è¿‡å¾—çœŸå¿«ã€‚æˆ‘çœŸçš„å¸Œæœ›èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£JavaScriptçš„modulesã€‚</p>
<p>åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä¼šè®²<strong>module bundling</strong>ï¼Œæ¶‰åŠåˆ°å‡ ä¸ªæ ¸å¿ƒçš„ä¸»é¢˜ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦<em>module bundling</em></li>
<li>ä¸åŒæ–¹æ³•å®ç°<em>bundling</em></li>
<li>ECMAScriptçš„æ¨¡å—åŠ è½½å™¨API</li>
<li>â€¦æ›´å¤šâ€¦</li>
</ul>
<p>æ³¨æ„ï¼šä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘è·³è¿‡äº†è®¸å¤šç»†èŠ‚(æ¯”å¦‚ï¼Œå¾ªç¯ä¾èµ–)ã€‚å¦‚æœæˆ‘ç•™ä¸‹äº†å¾ˆé‡è¦æˆ–è€…å¾ˆæ£’çš„ä¸œè¥¿ï¼Œè¯·ç•™è¨€è®©æˆ‘çŸ¥é“ï¼</p>
<p><strong>(åŸæ–‡ï¼š<a href="https://medium.freecodecamp.com/javascript-modules-a-beginner-s-guide-783f7d7a5fcc#.4ufizwkud" target="_blank" rel="external">JavaScript Modules: A Beginnerâ€™s Guide - Preethi Kasireddy</a>)</strong></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;(åŸæ–‡ï¼š&lt;a href=&quot;https://medium.freecodecamp.com/javascript-modules-a-beginner-s-guide-783f7d7a5fcc#.4ufizwkud&quot; target=&quot;_blank&quot; rel=&quot;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="http://drakeleung.github.io/blog/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
  </entry>
  
  <entry>
    <title>è¿·ä¹‹å‰ç«¯è½®å­ - å®ç° ES2015 Promise</title>
    <link href="http://drakeleung.github.io/blog/2016/02/06/Promise/"/>
    <id>http://drakeleung.github.io/blog/2016/02/06/Promise/</id>
    <published>2016-02-06T09:59:59.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>(æ‰€æœ‰ä»£ç è¯·æŸ¥çœ‹<a href="https://github.com/DrakeLeung/tiny-promise" target="_blank" rel="external">GitHub tiny-promise</a>)</p>
<h2 id="why"><a class="header-anchor" href="#why">#</a>Why</h2>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä¸€ç›´ä¸æ˜ç™½ <em>promise</em> çš„workflowæ˜¯æ€æ ·å­çš„ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸€ç›´å¾ˆè¿·æƒ‘ã€‚æ¯”å¦‚ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) =&gt; &#123;</div><div class="line">  setTimeout(() =&gt; resolve(<span class="string">'success'</span>), <span class="number">1000</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">p1.then(msg =&gt; <span class="built_in">console</span>.log(msg))</div></pre></td></tr></table></figure>
<p>å¯¹äºä¸Šé¢çš„ä»£ç ï¼Œä¹‹å‰çš„æˆ‘åªçŸ¥é“<code>resolve</code>çš„å‚æ•°<code>success</code>ä¼šä¼ ç»™<code>then</code>çš„<code>msg</code>ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè€Œä¸”ï¼Œæˆ‘æ›´æ²¡æƒ³è¿‡åˆ°åº•æ˜¯<code>then</code>å…ˆæ‰§è¡Œå‘¢è¿˜æ˜¯<code>resolve</code>å…ˆæ‰§è¡Œï¼Ÿè¿™æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</p>
<h2 id="how"><a class="header-anchor" href="#how">#</a>How</h2>
<p>é‚£ä¹ˆï¼Œå°±è®©æˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°ä¸€ä¸ªpromiseå§ã€‚</p>
<h3 id="promise-constructor"><a class="header-anchor" href="#promise-constructor">#</a>Promise Constructor</h3>
<p>æ ¹æ®<a href="http://devdocs.io/javascript/global_objects/promise" target="_blank" rel="external">docs</a>ï¼Œ<code>Promise</code>è¿™ä¸ªæ„é€ å‡½æ•°åªæ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¸”è¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>function</code>ã€‚ä»–æœ‰2ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯<code>resolve</code>å’Œ<code>reject</code>ã€‚<br>
æˆ‘ä»¬è¦åœ¨æ„é€ å‡½æ•°é‡Œé¢æ‰§è¡Œ<code>executor</code>å‡½æ•°ï¼Œå¹¶ä¸”ä¼ 2ä¸ªå‚æ•°ç»™ä»–ã€‚</p>
<p>å¹¶ä¸”ï¼Œæˆ‘ä»¬æ„é€ å‡½æ•°è¿˜æœ‰ä¸€äº›propertyï¼Œæ¯”å¦‚ä»–çš„çŠ¶æ€ï¼Œæ•°æ®ç­‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">TinyPromise</span> (<span class="params">executor</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.state = promiseState.PENDING</div><div class="line">  <span class="keyword">this</span>.msg = <span class="keyword">void</span> <span class="number">0</span></div><div class="line">  <span class="keyword">this</span>.chains = [] <span class="comment">// åœ¨`then()`æ—¶å†è®²</span></div><div class="line"></div><div class="line">  executor(resolve, reject)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¥ç€ï¼Œå®šä¹‰<code>resolve</code>å’Œ<code>reject</code>è¿™2ä¸ªä¼ ç»™<code>executor</code>çš„å‚æ•°</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span></div><div class="line"></div><div class="line">  <span class="keyword">if</span> (self.state !== promiseState.FULLFILLED) &#123; <span class="comment">// #0</span></div><div class="line">    self.state = promiseState.FULLFILLED</div><div class="line">    self.msg = value</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  notify(self) <span class="comment">// ä¸‹é¢å†è®²</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>#0</code>ä¸ºä»€ä¹ˆè¦åŠ ä¸Š<code>if</code>åˆ¤æ–­å‘¢ï¼Ÿå› ä¸ºæœ‰å¯èƒ½<code>resolve</code>å¹¶ä¸æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨<code>then()</code>çš„æ—¶å€™ï¼Œpromiseçš„çŠ¶æ€å·²ç»ä¸º<code>fullfilled</code>äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™<code>value</code>æ˜¯<code>undefined</code>çš„ã€‚ä½ å¯ä»¥è‡ªå·±è¯•è¯•ã€‚</p>
<p>åˆ°åº•<code>chains</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h3 id="then"><a class="header-anchor" href="#then">#</a>Then</h3>
<p>å½“è°ƒç”¨<code>then</code>çš„æ—¶å€™ï¼Œä»–ä¼šè¿”å›ä¸€ä¸ªpromiseã€‚é‡å¤ä¹‹ï¼Œä¾¿å½¢æˆäº†é“¾(chain)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½æŠŠè¿™ä¸ªpromiseæ”¾è¿›<code>this.chains</code>é‡Œé¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>[<span class="string">'then'</span>] = (onFullfilled, onRejected) =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> o = &#123;</div><div class="line">    onFullfilled,</div><div class="line">    onRejected</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  o.promise = <span class="keyword">new</span> <span class="keyword">this</span>.constructor((resolve, reject) =&gt; &#123;</div><div class="line">    o = <span class="built_in">Object</span>.assign(o, &#123;resolve, reject&#125;)</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">this</span>.chains = [...this.chains, o]</div><div class="line"></div><div class="line">  <span class="comment">// doesn't call resolve or reject in executor async-ly</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.state === promiseState.FULLFILLED) <span class="comment">// #0</span></div><div class="line">    resolve.call(<span class="keyword">this</span>)</div><div class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.state === promiseState.REJECTED)</div><div class="line">    reject.call(<span class="keyword">this</span>)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> o.promise</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨<code>#0</code>ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªåˆ¤æ–­å‘¢ï¼Ÿå› ä¸ºåœ¨è°ƒç”¨<code>then</code>æ—¶ï¼Œpromiseçš„çŠ¶æ€å·²ç»ä¸æ˜¯<code>pending</code>äº†ã€‚ä¸ºä»€ä¹ˆï¼Ÿçœ‹çœ‹æ–‡æœ¬å‰é¢çš„<em>Why</em>éƒ¨åˆ†ã€‚</p>
<p>æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬æŠŠ<code>then</code>çš„2ä¸ªå‚æ•°ï¼Œä»¥åŠ<code>executor</code>çš„2ä¸ªå‚æ•°éƒ½æ”¾è¿›äº†<code>this.chains</code>é‡Œé¢ã€‚</p>
<h3 id="notify"><a class="header-anchor" href="#notify">#</a>Notify</h3>
<p><code>notify</code>å‡½æ•°çš„ä½œç”¨å°±æ˜¯æŠŠ<code>then</code>è¿”å›çš„ç»“æœä¼ é€’åˆ°ä¸‹ä¸€ä¸ª<code>then</code>é‡Œé¢å»ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> handleFullfill = (chain, self) =&gt; &#123;</div><div class="line">  <span class="comment">// ä¸Šä¸€ä¸ªthen()çš„success handlerçš„è¿”å›å€¼</span></div><div class="line">  <span class="keyword">const</span> result = chain.onFullfilled(self.msg)</div><div class="line">  <span class="comment">// ä¼ ç»™ä¸‹ä¸€ä¸ªthen()</span></div><div class="line">  chain.resolve(result)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> notify = self =&gt; &#123;</div><div class="line">  self.chains.forEach(chain =&gt; &#123;</div><div class="line">    <span class="keyword">switch</span> (self.state) &#123;</div><div class="line">      <span class="keyword">case</span> promiseState.FULLFILLED:</div><div class="line">        handleFullfill(chain, self)</div><div class="line">        <span class="keyword">break</span></div><div class="line"></div><div class="line">      <span class="keyword">case</span> promiseState.REJECTED:</div><div class="line">        handleReject(chain, self)</div><div class="line">        <span class="keyword">break</span></div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="promise-resolve"><a class="header-anchor" href="#promise-resolve">#</a>Promise.resolve</h3>
<p>è¿™ä¸ªæ–¹æ³•<code>resolve</code>å…¶å®å°±æ˜¯<code>Promise</code>æ„é€ å‡½æ•°çš„ä¸€ä¸ªpropertyã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">defineProp(TinyPromise, <span class="string">'resolve'</span>, msg =&gt;</div><div class="line">  <span class="keyword">new</span> TinyPromise((resolve, reject) =&gt; &#123;</div><div class="line">    resolve(msg)</div><div class="line">  &#125;)</div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">const</span> defineProp = (</div><div class="line">  obj = &#123;&#125;,</div><div class="line">  prop,</div><div class="line">  value</div><div class="line">) =&gt; &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.defineProperties(obj, prop, &#123;</div><div class="line">      value,</div><div class="line">      writable: <span class="literal">true</span>,</div><div class="line">      configurable: <span class="literal">true</span>,</div><div class="line">      enumerate: <span class="literal">true</span></div><div class="line">    &#125;)</div><div class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    obj[prop] = value</div><div class="line">    <span class="keyword">return</span> obj</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="wrap-up"><a class="header-anchor" href="#wrap-up">#</a>Wrap up</h2>
<p>å®ç°å®Œä»¥ä¸Šï¼Œä½ å°±å¯ä»¥è§£å†³æœ¬æ–‡å‰é¢éƒ¨åˆ†<em>Why</em>çš„é—®é¢˜äº†ã€‚</p>
<p><code>then</code>é¦–å…ˆä¼šæ‰§è¡Œï¼Œå› ä¸º<code>resolve</code>æ˜¯å¼‚æ­¥çš„(<code>setTimeout</code>é‡Œé¢)ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬æŠŠ<code>then</code>çš„å‚æ•°æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡æ•°ç»„é‡Œé¢ã€‚ç­‰åˆ°<code>resolve</code>è°ƒç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†å»éå†è¿™ä¸ªæ•°ç»„ï¼Œè°ƒç”¨<code>then</code>çš„å‚æ•°ï¼Œå¹¶ä¸”æŠŠè¿”å›å€¼ä¼ ç»™ä¸‹ä¸€ä¸ªpromiseã€‚</p>
<p>å¦‚æœ<code>resolve</code>ä¸æ˜¯å¼‚æ­¥çš„è¯ï¼Œé‚£ä¹ˆ<code>resolve</code>æ¯”<code>then</code>å…ˆæ‰§è¡Œã€‚åœ¨<code>then</code>æ‰§è¡Œçš„æ—¶å€™ï¼ŒçŠ¶æ€å·²ç»ä¸º<code>fullfilled</code>äº†ã€‚å› æ­¤åªéœ€è¦ç›´æ¥è°ƒç”¨<code>notify</code>å‡½æ•°ã€‚</p>
<p>Cool~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;(æ‰€æœ‰ä»£ç è¯·æŸ¥çœ‹&lt;a href=&quot;https://github.com/DrakeLeung/tiny-promise&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;GitHub tiny-promise&lt;/a&gt;)&lt;/p&gt;
&lt;h2 id=&quot;why&quot;&gt;&lt;a 
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>è¿·ä¹‹å‰ç«¯è½®å­ - å®ç°ä¸€ä¸ªç®€å•çš„ Virtual DOM</title>
    <link href="http://drakeleung.github.io/blog/2016/01/31/Virtual-DOM/"/>
    <id>http://drakeleung.github.io/blog/2016/01/31/Virtual-DOM/</id>
    <published>2016-01-31T05:30:49.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å®ç°äº†ä¸€ä¸ªç®€å•ç‰ˆçš„<a href="https://github.com/DrakeLeung/little-virtual-DOM" target="_blank" rel="external">Virtual DOM</a>ã€‚<br>
ä¹‹æ‰€ä»¥ç®€å•ï¼Œæ˜¯å› ä¸ºå¹¶æ²¡æœ‰å®ç°Reactçš„diffç®—æ³•ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥äº†è§£ä¸€ä¸‹Virtual DOMã€‚</p>
<h2 id="what"><a class="header-anchor" href="#what">#</a>What</h2>
<p><em>Virtual DOM</em> å…¶å®å°±æ˜¯ç”¨JSå¯¹è±¡å»è¡¨ç¤ºDOMå…ƒç´ ã€‚</p>

<h2 id="why"><a class="header-anchor" href="#why">#</a>Why</h2>
<p>ä¸ºä»€ä¹ˆè¦Virtual DOMå‘¢ï¼Ÿå› ä¸ºDOMçš„æ“ä½œæœ¬èº«æ˜¯å¾ˆæ…¢çš„ã€‚ä½†æ›´æ…¢çš„æ˜¯æ‰¹é‡æ“ä½œæ—¶çš„ä¸å½“ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦æ·»åŠ 5ä¸ª<code>&lt;li&gt;</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> appendElement =</div><div class="line">  type =&gt;</div><div class="line">    () =&gt;</div><div class="line">      <span class="built_in">document</span>.body.appendChild(<span class="built_in">document</span>.createElement(type))</div><div class="line"></div><div class="line"><span class="built_in">Array</span>.from(<span class="built_in">Array</span>(<span class="number">5</span>)).forEach(appendElement(<span class="string">'li'</span>))</div></pre></td></tr></table></figure>
<p>ä¸Šé¢æ¯æ¬¡ç”Ÿæˆä¸€ä¸ª<code>li</code>å°±æ’å…¥ï¼Œè¿™æ ·æ˜¯å¾ˆæ…¢çš„ã€‚æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯å…ˆç”Ÿæˆ5ä¸ª<code>li</code>ï¼Œç„¶åå†ä¸€æ¬¡æ€§æŠŠè¿™ä¸ª5ä¸ª<code>li</code>æ’å…¥ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Virtual DOMæ¥å®ç°ã€‚</p>
<h2 id="how"><a class="header-anchor" href="#how">#</a>How</h2>
<p>æ€»å…±åˆ†4ä¸ªæ­¥éª¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<h3 id="vnode"><a class="header-anchor" href="#vnode">#</a>VNode</h3>
<p><code>VNode</code>è¿™ä¸ªå‡½æ•°æ˜¯ç”¨JavaScriptå¯¹è±¡æ¥è¡¨ç¤ºDOMå…ƒç´ ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"item1"</span>&gt;</span>Call Me Item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div></pre></td></tr></table></figure>
<p>å¯ä»¥è¡¨ç¤ºä¸º:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  type: <span class="string">'li'</span>,</div><div class="line">  props: &#123;</div><div class="line">    id: <span class="string">'item1'</span></div><div class="line">  &#125;,</div><div class="line">  children: [<span class="string">'item1'</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œ<code>props</code>å¯ä»¥æ˜¯æ•°ç»„ï¼Œ<code>children</code> ä¹Ÿå¯ä»¥æ”¾åœ¨<code>props</code>é‡Œé¢ã€‚</p>
<h3 id="tohtml"><a class="header-anchor" href="#tohtml">#</a>toHTML</h3>
<p>è¿™ä¸ªå°±æ˜¯æŠŠ<code>VNode</code>è½¬åŒ–æˆçœŸæ­£çš„DOMå…ƒç´ ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// å¤§ä½“åˆ†3æ­¥</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="comment">// Step 1: createElement</span></div><div class="line"><span class="keyword">const</span> node = <span class="built_in">document</span>.createElement(type)</div><div class="line"></div><div class="line"><span class="comment">// Step 2: set props</span></div><div class="line"><span class="built_in">Object</span>.keys(props).forEach(prop =&gt; &#123;</div><div class="line">  node.setAttribute(prop, props[prop])</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// Step 3: set children</span></div><div class="line">children.forEach(VChild =&gt; &#123;</div><div class="line">  <span class="keyword">let</span> childNode</div><div class="line"></div><div class="line">  <span class="comment">// if text</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> VChild === <span class="string">'string'</span>) &#123;  <span class="comment">// #0</span></div><div class="line">    childNode = <span class="built_in">document</span>.createTextNode(VChild)</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    childNode = createNode(VChild)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  node.appendChild(childNode)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">return</span> node</div></pre></td></tr></table></figure>
<p>åœ¨<code>#0</code>ä¸­ï¼Œå¦‚æœå½“å‰nodeæ˜¯<code>string</code>çš„è¯ï¼Œå°±è¡¨æ˜æ˜¯<code>text</code>ã€‚å¦åˆ™è¿›è¡Œé€’å½’ã€‚</p>
<h3 id="diff"><a class="header-anchor" href="#diff">#</a>Diff</h3>
<p><code>diff</code>éœ€è¦æŠŠæ–°çš„Virtual DOMå’Œæ—§çš„è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œå¾—åˆ°å˜åŒ–çš„åœ°æ–¹ã€‚<br>
è¿™ä¸ªè¿‡ç¨‹æœ€éš¾çš„äº†ã€‚æˆ‘æ²¡ç”¨å®ç°Reactçš„diffç®—æ³•ï¼Œåªæ˜¯å¯¹åŒçº§å…ƒç´ è¿›è¡Œäº†æ¯”è¾ƒè€Œå·²ã€‚</p>
<p>ä¸»è¦æœ‰ä¸åŒçš„4ç§æƒ…å†µ:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> TEXT = <span class="string">'TEXT'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> PROPS = <span class="string">'PROPS'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> REPLACE = <span class="string">'REPLACE'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_CHILD = <span class="string">'ADD_CHILD'</span></div></pre></td></tr></table></figure>
<ul>
<li><code>TEXT</code>: æ›¿æ¢æ—§çš„<code>text</code></li>
<li><code>PROPS</code>: è¡¨æ˜<code>props</code>å¯èƒ½æ˜¯å¢åŠ ï¼Œåˆ é™¤æˆ–ä¿®æ”¹</li>
<li><code>REPLACE</code>: æ›¿æ¢æ—§çš„èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬åˆ é™¤çš„</li>
<li><code>ADD_CHILD</code>: è¡¨ç¤ºéœ€è¦å¢åŠ child</li>
</ul>
<p>å®ç°è¿‡ç¨‹ä¸è®²è¿°ï¼Œè¯¦ç»†çœ‹æºä»£ç (<a href="https://github.com/DrakeLeung/little-virtual-DOM/blob/master/src%2Fdiff.js" target="_blank" rel="external">diff</a>)</p>
<h3 id="patch"><a class="header-anchor" href="#patch">#</a>Patch</h3>
<p>è¿™ä¸ªè¿‡ç¨‹æŠŠä¸Šä¸ªæ­¥éª¤å¾—åˆ°çš„<code>diff</code>æ¥ç»™å½“å‰çš„DOMèŠ‚ç‚¹è¿›è¡Œæ“ä½œã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æˆ‘ä»¬ä¼˜åŒ–DOMæ“ä½œçš„åœ°æ–¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> applyPatch = (node, currentPatch) =&gt; &#123;</div><div class="line">  <span class="keyword">switch</span> (currentPatch.type) &#123;</div><div class="line">    <span class="keyword">case</span> patchType.TEXT:</div><div class="line">      node.nodeValue = currentPatch.content</div><div class="line">      <span class="keyword">break</span></div><div class="line"></div><div class="line">    <span class="keyword">case</span> patchType.PROPS:</div><div class="line">      setProps(node, currentPatch.props)</div><div class="line">      <span class="keyword">break</span></div><div class="line"></div><div class="line">    <span class="keyword">case</span> patchType.REPLACE:</div><div class="line">      <span class="keyword">if</span> (isExist(currentPatch.node)) &#123;</div><div class="line">        node.parentNode.replaceChild(toHTML(currentPatch.node), node)</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        node.parentNode.removeChild(node)</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">break</span></div><div class="line"></div><div class="line">    <span class="keyword">case</span> patchType.ADD_CHILD:</div><div class="line">      node.appendChild(toHTML(currentPatch.node))</div><div class="line">      <span class="keyword">break</span></div><div class="line"></div><div class="line">    <span class="keyword">default</span>:</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="wrap-up"><a class="header-anchor" href="#wrap-up">#</a>Wrap up</h2>
<p>ä»å®ç°è¿™ä¸ªç®€å•çš„Virtual DOMï¼Œæ€è·¯ç¡®å®æ˜¯æ‰“å¼€äº†ä¸å°‘ã€‚</p>
<ul>
<li>ç”¨JavaScriptå¯¹è±¡æ¥è¡¨ç¤ºDOMå…ƒç´ ã€‚ä¹‹å‰åªä¼šç›´æ¥æ“ä½œDOMï¼Œæ²¡æœ‰æƒ³åˆ°å¯ä»¥è¿™æ ·ç©ã€‚</li>
<li>æ€ä¹ˆæ¯”è¾ƒ2æ£µæ ‘çš„ä¸åŒï¼Ÿåªéœ€è¦æ¯”è¾ƒåŒçº§çš„å…ƒç´ ã€‚è™½ç„¶è¿˜æ˜¯ä¸ä¼šæ¯”è¾ƒchildren</li>
<li>å¤ä¹ äº†DOMçš„ä¸€äº›çŸ¥è¯†ã€‚</li>
</ul>
<p>æ‰€ä»¥<strong>å¤šå°è¯•</strong>ä¸åŒçš„ä¸œè¥¿ï¼Œæ€è·¯ä¼šæ‰©å±•ä¸å°‘~</p>
<h2 id="resource"><a class="header-anchor" href="#resource">#</a>Resource</h2>
<ul>
<li><a href="https://gist.github.com/sebmarkbage/fcb1b6ab493b0c77d589" target="_blank" rel="external">React (Virtual) DOM Terminology</a></li>
<li><a href="https://gcanti.github.io/2014/10/29/understanding-react-and-reimplementing-it-from-scratch-part-1.html" target="_blank" rel="external">Understanding-react-and-reimplementing-it-from-scratch-part-1</a></li>
<li><a href="https://www.zhihu.com/question/29504639" target="_blank" rel="external">æ€ä¹ˆæ›´å¥½åœ°ç†è§£è™šæ‹ŸDOM</a></li>
<li><a href="https://github.com/livoras/blog/issues/13" target="_blank" rel="external">å¦‚ä½•å®ç°ä¸€ä¸ªVirtual DOMç®—æ³•</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘å®ç°äº†ä¸€ä¸ªç®€å•ç‰ˆçš„&lt;a href=&quot;https://github.com/DrakeLeung/little-virtual-DOM&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Virtual DOM&lt;/a&gt;ã€‚&lt;br&gt;
ä¹‹æ‰€ä»¥ç®€å•ï¼Œæ˜¯å› ä¸ºå¹¶æ²¡æœ‰å®ç°R
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªHexoä¸»é¢˜</title>
    <link href="http://drakeleung.github.io/blog/2016/01/27/Write-a-Hexo-Theme-From-Strach/"/>
    <id>http://drakeleung.github.io/blog/2016/01/27/Write-a-Hexo-Theme-From-Strach/</id>
    <published>2016-01-27T14:23:29.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æˆ‘ä¹Ÿä¸ä¼šå†™ï¼Œä½†æ˜¯å½“æˆ‘äº†è§£ä»¥ä¸‹ä¸œè¥¿çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»é›¶å¼€å§‹å†™ä¸€ä¸ªHexoä¸»é¢˜äº†ã€‚</p>

<ul>
<li>NodeJS / NPM</li>
<li>æ¨¡æ¿å¼•æ“(Template Engine)ï¼Œæ¯”å¦‚EJS, Jadeï¼ŒHandlebarsç­‰ç­‰éƒ½å¯ä»¥</li>
<li>HTML / CSS / JavaScript</li>
<li>é˜…è¯»Hexoçš„<a href="https://hexo.io/docs/" target="_blank" rel="external">æ–‡æ¡£</a></li>
<li>é˜…è¯»Hexoé»˜è®¤ä¸»é¢˜<a href="https://github.com/hexojs/hexo-theme-landscape" target="_blank" rel="external">landscape</a>çš„æºç </li>
</ul>
<p>ä»¥ä¸Šæ­£æ˜¯ä¸€åWebå‰ç«¯äººå‘˜éœ€è¦äº†è§£å’ŒæŒæ¡çš„ä¸œè¥¿ã€‚<br>
<strong>ä¸è¿‡ï¼Œä¸ä¼šå‰ç«¯ä¹Ÿä¸è¦ç´§ï¼Œæˆ‘å‘Šè¯‰ä½ ä»¥ä¸‹çš„ä¸œè¥¿å°±è¶³å¤Ÿäº†ã€‚</strong></p>
<h2 id="nodejs-npm"><a class="header-anchor" href="#nodejs-npm">#</a>NodeJS / NPM</h2>
<p>é¦–å…ˆï¼ŒHexoæ˜¯ç”±NodeJSæ¥ç¼–å†™çš„ã€‚ç¼–å†™ä¸€ä¸ªåº”ç”¨æ˜¯éœ€è¦ç¬¬ä¸‰æ–¹åŒ…(ä¾èµ–/åº“)ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„<code>package.json</code>æ–‡ä»¶çš„ç”±æ¥ã€‚è¿™äº›packageæ€ä¹ˆä¸‹è½½çš„å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯é€šè¿‡<a href="https://www.npmjs.com/" target="_blank" rel="external">NPM</a>(Node Package Manager)ï¼Œç„¶åä»–ä»¬éƒ½ä¼šå®‰è£…åœ¨<code>node_modules/</code>è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢ã€‚</p>
<p>OKï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦çŸ¥é“çš„NodeJSå’ŒNPMçš„çŸ¥è¯†ã€‚</p>
<h2 id="hexoçš„workflow"><a class="header-anchor" href="#hexoçš„workflow">#</a>Hexoçš„Workflow</h2>
<p><strong>ä¸‹é¢æ˜¯é‡ç‚¹ã€‚</strong></p>
<p>Hexoä¼šè¯»å–æ ¹ç›®å½•ä¸‹çš„<code>_config.yml</code>é‡Œé¢çš„<code>theme</code>å±æ€§, ä»è€Œé‡‡ç”¨å¯¹åº”çš„ä¸»é¢˜ã€‚è€Œä¸»é¢˜éƒ½æ˜¯æ”¾åœ¨<code>themes/</code>ç›®å½•ä¸‹é¢çš„ï¼Œç„¶åä½ ä¼šå‘ç°ä»–é‡Œé¢æœ‰ä¸ª<code>landscape</code>çš„ç›®å½•ï¼Œè¿™ä¸ªå°±æ˜¯é»˜è®¤ä¸»é¢˜å•¦ã€‚</p>

<p>æ¥ç€ï¼Œæˆ‘ä»¬æŸ¥çœ‹<code>themes/landscape/</code>ç›®å½•ï¼Œä»¥åŠæ ¹æ®æ–‡æ¡£<a href="https://hexo.io/docs/themes.html" target="_blank" rel="external">docs-themes</a>ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å¾—å‡ºï¼šä¸€ä¸ªä¸»é¢˜å…¶å®ç”±4éƒ¨åˆ†ç»„æˆã€‚</p>
<ul>
<li><code>_config.yml</code>: ä¸»é¢˜çš„é…ç½®æ–‡ä»¶</li>
<li><code>source/</code>: æ”¾æˆ‘ä»¬çš„CSSæ–‡ä»¶ä»¥åŠå›¾ç‰‡</li>
<li><code>layout/</code>: æ¨¡æ¿æ–‡ä»¶</li>
<li><code>scripts</code>: æ”¾JavaScriptæ–‡ä»¶ï¼Œä»–ä»¬ä¼šè‡ªåŠ¨åŠ è½½</li>
</ul>
<p>ç„¶åï¼Œæ ¹æ®æ–‡æ¡£<a href="https://hexo.io/docs/templates.html" target="_blank" rel="external">docs-templates</a>ï¼Œä¸éš¾å¾—å‡ºï¼š</p>
<p>æ¯æ¬¡å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨è®¿é—®æ—¶ï¼ŒHexoéƒ½ä¼šå»è§£æ<code>sources</code>ç›®å½•ä¸‹å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶ã€‚ä¸åŒçš„URLå¯¹åº”ä¸åŒçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æ‰æœ‰äº†ä¸åŒçš„é¡µé¢ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªä¸ªURLå¯¹åº”å“ªä¸ªé¡µé¢å‘¢ï¼Ÿ(ä¸‹é¢æˆ‘ä»¬ä»¥<code>EJS</code>ä¸ºä¾‹)</p>
<p>æ— è®ºURLæ˜¯ä»€ä¹ˆï¼ŒHexoå…ˆè¯»å–<code>layout.ejs</code>ï¼Œç„¶åé‡Œé¢çš„<a href="https://github.com/hexojs/hexo-theme-landscape/blob/master/layout%2Flayout.ejs" target="_blank" rel="external">body</a>å˜é‡ä¼šæ›¿æ¢æˆä»¥ä¸‹å†…å®¹ï¼š(<em>Fallback</em>çš„æ„æ€æ˜¯å¦‚æœè®¿é—®<code>/archives</code>æ—¶ï¼Œæˆ‘ä»¬çš„<code>archives.ejs</code>ä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šè¿”å›<code>index.ejs</code>)</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>Template</th>
<th>Fallback</th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>index.ejs</td>
<td></td>
</tr>
<tr>
<td>/archives</td>
<td>archive.ejs</td>
<td>index.ejs</td>
</tr>
<tr>
<td>æ–‡ç« </td>
<td>post.ejs</td>
<td>index.ejs</td>
</tr>
</tbody>
</table>
<p>å¦‚ä¸‹å›¾æ‰€ç¤º:</p>

<p>æˆ–è€…ï¼Œå¯ä»¥å…ˆå°è¯•ä¸€ä¸‹æ²¡æœ‰<code>layout.ejs</code>çš„æƒ…å†µï¼Œå› ä¸ºæ¯”è¾ƒç®€å•ã€‚ä¹Ÿå°±æ˜¯ï¼Œè®¿é—®<code>/</code>ï¼ŒHexoå°±è¿”å›<code>index.ejs</code>é‡Œé¢çš„ä¸œè¥¿ç»™ä½ ã€‚è®¿é—®<code>/archives</code>å°±è¿”å›<code>archive.ejs</code>ã€‚</p>
<h2 id="æ¨¡æ¿æ–‡ä»¶"><a class="header-anchor" href="#æ¨¡æ¿æ–‡ä»¶">#</a>æ¨¡æ¿æ–‡ä»¶</h2>
<p>é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å°±è¦ç¼–å†™æˆ‘ä»¬çš„æ¨¡æ¿æ–‡ä»¶äº†ã€‚æ€ä¹ˆå†™å‘¢ï¼Ÿ<br>
æ¯”å¦‚æˆ‘çš„æ ¹ç›®å½•æƒ³æ˜¾ç¤ºæ‰€æœ‰çš„æ–‡ç« ï¼Ÿæˆ‘ä»¬å°±è¦ä½¿ç”¨Hexoæä¾›çš„<a href="https://hexo.io/docs/variables.html" target="_blank" rel="external">å˜é‡</a>äº†ã€‚é€šè¿‡æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡º<code>page.posts</code>è¿™ä¸ªå˜é‡å°±åŒ…å«äº†æ‰€æœ‰çš„æ–‡ç« ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">page.posts.each</span>(<span class="attr">function</span>(<span class="attr">post</span>)&#123; %&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">article</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span> post.title <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span> post.content <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">article</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%</span> &#125;) %&gt;</span></div></pre></td></tr></table></figure>
<p>ç¼–å†™æ¨¡æ¿æ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½åˆ©ç”¨Hexoå†…ç½®çš„ä¸€äº›<a href="https://hexo.io/docs/helpers.html" target="_blank" rel="external">helper</a>æ¥æ–¹ä¾¿å¼€å‘ï¼Œæ¯”å¦‚åˆ†é¡µä½¿ç”¨<a href="https://hexo.io/docs/helpers.html#paginator" target="_blank" rel="external">paginator</a>ï¼Œè·¯å¾„å¤„ç†ä½¿ç”¨<a href="https://hexo.io/docs/helpers.html#url_for" target="_blank" rel="external">url_for</a>ç­‰ã€‚</p>
<h2 id="æ ·å¼"><a class="header-anchor" href="#æ ·å¼">#</a>æ ·å¼</h2>
<p>æˆ‘ä»¬çš„CSSæ–‡ä»¶æ˜¯æ”¾åœ¨<code>source</code>é‡Œé¢çš„ï¼Œç„¶åè¦æ€ä¹ˆåŠ è½½å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ¨¡æ¿æ–‡ä»¶é‡Œé¢å¼•å…¥ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„é¦–é¡µéœ€è¦<code>app.css</code>ï¼Œé‚£ä¹ˆå°±åœ¨<code>index.ejs</code>é‡Œé¢å¼•ç”¨å°±è¡Œäº†ã€‚å¦‚æœæ¯ä¸ªé¡µé¢éƒ½ç”¨åˆ°çš„è¯ï¼Œå°±æ”¾åœ¨<code>layout.ejs</code>ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%-</span> <span class="attr">css</span>('<span class="attr">path</span>/<span class="attr">to</span>/<span class="attr">app</span>') %&gt;</span></div></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨é¢„å¤„ç†å™¨æ¥å†™æ ·å¼ï¼Œæ¯”å¦‚Sassï¼ŒStylusç­‰ç­‰ã€‚æ­¤æ—¶ï¼Œä½ å°±è¦ä¸‹è½½å¯¹åº”çš„packageæ¥è§£é‡ŠæˆCSSã€‚æ¯”å¦‚ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯Sassï¼Œé‚£ä¹ˆæˆ‘å°±è¦<code>npm i --save hexo-renderer-sass</code>æ¥æŠŠ<code>.scss</code>æ–‡ä»¶è§£é‡Šæˆ<code>.css</code>æ–‡ä»¶ã€‚</p>
<h2 id="æ€»ç»“ä¸€ä¸‹"><a class="header-anchor" href="#æ€»ç»“ä¸€ä¸‹">#</a>æ€»ç»“ä¸€ä¸‹</h2>
<p>å¦‚æœé‡åˆ°é—®é¢˜çš„è¯ï¼ŒæŸ¥çœ‹Hexoé»˜è®¤ä¸»é¢˜<a href="https://github.com/hexojs/hexo-theme-landscape" target="_blank" rel="external">landscape</a>çš„æºç ä»¥åŠ<a href="https://hexo.io/docs/" target="_blank" rel="external">æ–‡æ¡£</a>å°±èƒ½è§£å†³äº†ã€‚<br>
æœ€åå–ä¸‹å¹¿å‘Šï¼Œè¿™æ˜¯æˆ‘å†™çš„ä¸»é¢˜ï¼š<a href="https://github.com/DrakeLeung/hexo-theme-again" target="_blank" rel="external">hexo-theme-again</a>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¹‹å‰æˆ‘ä¹Ÿä¸ä¼šå†™ï¼Œä½†æ˜¯å½“æˆ‘äº†è§£ä»¥ä¸‹ä¸œè¥¿çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»é›¶å¼€å§‹å†™ä¸€ä¸ªHexoä¸»é¢˜äº†ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;NodeJS / NPM&lt;/li&gt;
&lt;li&gt;æ¨¡æ¿å¼•æ“(Template Engine)ï¼Œæ¯”å¦‚EJS, Jadeï¼ŒHandlebarsç­‰ç­‰éƒ½å¯ä»¥&lt;/li&gt;
&lt;li&gt;H
    
    </summary>
    
    
      <category term="hexo" scheme="http://drakeleung.github.io/blog/tags/hexo/"/>
    
      <category term="theme" scheme="http://drakeleung.github.io/blog/tags/theme/"/>
    
  </entry>
  
  <entry>
    <title>5 Ways To Make A Sticky Footer</title>
    <link href="http://drakeleung.github.io/blog/2016/01/20/5-Ways-to-Make-a-Sticky-Footer/"/>
    <id>http://drakeleung.github.io/blog/2016/01/20/5-Ways-to-Make-a-Sticky-Footer/</id>
    <published>2016-01-20T07:19:06.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>Sticky Footer</em>åœ¨å†…å®¹å±•ç¤ºçš„ç½‘ç«™éƒ½ä¼šç”¨åˆ°ã€‚æ¯”å¦‚blogï¼Œxxçš„ä¸»é¡µç­‰ç­‰ã€‚</p>
<h2 id="what-is-sticky-footer"><a class="header-anchor" href="#what-is-sticky-footer">#</a>What is Sticky Footer</h2>
<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä¸å¦¨å‡è®¾æˆ‘ä»¬çš„<code>index.html</code>æ˜¯è¿™æ ·çš„:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Ways to make a sticky foote<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span><span class="tag">&lt;/<span class="name">main</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œå¦‚ä¸‹é¢çš„å›¾æ‰€ç¤ºï¼Œå›¾<code>a</code>å’Œ<code>b</code>éƒ½ä¸æ˜¯<em>Sticky Footer</em>.</p>
<p><img src="http://ww2.sinaimg.cn/large/7f85b91egw1f0asb7siypj20go088q4x.jpg" alt=""></p>
<p>å› ä¸ºå›¾<code>a</code>çš„é¡µè„šçš„åé¢è¿˜æœ‰ç©ºç™½éƒ¨åˆ†ã€‚æˆ‘ä»¬æƒ³è¦çš„åº”è¯¥æ˜¯é¡µè„šå°±æ˜¯åœ¨é¡µé¢çš„æœ€åº•éƒ¨ã€‚</p>
<p>é‚£ä¹ˆå›¾<code>b</code>ä¸ºä»€ä¹ˆä¸æ˜¯å‘¢ï¼Ÿä»–ä¸æ˜¯åœ¨é¡µé¢çš„æœ€åº•éƒ¨å—ï¼Ÿæ²¡é”™ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ˜¯åªæœ‰å½“<strong>scroller bar</strong>æ»‘åˆ°æœ€åº•éƒ¨çš„æ—¶å€™ï¼Œæ‰ä¼šå‡ºç°é¡µè„šã€‚</p>
<p>åƒä¸‹é¢çš„å›¾<code>c</code>å’Œ<code>d</code>æ‰æ˜¯æˆ‘ä»¬çš„<em>Sticky Footer</em>:<br>
<img src="http://ww2.sinaimg.cn/large/7f85b91egw1f0asq75p07j20gl09i0vh.jpg" alt=""></p>
<h2 id="ways-to-sticky-footer"><a class="header-anchor" href="#ways-to-sticky-footer">#</a>Ways to Sticky Footer</h2>
<p>åºŸè¯å°‘è¯´ï¼Œä¸‹é¢ä¼šä»‹ç»å‡ ç§åˆ›å»º<em>Sticky Footer</em>çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬ä¼šä»æœ€ç®€å•çš„æ–¹æ³•å¼€å§‹ï¼Œä½†æœ€ç®€å•çš„ä¸ä¸€å®šæ˜¯æœ€å¥½çš„ï¼Œç¬¦åˆè‡ªå·±çš„ä½¿ç”¨åœºæ™¯æ‰æ˜¯æœ€å¥½çš„ã€‚æœ€åæ€»ç»“æ¯ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ã€‚</p>
<p>(P.S. å‡è®¾æˆ‘ä»¬éƒ½ä½¿ç”¨ä¸Šé¢çš„<code>index.html</code>æ‰€ç¤ºç»“æ„)</p>
<h3 id="flexbox"><a class="header-anchor" href="#flexbox">#</a>Flexbox</h3>
<p><em><a href="https://philipwalton.github.io/solved-by-flexbox/demos/sticky-footer/" target="_blank" rel="external">æ–¹æ³•æ¥æº</a></em></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* #0 */</span></div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">display</span>: flex;</div><div class="line">  <span class="attribute">flex-direction</span>: column;</div><div class="line">  <span class="attribute">min-height</span>: <span class="number">100vh</span>;</div><div class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* #1 */</span></div><div class="line"><span class="selector-tag">main</span> &#123;</div><div class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>#0</code>æ˜¯ä¸­çš„<code>min-height: 100vh</code>æ˜¯ä¸ºäº†è®©<code>&lt;main&gt;</code>çš„é«˜åº¦æ²¡æœ‰å¤§äºå±å¹•çš„é«˜åº¦æ—¶ï¼Œä½¿å¾—<code>footer</code>å¯ä»¥åœ¨é¡µé¢çš„åº•éƒ¨ã€‚è€Œï¼Œ<code>margin: 0</code>æ˜¯å»æ‰åŸæœ¬æµè§ˆå™¨è‡ªå¸¦çš„<code>&lt;body&gt;</code>çš„æ ·å¼ã€‚</p>
<p><code>#1</code>çš„<code>flex: 1</code>æ˜¯ä¸ºäº†è®©<code>&lt;main&gt;</code>å æ»¡å¤šä½™çš„ç©ºé—´ã€‚</p>
<h3 id="modern-way"><a class="header-anchor" href="#modern-way">#</a>Modern Way</h3>
<p><em><a href="http://mystrd.at/modern-clean-css-sticky-footer/" target="_blank" rel="external">æ–¹æ³•æ¥æº</a></em></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* #0 */</span></div><div class="line"><span class="selector-tag">html</span> &#123;</div><div class="line">  <span class="attribute">position</span>: relative;</div><div class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* #1 */</span></div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">margin-bottom</span>: <span class="number">100px</span>; <span class="comment">/* same to footer height */</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* #2 */</span></div><div class="line"><span class="selector-tag">footer</span> &#123;</div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>#0</code>ä¸­çš„<code>position: relative</code>å¾ˆæ˜¾ç„¶æ˜¯ä¸ºäº†è®©<code>&lt;html&gt;</code>å˜æˆ<em>containning block</em>ï¼Œ<br>
è¿™ä¸ªåœ¨<code>#2</code>ä¼šè¯´åˆ°ã€‚åŒæ ·åœ°ï¼Œ<code>min-height: 100%</code>å’Œä¸Šé¢çš„<em>flexbox</em>æ–¹æ³•ä¸­çš„<code>#0</code>ä¸€æ ·ã€‚</p>
<p><code>#1</code>çš„<code>margin-bottom</code>è®¾ä¸º<code>100px</code>æ˜¯å’Œ<code>&lt;footer&gt;</code>çš„é«˜åº¦ä¸€æ ·çš„ã€‚ç›®çš„æ˜¯å½“<code>&lt;body&gt;</code>çš„å†…å®¹æº¢å‡º<br>
çš„æ—¶å€™ï¼Œé˜²æ­¢<code>&lt;footer&gt;</code>çš„å†…å®¹è¹¿åˆ°<code>&lt;body&gt;</code>é‡Œé¢ã€‚</p>
<p><code>#2</code>è®¾ç½®äº†<code>position: absolute</code>ï¼Œè¿™æ ·ï¼Œ<code>left</code>å’Œ<code>bottom</code>çš„å€¼éƒ½æ˜¯ç›¸å¯¹äº<code>&lt;footer&gt;</code>çš„<em>containning block</em>æ¥è¯´çš„ã€‚<br>
ç”±äºåœ¨<code>#0</code>è®¾ç½®äº†<code>&lt;html&gt;</code>çš„<code>position</code>ä¸º<code>relative</code>ï¼Œæ‰€ä»¥<code>&lt;html&gt;</code>å°±æ˜¯<code>&lt;footer&gt;</code>çš„<em>containning block</em>ã€‚</p>
<h3 id="table-way"><a class="header-anchor" href="#table-way">#</a>Table Way</h3>
<p><em><a href="http://codepen.io/anon/pen/zrRLVW" target="_blank" rel="external">æ–¹æ³•æ¥æº</a>æˆ–è€…<a href="https://gist.github.com/goldsky/7322156" target="_blank" rel="external">è¿™ä¸ª</a></em></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span>,</div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">display</span>: table; <span class="comment">/* #0 */</span></div><div class="line">&#125;</div><div class="line"><span class="selector-tag">main</span>,</div><div class="line"><span class="selector-tag">footer</span> &#123;</div><div class="line">  <span class="attribute">display</span>: table-row;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* #1</span></div><div class="line">main &#123;</div><div class="line">  height: 100%;</div><div class="line">&#125;</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="selector-tag">footer</span> &#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">1px</span>; <span class="comment">/* #2 */</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶å®è¿™ä¸ªæ–¹æ³•å°±æ˜¯åˆ©ç”¨äº†<code>table</code>å¸ƒå±€ï¼Œç„¶åè®¾ç½®<code>&lt;footer&gt;</code>çš„é«˜åº¦ä¸º<code>1px</code>(å¦‚<code>#2</code>æ‰€ç¤º)ã€‚ä½†æ˜¯æˆ‘å¹¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚<br>
å¹¶ä¸”ï¼Œå¦‚æœæˆ‘æŠŠ<code>#2</code>æ³¨é‡Šæ‰ï¼ŒæŠŠ<code>#1</code>çš„æ³¨é‡Šå»æ‰ï¼Œä¹Ÿæ˜¯workçš„ã€‚æ‰€ä»¥ä¸çŸ¥é“è®¾ç½®<code>1px</code>æœ‰ä»€ä¹ˆç”¨ã€‚</p>
<h3 id="old-way"><a class="header-anchor" href="#old-way">#</a>Old Way</h3>
<p><em><a href="http://ryanfait.com/resources/footer-stick-to-bottom-of-page/" target="_blank" rel="external">æ–¹æ³•æ¥æº</a></em></p>
<p>è¿™ç§æ–¹æ³•éœ€è¦æˆ‘ä»¬æ”¹å˜ä¸€ä¸‹æˆ‘ä»¬çš„<code>index.html</code>ï¼Œç»™æˆ‘ä»¬çš„<code>&lt;main&gt;</code>æ·»åŠ ä¸€ä¸ªç©ºç™½çš„<code>&lt;div&gt;</code>ã€‚<br>
ä»–å…¶å®æ˜¯<code>&lt;footer&gt;</code>çš„<em>placeholder</em>ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Ways to make a sticky foote<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"push"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!-- new --&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œå¯¹åº”çš„CSSæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">main</span> &#123;</div><div class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</div><div class="line">  <span class="attribute">margin-bottom</span>: -<span class="number">100px</span>; <span class="comment">/* #0 */</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">footer</span>,</div><div class="line"><span class="selector-class">.push</span> &#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100px</span>; <span class="comment">/* #1 */</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>#0</code>ç»™<code>&lt;main&gt;</code>è®¾ç½®äº†<code>margin-bottom: -100px</code>ã€‚è¿™æ˜¯<code>&lt;footer&gt;</code>çš„é«˜åº¦çš„ç›¸åæ•°ã€‚<br>
ä»–æ˜¯ä¸ºäº†è®©<code>&lt;footer&gt;</code>å¯ä»¥è¹¿åˆ°<code>&lt;div class=&quot;push&quot;&gt;&lt;/div&gt;</code>çš„ä½ç½®ã€‚</p>
<p>å› ä¸º<code>.push</code>å°±æ˜¯<code>&lt;footer&gt;</code>çš„placeholder, æ˜¾ç„¶ä»–ä»¬çš„<code>height</code>å¿…é¡»æ˜¯ä¸€æ ·çš„ï¼Œå¦‚<code>#1</code>æ‰€ç¤ºã€‚</p>
<p>å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸ºäº†<code>:after</code>æ”¹è¿›ä¸€ä¸‹ã€‚å› ä¸º<code>.push</code>å­˜åœ¨çš„æ„ä¹‰åªæ˜¯ä¸ºäº†æ ·å¼è€Œæ ·å¼ï¼Œå¹¶ä¸æ˜¯é¡µé¢çš„ç»“æ„ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å¿…è¦å‡ºç°åœ¨<code>index.html</code>é‡Œé¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœ‰äº†ä¸‹é¢çš„<em>Old Way Plus</em>ã€‚</p>
<h3 id="old-way-plus"><a class="header-anchor" href="#old-way-plus">#</a>Old Way Plus</h3>
<p><em><a href="https://css-tricks.com/snippets/css/sticky-footer/" target="_blank" rel="external">æ–¹æ³•æ¥æº</a></em></p>
<p>(æ³¨æ„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦ç»™<code>&lt;main&gt;</code>æ·»åŠ ä¸€ä¸ª<code>&lt;div class=&quot;push&quot;&gt;&lt;/div&gt;</code>)</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">main</span> &#123;</div><div class="line">  <span class="attribute">min-height</span>: <span class="number">100%</span>;</div><div class="line">  <span class="comment">/* equal to footer height */</span></div><div class="line">  <span class="attribute">margin-bottom</span>: -<span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* #0 */</span></div><div class="line"><span class="selector-tag">main</span><span class="selector-pseudo">:after</span> &#123;</div><div class="line">  <span class="attribute">content</span>: <span class="string">""</span>;</div><div class="line">  <span class="attribute">display</span>: block;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">footer</span> &#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>#0</code>, æˆ‘ä»¬åˆ©ç”¨ä¼ªç±»<code>:after</code>æ¥æ›¿ä»£ä¸Šé¢çš„<em>Old Way</em>çš„<code>.push</code>ï¼Œè¿™æ ·å°±ä¸éœ€è¦ç»™<code>index.html</code><br>
æ·»åŠ ä¸å¿…è¦çš„æ ‡ç­¾ã€‚</p>
<h2 id="to-sum-up"><a class="header-anchor" href="#to-sum-up">#</a>To Sum Up</h2>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>éš¾åº¦</th>
<th>Footeréœ€è¦å›ºå®šé«˜åº¦</th>
<th>æµè§ˆå™¨å…¼å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>Flexbox</td>
<td>+</td>
<td>No</td>
<td>+</td>
</tr>
<tr>
<td>Modern way</td>
<td>++</td>
<td>Yes</td>
<td>+++</td>
</tr>
<tr>
<td>Table way</td>
<td>++</td>
<td>No</td>
<td>++?</td>
</tr>
<tr>
<td>Old way</td>
<td>+++</td>
<td>Yes</td>
<td>+++</td>
</tr>
<tr>
<td>Old way Plus</td>
<td>++</td>
<td>Yes</td>
<td>++</td>
</tr>
</tbody>
</table>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;Sticky Footer&lt;/em&gt;åœ¨å†…å®¹å±•ç¤ºçš„ç½‘ç«™éƒ½ä¼šç”¨åˆ°ã€‚æ¯”å¦‚blogï¼Œxxçš„ä¸»é¡µç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;what-is-sticky-footer&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#what-is-sticky-foot
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>BFC in CSS(0) - WTF</title>
    <link href="http://drakeleung.github.io/blog/2015/07/25/BFC-in-CSS-0-WTF/"/>
    <id>http://drakeleung.github.io/blog/2015/07/25/BFC-in-CSS-0-WTF/</id>
    <published>2015-07-24T17:21:40.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>çœ‹äº†<a href="http://www.sitepoint.com/understanding-block-formatting-contexts-in-css/" target="_blank" rel="external">Understanding Block Formatting Contexts in CSS</a>è¿™ç¯‡æ–‡ç« ï¼Œç»ˆäºæœ‰ç‚¹æ˜ç™½ä»€ä¹ˆæ˜¯BFC(Block Formatting Context)äº†ã€‚</p>
<h2 id="normal-flow"><a class="header-anchor" href="#normal-flow">#</a>Normal Flow</h2>
<p><strong>ä¸‹é¢è¿™å¥è¯ä¸è¦å¿½ç•¥å•Šã€‚è¦ä¸ç„¶å¾ˆå¤šäº‹æƒ…å°±æƒ³ä¸é€š</strong>ã€‚</p>
<blockquote>
<p>Boxes in the normal flow belong to a formatting context, which may be block or inline, but not both simultaneously. Block-level boxes participate in a block formatting context. Inline-level boxes participate in an inline formatting context.</p>
</blockquote>
<p>åœ¨normal flowä¸­çš„ç›’å­éƒ½æ˜¯å±äºformatting contextçš„ï¼ï¼ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> I am in the formatting context<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span> I also belong to the formatting context<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ï¼Œ<code>p</code>å’Œ<code>div</code>éƒ½æ˜¯åœ¨<em>normal flow</em>é‡Œé¢çš„ã€‚å¹¶ä¸”ï¼Œä»–ä»¬éƒ½æ˜¯å—çº§å…ƒç´ ï¼Œæ‰€ä»¥ä»–ä»¬å‚ä¸äº†block formatting contextsã€‚</p>
<p>é‚£ä¹ˆï¼Œå‚ä¸äº†BFCåˆä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p>
<h2 id="block-formatting-contexts"><a class="header-anchor" href="#block-formatting-contexts">#</a>Block Formatting Contexts</h2>
<p>ä¸‹é¢çš„<a href="http://www.w3.org/TR/CSS21/visuren.html#block-formatting" target="_blank" rel="external">æ–‡æ¡£</a>å®šä¹‰äº†<em>åœ¨BFCä¸­ç›’å­æ˜¯æ€ä¹ˆæ’ç‰ˆçš„</em>:</p>
<blockquote>
<p>In a block formatting context, boxes are laid out one after the other, vertically, beginning at the top of a containing block. The vertical distance between two sibling boxes is determined by the â€˜marginâ€™ properties. Vertical margins between adjacent block-level boxes in a block formatting context collapse.</p>
</blockquote>
<p>åœ¨BFCä¸­ï¼Œç›’å­éƒ½æ˜¯æŒ‰å‚ç›´æ–¹å‘ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªæ’ç‰ˆçš„ï¼Œä»<em>containing block</em>çš„é¡¶éƒ¨å¼€å§‹ã€‚2ä¸ªsibing boxedçš„<br>
å‚ç›´æ–¹å‘çš„è·ç¦»æ˜¯ç”±<code>margin</code>æ¥å†³å®šçš„ï¼Œä½†æ­¤æ—¶çš„2ä¸ªç›’å­çš„<code>margin</code>æ˜¯ä¼š<strong>collapse</strong>(åå¡Œï¼ŸæŠ˜å ï¼Ÿ)</p>
<p>é‚£åˆ°åº•æ˜¯æ€ä¹ˆcollapseæ³•ï¼Œæˆ‘ä»¬è¦æ€æ ·æ‰èƒ½è§£å†³ã€‚</p>
<h2 id="bfcå¼•èµ·çš„collapse-margins"><a class="header-anchor" href="#bfcå¼•èµ·çš„collapse-margins">#</a>BFCå¼•èµ·çš„Collapse Margins</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-tag">p</span> &#123;</div><div class="line">    <span class="attribute">margin</span>: <span class="number">10px</span>;</div><div class="line">    <span class="attribute">background-color</span>: lightgreen;</div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> Sibling 1 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> Sibling 2 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ2ä¸ª<code>p</code>çš„ä¹‹é—´çš„<code>margin</code>åªæœ‰<code>10px</code>è€Œä¸æ˜¯<code>20px(10 + 10)</code>ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå‰é¢è¯´è¿‡ï¼Œ</p>
<p>2ä¸ª<code>p</code>éƒ½æ˜¯åœ¨<em>normal flow</em>ä¸­ï¼Œå¹¶ä¸”ï¼Œä»–ä»¬æ˜¯å—çº§å…ƒç´ ï¼Œæ‰€ä»¥ä»–ä»¬ä¼šå‚ä¸block formatting contextsã€‚</p>
<p>åˆå› ä¸ºåœ¨BFCä¸­ï¼Œ2ä¸ªsibling elementçš„å‚ç›´æ–¹é¢çš„<code>margin</code>ä¼šcollapseï¼äºæ˜¯ï¼Œç»“æœå–2è€…è¾ƒå¤§çš„é‚£ä¸ªã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">P</span><span class="selector-pseudo">:last-child</span> &#123;</div><div class="line">  <span class="attribute">margin</span>: <span class="number">20px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œ2ä¸ª<code>p</code>å‚ç›´æ–¹å‘çš„<code>margin</code>å°±å–<code>20</code>ã€‚å› ä¸º20æ¯”10å¤§ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è§£å†³margin collapseå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯<strong>åˆ›å»ºä¸€ä¸ªæ–°çš„bfc</strong>ã€‚</p>
<p>ä¸ºä»€ä¹ˆå¯ä»¥ï¼Ÿå› ä¸ºå‰é¢çš„æ–‡æ¡£è¯´è¿‡: <em>In a block formattingâ€¦<em>æ‰ä¼šå‘ç”Ÿmargin collapseã€‚<br>
ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ</em></em>ä¸åœ¨åŒä¸€ä¸ªbfc**çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæœ‰margin collapseã€‚å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºæ–°çš„bfcå°±è¡Œäº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ€æ ·æ‰èƒ½åˆ›å»ºæ–°çš„bfcå‘¢ï¼Ÿ</p>
<h2 id="create-a-new-bfc"><a class="header-anchor" href="#create-a-new-bfc">#</a>Create a New BFC</h2>
<blockquote>
<p>Floats, absolutely positioned elements, block containers (such as inline-blocks, table-cells, and table-captions) that are not block boxes, and block boxes with â€˜overflowâ€™ other than â€˜visibleâ€™ (except when that value has been propagated to the viewport) establish new block formatting contexts for their contents.</p>
</blockquote>
<p>é€šè¿‡ä¸Šé¢çš„<a href="http://www.w3.org/TR/CSS21/visuren.html#block-formatting" target="_blank" rel="external">æ–‡æ¡£</a>ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä»¥ä¸‹çš„æƒ…å†µä¼šåˆ›å»ºå‡ºæ–°çš„BFC:</p>
<ul>
<li><code>float</code>çš„å€¼ä¸ä¸º<code>none</code></li>
<li><code>position</code>çš„å€¼ä¸ä¸º<code>static</code>æˆ–è€…<code>relative</code>ã€‚</li>
<li><code>display</code>çš„å€¼ä¸º<code>table-cell</code>, <code>table-caption</code>, <code>inline-block</code></li>
<li><code>overflow</code>çš„å€¼ä¸ä¸º<code>visible</code>ã€‚</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-class">.newBFC</span> &#123;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"newBFC"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>I am in the BFC created by my parent tag<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¾‹å­ä¸­çš„<code>div</code>å°±åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„bfcã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è§£å†³margin collapse:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">  <span class="selector-tag">p</span> &#123;</div><div class="line">    <span class="attribute">margin</span>: <span class="number">10px</span>;</div><div class="line">    <span class="attribute">background-color</span>: lightgreen;</div><div class="line">  &#125;</div><div class="line">  <span class="selector-class">.newBFC</span> &#123;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">  &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> Sibling 1 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"newBFC"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> Sibling 2 <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="wrap-up"><a class="header-anchor" href="#wrap-up">#</a>Wrap up</h2>
<p>æ€»çš„æ¥è¯´ï¼ŒBFCå°±æ˜¯å®šä¹‰äº†å—çº§å…ƒç´ æ˜¯å¦‚ä½•æ’ç‰ˆçš„ã€‚</p>
<p>å¦å¤–ï¼Œåˆ›å»ºæ–°çš„BFCå¯ä»¥è§£å†³ä¸€äº›é—®é¢˜ã€‚æ¯”å¦‚ä¸Šé¢çš„<em>margin collapse</em>ï¼Œè¿˜æœ‰æ›´å¤šçš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¸‹ç¯‡å†è¯´ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;çœ‹äº†&lt;a href=&quot;http://www.sitepoint.com/understanding-block-formatting-contexts-in-css/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Understanding Block F
    
    </summary>
    
      <category term="CSS" scheme="http://drakeleung.github.io/blog/categories/CSS/"/>
    
    
      <category term="BFC" scheme="http://drakeleung.github.io/blog/tags/BFC/"/>
    
  </entry>
  
  <entry>
    <title>Scope(3)-What Is Closure</title>
    <link href="http://drakeleung.github.io/blog/2015/07/19/Scope-3-What-Is-Closure/"/>
    <id>http://drakeleung.github.io/blog/2015/07/19/Scope-3-What-Is-Closure/</id>
    <published>2015-07-18T17:58:31.000Z</published>
    <updated>2016-09-08T05:01:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="what-is-closure"><a class="header-anchor" href="#what-is-closure">#</a>What is Closure</h2>
<p>ä»€ä¹ˆæ˜¯é—­åŒ…å‘¢ï¼Ÿæˆ‘ä»¬æ¥ä¸‹ä¸ªå®šä¹‰å§ã€‚</p>
<blockquote>
<p>é—­åŒ…å°±æ˜¯å‡½æ•°å¯ä»¥è®¿é—®ä»–çš„lexical scopeï¼Œå³ä½¿ä»–æ˜¯åœ¨ä»–çš„lexical scopeå¤–é¢æ‰§è¡Œçš„ã€‚</p>
</blockquote>
<p>å…ˆçœ‹ä¸ªä¾‹å­å‹å‹æƒŠã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> x = <span class="number">42</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(x);</div><div class="line">    &#125;</div><div class="line">    bar();</div><div class="line">&#125;</div><div class="line"></div><div class="line">foo(); <span class="comment">// 42</span></div></pre></td></tr></table></figure>
<p>å¾ˆè‡ªç„¶è€Œç„¶åœ°ï¼Œä¸Šé¢ä¾‹å­è¾“å‡ºçš„ç»“æœå°±æ˜¯<code>42</code>ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™å…¶å®å°±æ˜¯ä½œç”¨åŸŸé“¾çš„é—®é¢˜è€Œå·²ã€‚<br>
<code>bar</code>å‡½æ•°è¦å¼•ç”¨åˆ°<code>x</code>è¿™ä¸ªå˜é‡çš„å€¼ã€‚äºæ˜¯å°±åœ¨è‡ªå·±çš„ä½œç”¨åŸŸæ‰¾ï¼Œæ‰¾ä¸åˆ°ã€‚äºæ˜¯å‘ä¸Šæ‰¾ï¼Œç„¶ååœ¨<code>foo</code>å‡½æ•°çš„ä½œç”¨åŸŸå°±æ‰¾åˆ°äº†ã€‚</p>
<p>å¾ˆæ˜¾ç„¶ï¼Œä¸Šé¢çš„ä¾‹å­æ˜¯ç¬¦åˆæˆ‘ä»¬å¯¹é—­åŒ…å®šä¹‰çš„å‰åŠéƒ¨åˆ†ï¼Œ<strong>ä½†æ˜¯ååŠéƒ¨åˆ†æ˜¯ä¸ç¬¦åˆçš„</strong>ã€‚å› ä¸º<code>bar</code>çš„lexical scopeå°±æ˜¯<code>foo</code>çš„ä½œç”¨åŸŸï¼Œè€Œ<code>bar</code>å°±æ˜¯åœ¨<code>foo</code>çš„ä½œç”¨åŸŸé‡Œé¢è¢«è°ƒç”¨çš„ã€‚</p>
<h2 id="how-it-works"><a class="header-anchor" href="#how-it-works">#</a>How it Works</h2>
<p>æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬å°±æƒ³åŠæ³•è®©<code>bar</code>åœ¨<code>foo</code>çš„ä½œç”¨åŸŸå¤–é¢æ‰§è¡Œã€‚æ¯”å¦‚ä½¿ç”¨<code>return</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> x = <span class="number">42</span>;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(x);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> bar;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> baz = foo();</div><div class="line">baz();</div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå…¶å®<code>baz</code>å°±æ˜¯<code>bar</code>ï¼Œåªæ˜¯åå­—æ¢äº†è€Œå·²ï¼Œå†…å®¹è¿˜æ˜¯æ²¡æœ‰æ”¹å˜çš„ã€‚é‚£ä¹ˆå¥½ï¼Œç°åœ¨ï¼Œ<code>bar</code>(ä¹Ÿå°±æ˜¯<code>baz</code>)å¹¶ä¸æ˜¯åœ¨ä»–çš„lexical scope(<code>foo</code>'s scope)è¢«è°ƒç”¨ï¼Œè€Œæ˜¯åœ¨global scopeã€‚å¹¶ä¸”ï¼Œ<code>bar</code>è¿˜å¯ä»¥è®¿é—®ä»–çš„lexical scopeé‡Œé¢çš„<code>x</code>ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥è¯´ï¼Œ<strong>è¿™å°±æ˜¯é—­åŒ…</strong>ã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹1ä¸ªä¾‹å­:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">  fn();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> x = <span class="number">42</span>;</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(x);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  baz(bar);</div><div class="line">&#125;</div><div class="line"></div><div class="line">foo();</div></pre></td></tr></table></figure>
<p>åŒæ ·åœ°ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>bar</code>å¹¶æ²¡æœ‰åœ¨ä»–çš„lexical scope(<code>foo</code>'s scope)ä¸­æ‰§è¡Œï¼Œè€Œåœ¨æ˜¯<code>baz</code>é‡Œé¢æ‰§è¡Œã€‚å¹¶ä¸”ï¼Œ<code>bar</code>è¿˜æ˜¯å¯ä»¥è®¿é—®ä»–çš„lexical scopeã€‚å› æ­¤ï¼Œè¿™ä¸ªä¹Ÿæ˜¯é—­åŒ…ï¼</p>
<h2 id="more-examples"><a class="header-anchor" href="#more-examples">#</a>More Examples</h2>
<p>å…¶å®ï¼Œé—­åŒ…åˆ°å¤„éƒ½æ˜¯~</p>
<p>æ¯”å¦‚ï¼Œä¸€ä¸ªå®šæ—¶å™¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wait</span>(<span class="params">msg</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(msg);</div><div class="line">  &#125;, <span class="number">2</span> * <span class="number">1000</span>);</div><div class="line">&#125;</div><div class="line">wait(<span class="string">'I am also a closure example'</span>);</div></pre></td></tr></table></figure>
<p>2ç§’é’Ÿä¹‹åï¼Œæµè§ˆå™¨å¼•æ“å°±ä¼šåœ¨å…¨å±€ä¸­è°ƒç”¨<code>timer</code>å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>timer</code>å¹¶æ²¡æœ‰åœ¨ä»–çš„lexical scope(<code>wait</code>'s scope)é‡Œé¢æ‰§è¡Œï¼Œä½†æ˜¯ä»–ä»ç„¶å¯ä»¥è®¿é—®<code>msg</code>ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªé—­åŒ…ã€‚</p>
<p>å†æ¯”å¦‚ï¼Œä¸€ä¸ªEvent Handler.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">submit</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> username = <span class="string">'Drake'</span>,</div><div class="line">    submitBtn = <span class="built_in">document</span>.querySelector(<span class="string">'button[type=submit]'</span>);</div><div class="line"></div><div class="line">  submitBtn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(username);</div><div class="line">  &#125;, <span class="literal">false</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="loops-and-closure"><a class="header-anchor" href="#loops-and-closure">#</a>Loops and Closure</h2>
<p>å½“é—­åŒ…å‡ºç°åœ¨å¾ªç¯ä¸­çš„æ—¶å€™ï¼Œå°±ä¼šå¾ˆå®¹æ˜“å‡ºç°é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(i);</div><div class="line">  &#125;, <span class="number">1000</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œå¾ˆå‡ºä¹æ„æ–™åœ°è¾“å‡ºäº†5ä¸ª<code>5</code>ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› åœ¨äº:</p>
<ol>
<li>åœ¨ç¬¬ä¸€ä¸ª<code>timer</code>å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œå·²ç»æœ‰5ä¸ª<code>timer</code>å‡½æ•°å®šä¹‰å¥½äº†ã€‚</li>
<li>å½“ç¬¬ä¸€ä¸ª<code>timer</code>æ‰§è¡Œæ—¶ï¼Œä»–éœ€è¦å¼•ç”¨åˆ°<code>i</code>ã€‚</li>
<li>é¦–å…ˆä»–åœ¨è‡ªå·±çš„ä½œç”¨åŸŸæ‰¾ï¼Œæ‰¾ä¸åˆ°ã€‚</li>
<li>äºæ˜¯å‘ä¸Šæ‰¾ï¼Œå› ä¸ºJavaScriptå¹¶æ²¡æœ‰block scopeã€‚æ‰€ä»¥å‘ä¸Šçš„è¯å°±æ˜¯global scope.</li>
<li>åœ¨global scopeé‡Œé¢æ‰¾åˆ°äº†<code>i</code>ã€‚æ­¤æ—¶<code>i</code>ä¸º<code>5</code>ï¼ˆå› ä¸ºå·²ç»å¾ªç¯äº†5æ¬¡)</li>
</ol>
<p>æ˜¯ä¸æ˜¯è§‰å¾—å°‘äº†ç‚¹ä»€ä¹ˆï¼Ÿå¦‚æœ<code>timer</code>åœ¨è‡ªå·±çš„ä½œç”¨åŸŸå°±å¯ä»¥æ‰¾åˆ°<code>i</code>çš„è¯å°±å¥½å’¯ã€‚æˆ–è€…ï¼Œåœ¨ä¸­é—´åŠ å¤šä¸€å±‚ä½œç”¨åŸŸï¼Œè€Œä¸ç”¨å»åˆ°<code>global scope</code>é‡Œé¢æ‰¾ï¼ˆå› ä¸ºä»–çš„<code>i</code>ä¸€å®šæ˜¯ä¸º<code>5</code>çš„)</p>
<h3 id="solution"><a class="header-anchor" href="#solution">#</a>Solution</h3>
<p>ç¬¬ä¸€ç§ï¼Œ<code>timer</code>åœ¨è‡ªå·±çš„ä½œç”¨åŸŸå°±å¯ä»¥æ‰¾åˆ°<code>i</code>ã€‚å¯ä»¥åˆ©ç”¨<code>forEach</code>ç­‰å¾ªç¯æ–¹æ³•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> aArray = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>];</div><div class="line"></div><div class="line">aArray.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item, index, array</span>) </span>&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(index);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§ï¼Œåœ¨ä¸­é—´æ–°å¢ä¸€å±‚ä½œç”¨åŸŸã€‚å¸¸ç”¨çš„patternå°±æ˜¯ä½¿ç”¨IIFEã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">  (<span class="function"><span class="keyword">function</span>(<span class="params">j</span>) </span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(j);</div><div class="line">    &#125;);</div><div class="line">  &#125;)(i);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç”±äºIIFEæ˜¯ç«‹å³è°ƒç”¨çš„ï¼Œæ‰€ä»¥æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½ä¼ è¿›äº†ä¸åŒçš„å®å‚ã€‚</p>
<ol>
<li>å½“<code>timer</code>è¦å¼•ç”¨<code>i</code>çš„æ—¶å€™ï¼Œç°åœ¨è‡ªå·±çš„ä½œç”¨åŸŸé‡Œé¢æ‰¾ã€‚æ‰¾ä¸åˆ°ã€‚</li>
<li>ç„¶åå‘ä¸Šæ‰¾ï¼Œåœ¨IIFEé‡Œé¢æ‰¾åˆ°äº†ï¼Œä¹Ÿå°±æ˜¯å½¢å‚<code>j</code>ã€‚</li>
</ol>
<p>ç¬¬ä¸‰ç§åˆ©ç”¨<code>let</code>æ¥åˆ›å»ºblock scope.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(i);</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>let</code>åŠ«æŒäº†<code>for</code>çš„ä½œç”¨åŸŸã€‚æ¯æ¬¡å¾ªç¯ï¼Œéƒ½ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„<code>i</code>ã€‚</p>
<p><code>timer</code>åœ¨è‡ªå·±çš„ä½œç”¨åŸŸæ‰¾ä¸åˆ°<code>i</code>,å‘ä¸Šæ‰¾ï¼Œåœ¨<code>for</code>é‡Œé¢æ‰¾ï¼Œå“ˆï¼Œæ‰¾åˆ°äº†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;what-is-closure&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#what-is-closure&quot;&gt;#&lt;/a&gt;What is Closure&lt;/h2&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯é—­åŒ…å‘¢ï¼Ÿæˆ‘ä»¬æ¥ä¸‹ä¸ªå®šä¹‰å§ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://drakeleung.github.io/blog/categories/JavaScript/"/>
    
    
      <category term="scope" scheme="http://drakeleung.github.io/blog/tags/scope/"/>
    
      <category term="closure" scheme="http://drakeleung.github.io/blog/tags/closure/"/>
    
  </entry>
  
</feed>
